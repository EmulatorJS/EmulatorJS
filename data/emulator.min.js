var EJS=function(o){window.EJS_MODULES=o;var n={},a=[];function i(e){if(n[e])return n[e].exports;a.push(e);var t=n[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return window.getUsedModules=function(){return a.sort(function(e,t){return t<e?1:-1})},window.getUnusedModules=function(){for(var e=[],t=getUsedModules(),n=0;n<o.length;n++)null===o[n]||t.includes(n)||e.push(n);return e},Array.isArray,i.m=o,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=162)}([function(e){e.exports=function(e,t,n){console.warn(e),e&&e.response&&0===e.response.status?t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;"><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors">'+n.localization("CORS Error")+"</a></strong>":t.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+n.localization("Network Error")+"</strong>"}},null,null,null,null,null,function(e){e.exports=class{gamepads;timeout;listeners;constructor(){if(!navigator.getGamepads&&!navigator.webkitGetGamepads)throw new Error("Get gamepads not found!");if(!window.setTimeout)throw new Error("setTimeout was not found!");this.gamepads=[],this.listeners={},this.timeout=null,this.loop()}terminate(){window.clearTimeout(this.timeout)}getGamepads(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]}loop(){this.updateGamepadState(),this.timeout=setTimeout(this.loop.bind(this),10)}updateGamepadState(){const o=this.getGamepads();o.forEach((i,n)=>{if(i){let t=!1;this.gamepads.forEach((a,e)=>{a.index===i.index&&(t=!0,a.axes.forEach((e,t)=>{if(i.axes[t]!==e){const e=function(){switch(t){case 0:return"LEFT_STICK_X";case 1:return"LEFT_STICK_Y";case 2:return"RIGHT_STICK_X";case 3:return"RIGHT_STICK_Y";default:return null}}();e&&this.dispatchEvent("axischanged",{axis:e,value:i.axes[t],index:i.index,gamepadIndex:i.index})}}),i.buttons.forEach((e,t)=>{let n=1===a.buttons[t],o=("object"==typeof a.buttons[t]&&(n=a.buttons[t].pressed),1===e);"object"==typeof e&&(o=e.pressed),n!==o&&(o?this.dispatchEvent("buttondown",{index:t,gamepadIndex:i.index}):this.dispatchEvent("buttonup",{index:t,gamepadIndex:i.index}))}),this.gamepads[e]=o[n])}),t||(this.gamepads.push(o[n]),this.dispatchEvent("connected",{gamepadIndex:i.index}))}});for(let n=0;n<this.gamepads.length;n++)if(this.gamepads[n]){let t=!1;for(let e=0;e<o.length;e++)if(o[e]&&this.gamepads[n].index===o[e].index){t=!0;break}t||(this.dispatchEvent("disconnected",{gamepadIndex:this.gamepads[n].index}),this.gamepads.splice(n,1),n--)}}dispatchEvent(e,t){"function"==typeof this.listeners[e]&&((t=t||{}).type=e,this.listeners[e](t))}on(e,t){this.listeners[e.toLowerCase()]=t}}},null,null,null,null,function(e,t,n){function o(o,a){let e;try{e=new URL(o)}catch(e){}return e&&["http:","https:"].includes(e.protocol)||!e?new Promise(function(t,e){let n=new XMLHttpRequest;a.onProgress&&n.addEventListener("progress",a.onProgress),n.onload=function(){if(n.readyState===n.DONE){let e=n.response;try{e=JSON.parse(e)}catch(e){}t({data:e,headers:{"content-length":n.getResponseHeader("content-length"),"content-type":n.getResponseHeader("content-type"),"last-modified":n.getResponseHeader("last-modified")}})}},n.responseType=a.type,n.onerror=e,n.open(a.method,o,!0),n.send()}):new Promise(async function(t,n){if("HEAD"===a.method)t({headers:{}});else{let e;try{if(e=await fetch(o),a.type&&"arraybuffer"===a.type.toLowerCase())e=await e.arrayBuffer();else{e=await e.text();try{e=JSON.parse(e)}catch(e){}}}catch(e){n(e)}o.startsWith("blob:")&&URL.revokeObjectURL(o),t({data:e,headers:{}})}})}e.exports={a:{get:async function(e,t){var n=t&&t.responseType?t&&t.responseType:"text",t=t&&t.onDownloadProgress;return o(e,{method:"GET",type:n,onProgress:t})},head:async function(e,t){var n=t&&t.responseType?t&&t.responseType:"text",t=t&&t.onDownloadProgress;return o(e,{method:"HEAD",type:n,onProgress:t})}}}},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t){var n,o,e=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(e){o=i}var r,l=[],c=!1,d=-1;function u(){c&&r&&(c=!1,r.length?l=r.concat(l):d=-1,l.length&&f())}function f(){if(!c){var e=s(u);c=!0;for(var t=l.length;t;){for(r=l,l=[];++d<t;)r&&r[d].run();d=-1,t=l.length}r=null,c=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===i||!o)&&clearTimeout)return(o=clearTimeout)(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=m,e.addListener=m,e.once=m,e.off=m,e.removeListener=m,e.removeAllListeners=m,e.emit=m,e.prependListener=m,e.prependOnceListener=m,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},null,null,null,null,null,null,null,function(e,t,n){var o;!function(){"use strict";void 0!==(o="function"==typeof(o=function(){function u(e){throw e}function f(){}function e(e,t){for(var n in void 0===t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={}),a)this[n]=(void 0!==e[n]?e:a)[n];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var o="object"==typeof window?window:self,t=this.implementationPreference.filter(function(e){return e in o});this.implementation=t[0],this.idb=o[this.implementation],this.keyRange=o.IDBKeyRange||o.webkitIDBKeyRange||o.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()}var a={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:u,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},t={constructor:e,version:"1.7.2",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),a=!1;e.onerror=function(e){var t;("error"in(t=e).target?"VersionError"==t.target.error.name:"errorCode"in t.target&&12==t.target.errorCode)?this.onError(new Error("The version number provided is lower than the existing one.")):(e=e.target.error||(t="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion,"errorCode"in e.target&&(t+=" with error code "+e.target.errorCode),new Error(t)),this.onError(e))}.bind(this),e.onsuccess=function(e){var o;a||(this.db?this.onStoreReady():(this.db=e.target.result,"string"!=typeof this.db.version?this.db.objectStoreNames.contains(this.storeName)?(e=this.db.transaction([this.storeName],this.consts.READ_ONLY),this.store=e.objectStore(this.storeName),o=Array.prototype.slice.call(this.getIndexList()),this.indexes.forEach(function(e){var t,n=e.name;if(!n)return a=!0,void this.onError(new Error("Cannot create index: No index name given."));this.normalizeIndexData(e),this.hasIndex(n)?(t=this.store.index(n),this.indexComplies(t,e)||(a=!0,this.onError(new Error('Cannot modify index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),o.splice(o.indexOf(n),1)):(a=!0,this.onError(new Error('Cannot create new index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))},this),o.length&&(a=!0,this.onError(new Error('Cannot delete index(es) "'+o.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),a||this.onStoreReady()):this.onError(new Error("Object store couldn't be created.")):this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."))))}.bind(this),e.onupgradeneeded=function(e){this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName)?this.store=e.target.transaction.objectStore(this.storeName):(e={autoIncrement:this.autoIncrement},null!==this.keyPath&&(e.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,e));var o=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var t,n=e.name;n||(a=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(n)?(t=this.store.index(n),this.indexComplies(t,e)||(this.store.deleteIndex(n),this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),o.splice(o.indexOf(n),1)):this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this),o.length&&o.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(e,t){var n;this.idb.deleteDatabase?(this.db.close(),(n=this.idb.deleteDatabase(this.dbName)).onsuccess=e,n.onerror=t):t(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(e,t,n,o){null!==this.keyPath&&(o=n,n=t,t=e),o=o||u,n=n||f;var a=!1,i=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);return s.oncomplete=function(){(a?n:o)(i)},s.onabort=o,s.onerror=o,(t=null!==this.keyPath?(this._addIdPropertyIfNeeded(t),s.objectStore(this.storeName).put(t)):s.objectStore(this.storeName).put(t,e)).onsuccess=function(e){a=!0,i=e.target.result},t.onerror=o,s},get:function(e,t,n){n=n||u,t=t||f;var o=!1,a=null,i=this.db.transaction([this.storeName],this.consts.READ_ONLY),e=(i.oncomplete=function(){(o?t:n)(a)},i.onabort=n,i.onerror=n,i.objectStore(this.storeName).get(e));return e.onsuccess=function(e){o=!0,a=e.target.result},e.onerror=n,i},remove:function(e,t,n){n=n||u,t=t||f;var o=!1,a=null,i=this.db.transaction([this.storeName],this.consts.READ_WRITE),e=(i.oncomplete=function(){(o?t:n)(a)},i.onabort=n,i.onerror=n,i.objectStore(this.storeName).delete(e));return e.onsuccess=function(e){o=!0,a=e.target.result},e.onerror=n,i},batch:function(e,t,i){if(i=i||u,t=t||f,"[object Array]"!=Object.prototype.toString.call(e))i(new Error("dataArray argument must be of type Array."));else if(0===e.length)return t(!0);function s(){0!=--n||r||(o=r=!0)}var n=e.length,r=!1,o=!1,l=this.db.transaction([this.storeName],this.consts.READ_WRITE);l.oncomplete=function(){(o?t:i)(o)},l.onabort=i,l.onerror=i;return e.forEach(function(e){function t(e){l.abort(),r||(r=!0,i(e,o,a))}var n,o=e.type,a=e.key,e=e.value;"remove"==o?((n=l.objectStore(this.storeName).delete(a)).onsuccess=s,n.onerror=t):"put"==o&&((n=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),l.objectStore(this.storeName).put(e)):l.objectStore(this.storeName).put(e,a)).onsuccess=s,n.onerror=t)},this),l},putBatch:function(e,t,n){e=e.map(function(e){return{type:"put",value:e}});return this.batch(e,t,n)},upsertBatch:function(t,e,n,o){"function"==typeof e&&(o=n=e,e={}),o=o||u,n=n||f,e=e||{},"[object Array]"!=Object.prototype.toString.call(t)&&o(new Error("dataArray argument must be of type Array."));function a(e){t[c++][i]=e.target.result,0!=--s||r||(l=r=!0)}var i=e.keyField||this.keyPath,s=t.length,r=!1,l=!1,c=0,d=this.db.transaction([this.storeName],this.consts.READ_WRITE);d.oncomplete=function(){l?n(t):o(!1)},d.onabort=o,d.onerror=o;return t.forEach(function(e){var t=e.key,e=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),d.objectStore(this.storeName).put(e)):d.objectStore(this.storeName).put(e,t);e.onsuccess=a,e.onerror=function(e){d.abort(),r||(r=!0,o(e))}},this),d},removeBatch:function(e,t,n){e=e.map(function(e){return{type:"remove",key:e}});return this.batch(e,t,n)},getBatch:function(e,t,n,o){if(n=n||u,t=t||f,o=o||"sparse","[object Array]"!=Object.prototype.toString.call(e))n(new Error("keyArray argument must be of type Array."));else if(0===e.length)return t([]);function a(e){e.target.result||"dense"==o?i.push(e.target.result):"sparse"==o&&i.length++,0==--s&&(r=!0,l=i)}var i=[],s=e.length,r=!1,l=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){(r?t:n)(l)},c.onabort=n,c.onerror=n;return e.forEach(function(e){e=c.objectStore(this.storeName).get(e);e.onsuccess=a,e.onerror=function(e){n(l=e),c.abort()}},this),c},getAll:function(e,t){t=t||u,e=e||f;var n=this.db.transaction([this.storeName],this.consts.READ_ONLY),o=n.objectStore(this.storeName);return o.getAll?this._getAllNative(n,o,e,t):this._getAllCursor(n,o,e,t),n},_getAllNative:function(e,t,n,o){var a=!1,i=null,e=(e.oncomplete=function(){(a?n:o)(i)},e.onabort=o,e.onerror=o,t.getAll());e.onsuccess=function(e){a=!0,i=e.target.result},e.onerror=o},_getAllCursor:function(e,t,n,o){var a=[],i=!1,s=null,e=(e.oncomplete=function(){(i?n:o)(s)},e.onabort=o,e.onerror=o,t.openCursor());e.onsuccess=function(e){e=e.target.result;e?(a.push(e.value),e.continue()):(i=!0,s=a)},e.onError=o},clear:function(e,t){t=t||u,e=e||f;var n=!1,o=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE),i=(a.oncomplete=function(){(n?e:t)(o)},a.onabort=t,a.onerror=t,a.objectStore(this.storeName).clear());return i.onsuccess=function(e){n=!0,o=e.target.result},i.onerror=t,a},_addIdPropertyIfNeeded:function(e){void 0===e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount+++Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(i,s){return["keyPath","unique","multiEntry"].every(function(e){if("multiEntry"==e&&void 0===i[e]&&!1===s[e])return!0;if("keyPath"!=e||"[object Array]"!=Object.prototype.toString.call(s[e]))return s[e]==i[e];var t=s.keyPath,n=i.keyPath;if("string"==typeof n)return t.toString()==n;if("function"!=typeof n.contains&&"function"!=typeof n.indexOf)return!1;if(n.length!==t.length)return!1;for(var o=0,a=t.length;o<a;o++)if(!(n.contains&&n.contains(t[o])||n.indexOf(-1!==t[o])))return!1;return!0})},iterate:function(n,o){var e="desc"==(o=r({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:u,limit:1/0,offset:0,allowItemRejection:!1},o||{})).order.toLowerCase()?"PREV":"NEXT",a=(o.filterDuplicates&&(e+="_NO_DUPLICATE"),!1),i=this.db.transaction([this.storeName],this.consts[o.writeAccess?"READ_WRITE":"READ_ONLY"]),t=i.objectStore(this.storeName),s=(o.index&&(t=t.index(o.index)),0),t=(i.oncomplete=function(){a?o.onEnd?o.onEnd():n(null):o.onError(null)},i.onabort=o.onError,i.onerror=o.onError,t.openCursor(o.keyRange,this.consts[e]));return t.onerror=o.onError,t.onsuccess=function(e){var t,e=e.target.result;e?o.offset?(e.advance(o.offset),o.offset=0):(t=n(e.value,e,i),o.allowItemRejection&&!1===t||s++,o.autoContinue&&(s+o.offset<o.limit?e.continue():a=!0)):a=!0},i},query:function(e,n){var o=[],a=0;return(n=n||{}).autoContinue=!0,n.writeAccess=!1,n.allowItemRejection=!!n.filter,n.onEnd=function(){e(o,a)},this.iterate(function(e){a++;var t=!n.filter||n.filter(e);return!1!==t&&o.push(e),t},n)},count:function(e,t){var n=(t=r({index:null,keyRange:null},t||{})).onError||u,o=!1,a=null,i=this.db.transaction([this.storeName],this.consts.READ_ONLY),s=(i.oncomplete=function(){(o?e:n)(a)},i.onabort=n,i.onerror=n,i.objectStore(this.storeName)),s=(s=t.index?s.index(t.index):s).count(t.keyRange);return s.onsuccess=function(e){o=!0,a=e.target.result},s.onError=n,i},makeKeyRange:function(e){var t,n=void 0!==e.lower,o=void 0!==e.upper;switch(!0){case void 0!==e.only:t=this.keyRange.only(e.only);break;case n&&o:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case n:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case o:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}},i={};function r(e,t){var n,o;for(n in t)(o=t[n])!==i[n]&&o!==e[n]&&(e[n]=o);return e}return e.prototype=t,e.version=t.version,e})?o.call(t,n,t,e):o)&&(e.exports=o)}()},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,o,t){!function o(a,i,s){function r(t,e){if(!i[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n=i[t]={exports:{}};a[t][0].call(n.exports,function(e){return r(a[t][1][e]||e)},n,n.exports,o,a,i,s)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)r(s[e]);return r}({1:[function(e,t,n){o.Buffer=e("buffer").Buffer},{buffer:3}],2:[function(e,t,n){"use strict";n.byteLength=function(e){var e=d(e),t=e[0],e=e[1];return 3*(t+e)/4-e},n.toByteArray=function(e){for(var t,n=d(e),o=n[0],n=n[1],a=new c(3*(o+n)/4-n),i=0,s=0<n?o-4:o,r=0;r<s;r+=4)t=l[e.charCodeAt(r)]<<18|l[e.charCodeAt(r+1)]<<12|l[e.charCodeAt(r+2)]<<6|l[e.charCodeAt(r+3)],a[i++]=t>>16&255,a[i++]=t>>8&255,a[i++]=255&t;return 2===n&&(t=l[e.charCodeAt(r)]<<2|l[e.charCodeAt(r+1)]>>4,a[i++]=255&t),1===n&&(t=l[e.charCodeAt(r)]<<10|l[e.charCodeAt(r+1)]<<4|l[e.charCodeAt(r+2)]>>2,a[i++]=t>>8&255,a[i++]=255&t),a},n.fromByteArray=function(e){for(var t,n=e.length,o=n%3,a=[],i=0,s=n-o;i<s;i+=16383)a.push(function(e,t,n){for(var o,a=[],i=t;i<n;i+=3)o=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),a.push(r[(o=o)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}(e,i,s<i+16383?s:i+16383));return 1==o?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2==o&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],l=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,i=o.length;a<i;++a)r[a]=o[a],l[o.charCodeAt(a)]=a;function d(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],3:[function(O,e,P){!function(e){!function(){"use strict";var T=O("base64-js"),i=O("ieee754"),t=(P.Buffer=u,P.SlowBuffer=function(e){return u.alloc(+(e=+e!=e?0:e))},P.INSPECT_MAX_BYTES=50,2147483647);function d(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=u.prototype,e}function u(e,t,n){if("number"!=typeof e)return o(e,t,n);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}function o(e,t,n){if("string"==typeof e){var o=e,a=t;if(!u.isEncoding(a="string"==typeof a&&""!==a?a:"utf8"))throw new TypeError("Unknown encoding: "+a);var i=0|m(o,a),s=d(i);return s=(o=s.write(o,a))!==i?s.slice(0,o):s}if(ArrayBuffer.isView(e))return f(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(M(e,ArrayBuffer)||e&&M(e.buffer,ArrayBuffer)){a=e,i=t,o=n;if(i<0||a.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<i+(o||0))throw new RangeError('"length" is outside of buffer bounds');return(a=void 0===i&&void 0===o?new Uint8Array(a):void 0===o?new Uint8Array(a,i):new Uint8Array(a,i,o)).__proto__=u.prototype,a}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return u.from(s,t,n);var r,l,c=u.isBuffer(r=e)?(0!==(l=d(c=0|p(r.length))).length&&r.copy(l,0,0,c),l):void 0!==r.length?"number"!=typeof r.length||I(r.length)?d(0):f(r):"Buffer"===r.type&&Array.isArray(r.data)?f(r.data):void 0;if(c)return c;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return a(e),d(e<0?0:0|p(e))}function f(e){for(var t=e.length<0?0:0|p(e.length),n=d(t),o=0;o<t;o+=1)n[o]=255&e[o];return n}function p(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||M(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,o=2<arguments.length&&!0===arguments[2];if(!o&&0===n)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return x(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return S(e).length;default:if(a)return o?-1:x(e).length;t=(""+t).toLowerCase(),a=!0}}function n(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function r(e,t,n,o,a){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),(n=(n=I(n=+n)?a?0:e.length-1:n)<0?e.length+n:n)>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=u.from(t,o)),u.isBuffer(t))return 0===t.length?-1:l(e,t,n,o,a);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(a?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,n):l(e,[t],n,o,a);throw new TypeError("val must be string, number or Buffer")}function l(e,t,n,o,a){var i=1,s=e.length,r=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s/=i=2,r/=2,n/=2}function l(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(a)for(var c=-1,d=n;d<s;d++)if(l(e,d)===l(t,-1===c?0:d-c)){if(d-(c=-1===c?d:c)+1===r)return c*i}else-1!==c&&(d-=d-c),c=-1;else for(d=n=s<n+r?s-r:n;0<=d;d--){for(var u=!0,f=0;f<r;f++)if(l(e,d+f)!==l(t,f)){u=!1;break}if(u)return d}return-1}function v(e,t,n,o){return C(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function E(e,t,n){n=Math.min(e.length,n);for(var o=[],a=t;a<n;){var i,s,r,l,c=e[a],d=null,u=239<c?4:223<c?3:191<c?2:1;if(a+u<=n)switch(u){case 1:c<128&&(d=c);break;case 2:128==(192&(i=e[a+1]))&&127<(l=(31&c)<<6|63&i)&&(d=l);break;case 3:i=e[a+1],s=e[a+2],128==(192&i)&&128==(192&s)&&2047<(l=(15&c)<<12|(63&i)<<6|63&s)&&(l<55296||57343<l)&&(d=l);break;case 4:i=e[a+1],s=e[a+2],r=e[a+3],128==(192&i)&&128==(192&s)&&128==(192&r)&&65535<(l=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&r)&&l<1114112&&(d=l)}null===d?(d=65533,u=1):65535<d&&(d-=65536,o.push(d>>>10&1023|55296),d=56320|1023&d),o.push(d),a+=u}var f=o,p=f.length;if(p<=g)return String.fromCharCode.apply(String,f);for(var m="",h=0;h<p;)m+=String.fromCharCode.apply(String,f.slice(h,h+=g));return m}P.kMaxLength=t,(u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=o,u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(e,t,n){return t=t,n=n,a(e=e),!(e<=0)&&void 0!==t?"string"==typeof n?d(e).fill(t,n):d(e).fill(t):d(e)},u.allocUnsafe=s,u.allocUnsafeSlow=s,u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(M(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),M(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,o=t.length,a=0,i=Math.min(n,o);a<i;++a)if(e[a]!==t[a]){n=e[a],o=t[a];break}return n<o?-1:o<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(a=t=0;a<e.length;++a)t+=e[a].length;for(var n=u.allocUnsafe(t),o=0,a=0;a<e.length;++a){var i=e[a];if(M(i,Uint8Array)&&(i=u.from(i)),!u.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)n(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)n(this,t,t+3),n(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)n(this,t,t+7),n(this,t+1,t+6),n(this,t+2,t+5),n(this,t+3,t+4);return this},u.prototype.toLocaleString=u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?E(this,0,e):function(e,t,n){var o,a=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var i=this,s=t,r=n,l=i.length;(!r||r<0||l<r)&&(r=l);for(var c="",d=s=!s||s<0?0:s;d<r;++d)c+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(i[d]);return c;case"utf8":case"utf-8":return E(this,t,n);case"ascii":var u=this,l=t,f=n,p="";f=Math.min(u.length,f);for(var m=l;m<f;++m)p+=String.fromCharCode(127&u[m]);return p;case"latin1":case"binary":var h=this,s=t,g=n,y="";g=Math.min(h.length,g);for(var v=s;v<g;++v)y+=String.fromCharCode(h[v]);return y;case"base64":return b=this,o=n,0===(_=t)&&o===b.length?T.fromByteArray(b):T.fromByteArray(b.slice(_,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var b=t,_=n,w=this.slice(b,_),x="",S=0;S<w.length;S+=2)x+=String.fromCharCode(w[S]+256*w[S+1]);return x;default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",t=P.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,o,a){if(M(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===a&&(a=this.length),(t=void 0===t?0:t)<0||n>e.length||o<0||a>this.length)throw new RangeError("out of range index");if(a<=o&&n<=t)return 0;if(a<=o)return-1;if(n<=t)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(o>>>=0),s=(n>>>=0)-(t>>>=0),r=Math.min(i,s),l=this.slice(o,a),c=e.slice(t,n),d=0;d<r;++d)if(l[d]!==c[d]){i=l[d],s=c[d];break}return i<s?-1:s<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return r(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return r(this,e,t,n,!1)},u.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var a=this.length-t;if((void 0===n||a<n)&&(n=a),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o=o||"utf8";for(var i,s,r,l,c,d=!1;;)switch(o){case"hex":var u=this,f=e,p=t,m=n,h=(p=Number(p)||0,u.length-p);(!m||(m=Number(m))>h)&&(m=h),(h=f.length)/2<m&&(m=h/2);for(var g=0;g<m;++g){var y=parseInt(f.substr(2*g,2),16);if(I(y))return g;u[p+g]=y}return g;case"utf8":case"utf-8":return h=t,c=n,C(x(e,(l=this).length-h),l,h,c);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return l=this,c=t,r=n,C(S(e),l,c,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r=t,s=n,C(function(e,t){for(var n,o,a=[],i=0;i<e.length&&!((t-=2)<0);++i)o=(n=e.charCodeAt(i))>>8,a.push(n%256),a.push(o);return a}(e,(i=this).length-r),i,r,s);default:if(d)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),d=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var g=4096;function c(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function h(e,t,n,o,a,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(a<t||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function y(e,t,n,o){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function b(e,t,n,o,a){return t=+t,n>>>=0,a||y(e,0,n,4),i.write(e,t,n,o,23,4),n+4}function _(e,t,n,o,a){return t=+t,n>>>=0,a||y(e,0,n,8),i.write(e,t,n,o,52,8),n+8}u.prototype.slice=function(e,t){var n=this.length,n=((e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e),this.subarray(e,t));return n.__proto__=u.prototype,n},u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||c(e,t,this.length);for(var o=this[e],a=1,i=0;++i<t&&(a*=256);)o+=this[e+i]*a;return o},u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||c(e,t,this.length);for(var o=this[e+--t],a=1;0<t&&(a*=256);)o+=this[e+--t]*a;return o},u.prototype.readUInt8=function(e,t){return e>>>=0,t||c(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||c(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||c(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||c(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||c(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||c(e,t,this.length);for(var o=this[e],a=1,i=0;++i<t&&(a*=256);)o+=this[e+i]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||c(e,t,this.length);for(var o=t,a=1,i=this[e+--o];0<o&&(a*=256);)i+=this[e+--o]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return e>>>=0,t||c(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||c(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt16BE=function(e,t){e>>>=0,t||c(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||c(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||c(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||c(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||c(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||c(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||c(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,o){e=+e,t>>>=0,n>>>=0,o||h(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,o){e=+e,t>>>=0,n>>>=0,o||h(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;0<=--a&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,n,o){e=+e,t>>>=0,o||h(this,e,t,n,(o=Math.pow(2,8*n-1))-1,-o);var a=0,i=1,s=0;for(this[t]=255&e;++a<n&&(i*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/i>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,o){e=+e,t>>>=0,o||h(this,e,t,n,(o=Math.pow(2,8*n-1))-1,-o);var a=n-1,i=1,s=0;for(this[t+a]=255&e;0<=--a&&(i*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/i>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||h(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,n){return b(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return b(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return _(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return _(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,o){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n=n||0,o||0===o||(o=this.length),t>=e.length&&(t=e.length),(o=0<o&&o<n?n:o)===n)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length);var a=(o=e.length-t<o-n?e.length-t+n:o)-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,o);else if(this===e&&n<t&&t<o)for(var i=a-1;0<=i;--i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,o),t);return a},u.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!u.isEncoding(o))throw new TypeError("Unknown encoding: "+o);var a;1===e.length&&(a=e.charCodeAt(0),("utf8"===o&&a<128||"latin1"===o)&&(e=a))}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(i=t;i<n;++i)this[i]=e;else{var s=u.isBuffer(e)?e:u.from(e,o),r=s.length;if(0===r)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%r]}return this};var w=/[^+/0-9A-Za-z-_]/g;function x(e,t){var n;t=t||1/0;for(var o=e.length,a=null,i=[],s=0;s<o;++s){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!a){if(56319<n){-1<(t-=3)&&i.push(239,191,189);continue}if(s+1===o){-1<(t-=3)&&i.push(239,191,189);continue}a=n;continue}if(n<56320){-1<(t-=3)&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&-1<(t-=3)&&i.push(239,191,189);if(a=null,n<128){if(--t<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function S(e){return T.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(w,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,n,o){for(var a=0;a<o&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function M(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function I(e){return e!=e}}.call(this)}.call(this,O("buffer").Buffer)},{"base64-js":2,buffer:3,ieee754:4}],4:[function(e,t,n){n.read=function(e,t,n,o,a){var i,s,r=8*a-o-1,l=(1<<r)-1,c=l>>1,d=-7,u=n?a-1:0,f=n?-1:1,a=e[t+u];for(u+=f,i=a&(1<<-d)-1,a>>=-d,d+=r;0<d;i=256*i+e[t+u],u+=f,d-=8);for(s=i&(1<<-d)-1,i>>=-d,d+=o;0<d;s=256*s+e[t+u],u+=f,d-=8);if(0===i)i=1-c;else{if(i===l)return s?NaN:1/0*(a?-1:1);s+=Math.pow(2,o),i-=c}return(a?-1:1)*s*Math.pow(2,i-o)},n.write=function(e,t,n,o,a,i){var s,r,l=8*i-a-1,c=(1<<l)-1,d=c>>1,u=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,f=o?0:i-1,p=o?1:-1,i=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(r=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(o=Math.pow(2,-s))<1&&(s--,o*=2),2<=(t+=1<=s+d?u/o:u*Math.pow(2,1-d))*o&&(s++,o/=2),c<=s+d?(r=0,s=c):1<=s+d?(r=(t*o-1)*Math.pow(2,a),s+=d):(r=t*Math.pow(2,d-1)*Math.pow(2,a),s=0));8<=a;e[n+f]=255&r,f+=p,r/=256,a-=8);for(s=s<<a|r,l+=a;0<l;e[n+f]=255&s,f+=p,s/=256,l-=8);e[n+f-p]|=128*i}},{}]},{},[1])},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,function(e,t,n){var o;!function(){"use strict";var i={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"==o||"number"==o)e.push(this&&this[n]||n);else if(Array.isArray(n))e.push(s.apply(this,n));else if("object"==o)for(var a in n)i.call(n,a)&&n[a]&&e.push(this&&this[a]||a)}}return e.join(" ")}e.exports?e.exports=s.default=s:void 0!==(o=function(){return s}.apply(t,[]))&&(e.exports=o)}()},function(e){e.exports={"ejs-wrapper":"ejs--de6433374cb30211f10e148b320b2f",ejs:"ejs--7a5f920ceffb2913f6dbda780573cf","ejs--full-ui":"ejs--f3a002bba9836fe4ebfed357a45521","controls-tabs":"ejs--008adea3c1ef33a8fc94892a1e97e6",overlay:"ejs--85a95eb6bf74a40ab61b91a91e5bff","key-setting-popup":"ejs--d169a219343bc32dd4aecc3f6b7f25","loading-info":"ejs--782e3572812f983b3a150eec177391",p1:"ejs--c426dd1d179aa351e6cec47e1d9438",p2:"ejs--31e7e81db48819ee35ec6f50378a2e",p3:"ejs--20d4eb2646d396f558a645dc0574f1",p4:"ejs--4de05306c8b099bdeb4585571ac095",ejs__contextmenu:"ejs--c7957d8666bb6b8fc7c3e9c021aaf8",ad:"ejs--cbcfe0a1421cadac9a04c81d6431d6","close-ad":"ejs--f3a1903d935f6cf720d4a0498db62a","start-game":"ejs--73f9b4e94a7a1fe74e11107d5ab2ef",pulse:"ejs--9bd947b3e6427453595f083d740a7c",ejs__control:"ejs--8732295ca5c4902a060d34706a8146","ejs__tab-focus":"ejs--a83b6c705e103e81a7762d0ed5e64b","ejs__control--pressed":"ejs--b1238136ec472a92297159882cf4b8","icon--pressed":"ejs--ec731619062226d943da67f5d83009","icon--not-pressed":"ejs--dc7068585e3d84fe0e676864c1439e","label--pressed":"ejs--0c6561f9155750b0aeeed6da5da7bf","label--not-pressed":"ejs--13d64e30c1333cc99391af48ddabaa","ejs--video":"ejs--d5f430a99a1619b3434bf58e34a99c",ejs__controls:"ejs--1acedc5ed6816abe96dd27d910fd74",ejs__progress:"ejs--f1aa376719b564cae0e653157cde14",ejs__time:"ejs--90d2780f99bcc76fdb6b0378a7238e",ejs__menu:"ejs--c7bfb2d1b75a40fdaaf90624bea9e7",ejs__volume:"ejs--36ceeeec0df37a9cf4bbe05fa204ec","ejs--hide-controls":"ejs--1b8cb7f2294b1eb5de5238daea3513","ejs--fullscreen-enabled":"ejs--19409fe2057ab935a7e46abb5b4f49",ejs__tooltip:"ejs--74c6d4176d27e37a19d2e9e61de8f4",ejs__menu__container:"ejs--013213afedeeb6878089b1ca1b4e47","ejs-popup":"ejs--c2532bfe04554193cc42b3be753700","ejs__control--forward":"ejs--0b4cdb4057d1a4623e60836ccc6275","ejs__control--back":"ejs--a7ad9de0cb0ca672b6703c50de7db9",ejs__menu__value:"ejs--f91e90fe7cabc875aff9a431bf5389","ejs__tooltip--visible":"ejs--6ea27aa07e60d1d6e4c9782740028a","ejs--menu-open":"ejs--da54136ccf8c6b0b16d98e8b8e8b88","ejs__video-wrapper":"ejs--057800d021995e1347ec07cb748672",portrait:"ejs--64f1256f556fb94454b930cb3ea7f2","game-started":"ejs--7da7949f602347007818e6d192eb23",ejs__progress__buffer:"ejs--f8d706413436fd119cf01aaf5a9d9d","ejs--audio":"ejs--bd0222e58d71b0a304d6037dfcffd5","ejs--loading":"ejs--2521e1257996f264de36e77cc9c5ee",ejs__dialogs:"ejs--d31688f864f56d6426ebbf2217d6ee",ejs__dialog:"ejs--5e71fd80268afbb1d588e40b993508",ejs__cache__container:"ejs--1e0f0672f67d0e96592314c9ed78b0",ejs__loading__container:"ejs--d7e6a6a8f38bfaa256fe5d709a8258","ejs__load-state__container":"ejs--b183f581b5336c4908ad258d3e1cc7",ejs__screenRecord__container:"ejs--b183f581b5336cashrqd258d3e1cc7",ejs__netplay__container:"ejs--158ea9dd34e3e7af2d837f8b05babb",ejs__gamepad__container:"ejs--3f0897a8158ba363a0ee0afe4da7c5","dialog-container":"ejs--38cc09882a55e98c76168dbe838aa0","dialog-title":"ejs--b373c9d5029d49324fb8ac3ece96c1","dialog-content":"ejs--a5e2629abb9a5bcbc8b2c1307922d2","dialog-buttons":"ejs--580e3c22e63f8a1eb29694fd0b141b","btn-cancel":"ejs--ad20569e1449d7b8e99e6465960456","btn-reset":"ejs--ad20569e1449d7b8e99e6465963825","btn-clear":"ejs--ad20569e1449d7b8e99e6468571053","btn-close":"ejs--iehanqurh382hriwqoriuehqr83hq9",tabs:"ejs--8e7922427f460a31935084b7acfb1a",active:"ejs--68d337c212ec6a5bc43125440d422b","tabs-content":"ejs--31eb28817642bb1bfe0a2c422108bb","tabs-panel":"ejs--f932566a0af5314da834324c901978","button-container":"ejs--c233fb69cbef43078bc39e9d1efac8","btn-submit":"ejs--bdb54e9fc47f9805b506b746e897bf","btn-create-room":"ejs--67d03ee7480b871ad6507d6319a839","btn-quit":"ejs--c2d931157456c1d438d40a2f66af2c",set:"ejs--6604c83041a275a78837c452a71dd8","btn-join-room":"ejs--99150e15f962c63c689cadc81ef40d","netplay-player-name":"ejs--71527b6509aa48afce3ce1a11c02f0","netplay-player-name-input":"ejs--7ad35768e3f6b9faf97db01d5b60ae","netplay-player-name-set":"ejs--9c403e5e107a3e4374ba244b636400","netplay-roomlist":"ejs--d6a46533fa6e510a571af5c28b440a","netplay-create-room":"ejs--57ca9b3853cc7de731483cfcc95a59","netplay-room-name-input":"ejs--0885d5e25e19127b6b516014426a1b","netplay-room-password-input":"ejs--25023d28756fdb9dfbbfb6dccb8677","netplay-create-room-set":"ejs--75b3a8d35aacc6424ed7422fdeaaaa","netplay-room":"ejs--eefdf28d69ed2d20f197308981bb61","cheats-add":"ejs--9e670880bb57e824400fa00f09aaad","cheats-list":"ejs--2b4e3c245b7b25dfdac5e09155a68e","cheat-code-input":"ejs--572b0b3a0345a6b01b01a15a02842c","cheat-name-input":"ejs--a7d7f80c8999469c991ea452a85dd9",ejs__widgets:"ejs--952c974392296e7f643d51db380157",ejs__widget:"ejs--0d7e216cf12ae73705b5d5bb0452fc",ejs__widget_controls_toggle:"ejs--666d4296310579687cf3cf3d2cf951",ejs__widget_netplay:"ejs--c0a5e71f6613caab66d6ae15a5a00f","virtual-gamepad":"ejs--2440e3b831017ff8327c939e2a4413",top:"ejs--b8d8b771d0bbb94e2bbd03054f53fd",left:"ejs--c83d70cb63c933edc073c7fe92e32b",buttons:"ejs--6e7015634623fd6a82e6a7d3488c84",center:"ejs--49fa47c86a131e4ca8fb268bfdde89",right:"ejs--7d2b19f77fd0ccabf94dc1ca39ae18",touch:"ejs--d708d9d486f1eca73a593d5c09f8ad",modal:"ejs--eefec939452eb92fad035932d0f47c",modal__overlay:"ejs--f1f43b27384834c8c22c6f81d0c5ae",modal__container:"ejs--c4ee33766a01ed0356c3ec07898e96",modal__header:"ejs--a073f32023da1ced805c5f95a4e81c",modal__footer:"ejs--ed44f59bb8cd49177586b140658c6c",modal__title:"ejs--81470ba5e6a6d68014839ad4d9a977",modal__close:"ejs--c3c85789c2a7f56d8b26dba75b7e1f",modal__content:"ejs--db44f5520e6f4fd0dd34b478bb9ee8",modal__btn:"ejs--319bcec5dee9444e1a2a53d6503b7c","modal__btn-primary":"ejs--eaf3c1cba25d415d92ac48d7db34dd",modal__errmsg:"ejs--940087708c06b6129ce2bfa45f1d89","micromodal-slide":"ejs--bef295f3125e9ba83d4f3677264bae","is-open":"ejs--60c17e0d149099f207b06f27edae6a",mmfadeIn:"ejs--9d7aa2bd5ee276be085e5b2a0bbc2e",mmslideIn:"ejs--8b069266f76099cc6bc220f6ea56cc",mmfadeOut:"ejs--184b7558ffeb569c1790654537477b",mmslideOut:"ejs--379a464ad0e66ea5fc601e5f2fd73e","ejs-switch":"ejs--4c3e63d4005bd8a0468e9c74a35f62","ejs-delete-cheat":"ejs--90bcdd71cd0d2307e9ee0dffa916da","icon--exit-fullscreen":"ejs--2b3dd6e2e26c0f0dc4ac5779dedd5e","ejs--fullscreen-fallback":"ejs--412041671de21945d3e028b6ae84c9","ejs--no-transition":"ejs--33643265135cf89e6c0a0d9866d6f1","ejs__sr-only":"ejs--6f0e996cd15e5fb6be0256918531d7","ejs-fade-in":"ejs--7cadf43f3d9eb17c7e3c36de84973b","dpad-container":"ejs--914358605501b11476e86626b2ff16","dpad-bg":"ejs--be66239219d594001da38f91c9ad02","dpad-front":"ejs--9dbb9be3403878e912527181e2d41b","dpad-1":"ejs--f9c7797bdf05569bdc13b4f2074270","dpad-2":"ejs--2645f3bad105488a313c5e30dab74f","dpad-1-bg":"ejs--a57cf324c8ff108947112e35e589b5","dpad-2-bg":"ejs--4873d94c18140ab195da609b40b71a","dpad-left":"ejs--bd9311b0a4f654af6ab5ba28bcf358","dpad-right":"ejs--704d45ea060cc6809451a0d9d47ad7","dpad-up":"ejs--f0b89ca5b5621659af184c8e012ccb","dpad-down":"ejs--8de361d6b01eaa181f8db4ac3eb7af"}},function(e,t,n){var o;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}o=function(){function e(){}function l(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=l.id,l.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function o(e,t){var n=this;return n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=e,n.id=o.id,o.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1},n.config(t),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}function t(e){var t,o=this;return o.ids={},o.index=0,o.collections=[],o.config(e),o.prepareCollections(),u.bindEvt(window,"resize",function(e){clearTimeout(t),t=setTimeout(function(){var t,n=u.getScroll();o.collections.forEach(function(e){e.forEach(function(e){t=e.el.getBoundingClientRect(),e.position={x:n.x+t.left,y:n.y+t.top}})})},100)}),o.collections}var a,n=!!("ontouchstart"in window),i=!!window.PointerEvent,s=!!window.MSPointerEvent,r={start:"mousedown",move:"mousemove",end:"mouseup"},c={},u=(i?a={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?a={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(a={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},c=r):a=r,{distance:function(e,t){var n=t.x-e.x,t=t.y-e.y;return Math.sqrt(n*n+t*t)},angle:function(e,t){var n=t.x-e.x,t=t.y-e.y;return u.degrees(Math.atan2(t,n))},findCoord:function(e,t,n){var o={x:0,y:0};return n=u.radians(n),o.x=e.x-t*Math.cos(n),o.y=e.y-t*Math.sin(n),o},radians:function(e){return e*(Math.PI/180)},degrees:function(e){return e*(180/Math.PI)},bindEvt:function(e,t,n){for(var o,a=t.split(/[ ,]+/g),i=0;i<a.length;i+=1)o=a[i],e.addEventListener?e.addEventListener(o,n,!1):e.attachEvent&&e.attachEvent(o,n)},unbindEvt:function(e,t,n){for(var o,a=t.split(/[ ,]+/g),i=0;i<a.length;i+=1)o=a[i],e.removeEventListener?e.removeEventListener(o,n):e.detachEvent&&e.detachEvent(o,n)},trigger:function(e,t,n){t=new CustomEvent(t,n);e.dispatchEvent(t)},prepareEvent:function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},getScroll:function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},applyPosition:function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},getTransitionStyle:function(e,t,n){var o,a=u.configStylePropertyObject(e);for(o in a)if(a.hasOwnProperty(o))if("string"==typeof t)a[o]=t+" "+n;else{for(var i="",s=0,r=t.length;s<r;s+=1)i+=t[s]+" "+n+", ";a[o]=i.slice(0,-2)}return a},getVendorStyle:function(e,t){var n,o=u.configStylePropertyObject(e);for(n in o)o.hasOwnProperty(n)&&(o[n]=t);return o},configStylePropertyObject:function(t){var n={};return n[t]="",["webkit","Moz","o"].forEach(function(e){n[e+t.charAt(0).toUpperCase()+t.slice(1)]=""}),n},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},safeExtend:function(e,t){var n,o={};for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?o[n]=t[n]:e.hasOwnProperty(n)&&(o[n]=e[n]);return o},map:function(e,t){if(e.length)for(var n=0,o=e.length;n<o;n+=1)t(e[n]);else t(e)}}),d=(e.prototype.on=function(e,t){var n,o=this,a=e.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var i=0;i<a.length;i+=1)n=a[i],o._handlers_[n]=o._handlers_[n]||[],o._handlers_[n].push(t);return o},e.prototype.off=function(e,t){var n=this;return n._handlers_=n._handlers_||{},void 0===e?n._handlers_={}:void 0===t?n._handlers_[e]=null:n._handlers_[e]&&0<=n._handlers_[e].indexOf(t)&&n._handlers_[e].splice(n._handlers_[e].indexOf(t),1),n},e.prototype.trigger=function(e,t){var n,o=this,a=e.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var i=0;i<a.length;i+=1)n=a[i],o._handlers_[n]&&o._handlers_[n].length&&o._handlers_[n].forEach(function(e){e.call(o,{type:n,target:o},t)})},e.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=u.safeExtend(this.options,e))},e.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},u.bindEvt(e,a[t],n._domHandlers_[t]),c[t]&&u.bindEvt(e,c[t],n._domHandlers_[t]),n},e.prototype.unbindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},u.unbindEvt(e,a[t],n._domHandlers_[t]),c[t]&&u.unbindEvt(e,c[t],n._domHandlers_[t]),delete n._domHandlers_[t],this},l.prototype=new e,(l.constructor=l).id=0,l.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},l.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=u.getVendorStyle("borderRadius","50%"),e=u.getTransitionStyle("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},u.extend(n.el,e),u.extend(n.back,t),u.extend(n.front,t),this.applyStyles(n),this},l.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},l.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},l.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},l.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},l.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},l.prototype.hide=function(t){var n=this;return n.options.dataOnly||(n.ui.el.style.opacity=n.options.restOpacity,clearTimeout(n.removeTimeout),clearTimeout(n.showTimeout),clearTimeout(n.restTimeout),n.removeTimeout=setTimeout(function(){var e="dynamic"===n.options.mode?"none":"block";n.ui.el.style.display=e,"function"==typeof t&&t.call(n),n.trigger("hidden",n.instance)},n.options.fadeTime),n.options.restJoystick&&n.restPosition()),n},l.prototype.restPosition=function(e){var t=this,n=(t.frontPosition={x:0,y:0},t.options.fadeTime+"ms"),o={},n=(o.front=u.getTransitionStyle("transition",["top","left"],n),{front:{}});n.front={left:t.frontPosition.x+"px",top:t.frontPosition.y+"px"},t.applyStyles(o),t.applyStyles(n),t.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(t),t.restCallback()},t.options.fadeTime)},l.prototype.restCallback=function(){var e={};e.front=u.getTransitionStyle("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},l.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},l.prototype.computeDirection=function(e){var t,n,o,a=e.angle.radian,i=Math.PI/4,s=Math.PI/2;if(i<a&&a<3*i&&!e.lockX?t="up":-i<a&&a<=i&&!e.lockY?t="left":3*-i<a&&a<=-i&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=-s<a&&a<s?"left":"right"),e.lockX||(o=0<a?"up":"down"),e.force>this.options.threshold){var r={};for(l in this.direction)this.direction.hasOwnProperty(l)&&(r[l]=this.direction[l]);var l,c={};for(l in this.direction={x:n,y:o,angle:t},e.direction=this.direction,r)r[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+o,e),c.angle||this.trigger("dir dir:"+t,e)}return e},o.prototype=new e,(o.constructor=o).id=0,o.prototype.prepareNipples=function(){var e=this,o=e.nipples;o.on=e.on.bind(e),o.off=e.off.bind(e),o.options=e.options,o.destroy=e.destroy.bind(e),o.ids=e.ids,o.id=e.id,o.processOnMove=e.processOnMove.bind(e),o.processOnEnd=e.processOnEnd.bind(e),o.get=function(e){if(void 0===e)return o[0];for(var t=0,n=o.length;t<n;t+=1)if(o[t].identifier===e)return o[t];return!1}},o.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},o.prototype.begin=function(){var e=this.options;"static"===e.mode&&((e=this.createNipple(e.position,this.manager.getIdentifier())).add(),this.idles.push(e))},o.prototype.createNipple=function(e,t){var n,o=this,a=u.getScroll(),i={},s=o.options,r=(e.x&&e.y?i={x:e.x-(a.x+o.box.left),y:e.y-(a.y+o.box.top)}:(e.top||e.right||e.bottom||e.left)&&((r=document.createElement("DIV")).style.display="hidden",r.style.top=e.top,r.style.right=e.right,r.style.bottom=e.bottom,r.style.left=e.left,r.style.position="absolute",s.zone.appendChild(r),n=r.getBoundingClientRect(),s.zone.removeChild(r),i=e,e={x:n.left+a.x,y:n.top+a.y}),new l(o,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0}}));return s.dataOnly||(u.applyPosition(r.ui.el,i),u.applyPosition(r.ui.front,r.frontPosition)),o.nipples.push(r),o.trigger("added "+r.identifier+":added",r),o.manager.trigger("added "+r.identifier+":added",r),o.bindNipple(r),r},o.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},o.prototype.bindNipple=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,o.trigger(n,t)}var n,o=this;e.on("destroyed",o.onDestroyed.bind(o)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},o.prototype.pressureFn=function(t,n,e){var o=this,a=0;clearInterval(o.pressureIntervals[e]),o.pressureIntervals[e]=setInterval(function(){var e=t.force||t.pressure||t.webkitForce||0;e!==a&&(n.trigger("pressure",e),o.trigger("pressure "+n.identifier+":pressure",e),a=e)}.bind(o),100)},o.prototype.onstart=function(e){var t=this,n=t.options;return e=u.prepareEvent(e),t.updateBox(),u.map(e,function(e){t.actives.length<n.maxNumberOfNipples&&t.processOnStart(e)}),t.manager.bindDocument(),!1},o.prototype.processOnStart=function(t){function e(e){e.trigger("start",e),n.trigger("start "+e.id+":start",e),e.show(),0<i&&n.pressureFn(t,e,e.identifier),n.processOnMove(t)}var n=this,o=n.options,a=n.manager.getIdentifier(t),i=t.force||t.pressure||t.webkitForce||0,s={x:t.pageX,y:t.pageY},r=n.getOrCreate(a,s);r.identifier!==a&&n.manager.removeIdentifier(r.identifier),r.identifier=a;if(0<=(a=n.idles.indexOf(r))&&n.idles.splice(a,1),n.actives.push(r),n.ids.push(r.identifier),"semi"!==o.mode)e(r);else{if(!(u.distance(s,r.position)<=o.catchDistance))return r.destroy(),void n.processOnStart(t);e(r)}return r},o.prototype.getOrCreate=function(e,t){var n,o=this,a=o.options;return/(semi|static)/.test(a.mode)?(n=o.idles[0])?(o.idles.splice(0,1),n):"semi"===a.mode?o.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):o.createNipple(t,e)},o.prototype.processOnMove=function(e){var t=this,n=t.options,o=t.manager.getIdentifier(e),a=t.nipples.get(o);if(!a)return console.error("Found zombie joystick with ID "+o),void t.manager.removeIdentifier(o);a.identifier=o;var o=a.options.size/2,i={x:e.pageX,y:e.pageY},s=u.distance(i,a.position),r=u.angle(i,a.position),l=u.radians(r),c=s/o,o=(i=o<s?u.findCoord(a.position,s=o,r):i).x-a.position.x,d=i.y-a.position.y,o=(n.lockX&&(d=0),n.lockY&&(o=0),a.frontPosition={x:o,y:d},n.dataOnly||u.applyPosition(a.ui.front,a.frontPosition),{identifier:a.identifier,position:i,force:c,pressure:e.force||e.pressure||e.webkitForce||0,distance:s,angle:{radian:l,degree:r},instance:a,lockX:n.lockX,lockY:n.lockY});(o=a.computeDirection(o)).angle={radian:u.radians(180-r),degree:180-r},a.trigger("move",o),t.trigger("move "+a.id+":move",o)},o.prototype.processOnEnd=function(e){var t=this,n=t.options,e=t.manager.getIdentifier(e),o=t.nipples.get(e),e=t.manager.removeIdentifier(o.identifier);o&&(n.dataOnly||o.hide(function(){"dynamic"===n.mode&&(o.trigger("removed",o),t.trigger("removed "+o.id+":removed",o),t.manager.trigger("removed "+o.id+":removed",o),o.destroy())}),clearInterval(t.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),t.trigger("end "+o.id+":end",o),0<=t.ids.indexOf(o.identifier)&&t.ids.splice(t.ids.indexOf(o.identifier),1),0<=t.actives.indexOf(o)&&t.actives.splice(t.actives.indexOf(o),1),/(semi|static)/.test(n.mode)?t.idles.push(o):0<=t.nipples.indexOf(o)&&t.nipples.splice(t.nipples.indexOf(o),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[e.id]=e.identifier))},o.prototype.onDestroyed=function(e,t){var n=this;0<=n.nipples.indexOf(t)&&n.nipples.splice(n.nipples.indexOf(t),1),0<=n.actives.indexOf(t)&&n.actives.splice(n.actives.indexOf(t),1),0<=n.idles.indexOf(t)&&n.idles.splice(n.idles.indexOf(t),1),0<=n.ids.indexOf(t.identifier)&&n.ids.splice(n.ids.indexOf(t.identifier),1),n.manager.removeIdentifier(t.identifier),n.manager.unbindDocument()},o.prototype.destroy=function(){var e,t=this;for(e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(e){e.destroy()}),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()},t.prototype=new e,(t.constructor=t).prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every(function(e){return!(n=e.get(t))}),n}},t.prototype.create=function(e){return this.createCollection(e)},t.prototype.createCollection=function(e){e=new o(this,e);return this.bindCollection(e),this.collections.push(e),e},t.prototype.bindCollection=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,o.trigger(n,t)}var n,o=this;e.on("destroyed",o.onDestroyed.bind(o)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},t.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},t.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},t.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},t.prototype.removeIdentifier=function(e){var t,n={};for(t in this.ids)if(this.ids[t]===e){n.id=t,n.identifier=this.ids[t],delete this.ids[t];break}return n},t.prototype.onmove=function(e){return this.onAny("move",e),!1},t.prototype.onend=function(e){return this.onAny("end",e),!1},t.prototype.oncancel=function(e){return this.onAny("end",e),!1},t.prototype.onAny=function(e,t){var n,o=this,a="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=u.prepareEvent(t);return u.map(t,function(e){n=o.getIdentifier(e),u.map(o.collections,function(e,t,n){0<=n.ids.indexOf(t)&&(n[a](e),e._found_=!0)}.bind(null,e,n)),e._found_||o.removeIdentifier(n)}),!1},t.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(e){e.destroy()}),e.off()},t.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)},new t);return{create:function(e){return d.create(e)},factory:d}},"object"==a(t)&&void 0!==e?e.exports=o():void 0!==(t="function"==typeof(o=o)?o.apply(t,[]):o)&&(e.exports=t)},null,function(e){e.exports=class{constructor(){console.log(this)}token(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}open(e,t){this.password=this.password||"",this.userid=e,this.connectedCB=t,this.isInitiator=!0,this.openSocket(()=>{this.socket.send("OpenRoom\n"+this.extra.room_name+"\n"+this.extra.name+"\n"+this.extra.domain+"\n"+this.extra.game_id+"\n"+this.maxParticipantsAllowed+"\n"+this.password)})}join(e,t){this.extra.room_name=e,this.password=this.password||"",this.userid=this.token(),this.connectedCB=t,this.isInitiator=!1,this.openSocket(()=>{this.socket.send("JoinRoom\n"+this.extra.room_name+"\n"+this.extra.name+"\n"+this.extra.domain+"\n"+this.extra.game_id+"\n"+this.maxParticipantsAllowed+"\n"+this.password)})}openSocket(e){this.socket=new WebSocket(this.socketURL),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",e),this.socket.addEventListener("error",this.onError.bind(this)),this.socket.addEventListener("message",this.onMessage.bind(this))}onError(e){console.log(e)}onMessage(e){let t;try{t=JSON.parse(e.data)}catch(e){}t&&!t.msg&&console.log(t),this.connectedCB?("Connected"===e.data?(this.peers={},this.peers[this.userid]={extra:this.extra,userid:this.userid},this.isInitiator||this.socket.send(JSON.stringify({type:"join",userid:this.userid,extra:this.extra})),this.onopen(this.userid),this.connectedCB(!0)):this.connectedCB(!1,null,"Error"),this.connectedCB=null):t&&t.msg?this.userid!==t.user&&this.onmessage(t.data):t&&"join"===t.type?(this.peers[t.userid]={extra:t.extra,userid:t.userid},this.isInitiator&&this.socket.send(JSON.stringify({type:"peersSync",peers:this.peers})),this.onopen(t.userid)):t&&"incoming-file"===t.type?(this.incomingFile={name:t.name},this.onFileStart({name:t.name})):t&&"file-data"===t.type?this.incomingFile.data=Uint8Array.from(t.data):t&&"file-end"===t.type?(this.onFileEnd({name:this.incomingFile.name,data:Uint8Array.from(this.incomingFile.data)}),this.incomingFile=null):t&&"peersSync"===t.type&&(this.peers=t.peers)}send(e){this.socket.send(JSON.stringify({data:e,user:this.userid,msg:!0}))}shareFile(t){this.socket.send(JSON.stringify({type:"incoming-file",name:t.name})),t.arrayBuffer().then(e=>{this.socket.send(JSON.stringify({type:"file-data",data:Array.from(new Uint8Array(e))})),this.socket.send(JSON.stringify({type:"file-end",name:t.name}))})}updateExtraData(){console.log(arguments)}}},function(p,a,s){"use strict";for(var m in window.EJS_RESET_VARS=[],window)window.EJS_RESET_VARS.push(m);s.r(a);function t(e){return null!=e?e.constructor:null}function n(e,t){return Boolean(e&&t&&e instanceof t)}function h(e){return null==e}function v(e){return t(e)===Object}function b(e){return t(e)===String}function _(e){return Array.isArray(e)}function w(e){return n(e,NodeList)}function x(e){return h(e)||(b(e)||_(e)||w(e))&&!e.length||v(e)&&!Object.keys(e).length}let S={volume:.5,muted:!1,i18n:{restart:"Restart",play:"Play",pause:"Pause",played:"Played",volume:"Volume",mute:"Mute (F9)",unmute:"Unmute (F9)",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",settings:"Settings",saveState:"Save State (Shift + F2)",loadState:"Load State (Shift + F4)",screenRecord:"Start Screen Recording",cacheManager:"Cache Manager",netplay:"Netplay",gamepad:"Control Settings",cheat:"Cheats",menuBack:"Go back to previous menu",normal:"Normal",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",playNow:"Start Game"},listeners:{play:null,pause:null,restart:null,rewind:null,mute:null,volume:null,fullscreen:null},events:["ready"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".ejs",controls:{container:null,wrapper:".jes__controls"},buttons:{play:'[data-btn="play"]',pause:'[data-btn="pause"]',mute:'[data-btn="mute"]',fullscreen:'[data-btn="fullscreen"]',settings:'[data-btn="settings"]',saveState:'[data-btn="save-state"]',loadState:'[data-btn="load-state"]',screenRecord:'[data-btn="screen-record"]',cacheManager:'[data-btn="cache-manager"]',gamepad:'[data-btn="gamepad"]',netplay:'[data-btn="netplay"]',cheat:'[data-btn="cheat"]'},inputs:{volume:'[data-range="volume"]'}},classNames:{type:"ejs--video",video:"ejs__video-wrapper",poster:"ejs__poster",posterEnabled:"ejs__poster-enabled",control:"ejs__control",controlPressed:"ejs__control--pressed",playing:"ejs--playing",paused:"ejs--paused",stopped:"ejs--stopped",loading:"ejs--loading",hover:"ejs--hover",tooltip:"ejs__tooltip",hidden:"ejs__sr-only",hideControls:"ejs--hide-controls",isIos:"ejs--is-ios",isTouch:"ejs--is-touch",uiSupported:"ejs--full-ui",noTransition:"ejs--no-transition",menu:{value:"ejs__menu__value",badge:"ejs__badge",open:"ejs--menu-open"},fullscreen:{enabled:"ejs--fullscreen-enabled",fallback:"ejs--fullscreen-fallback"},tabFocus:"ejs__tab-focus"}},j=s(0),T=s(157),E=s.n(T),D={nullOrUndefined:h,object:v,number:function(e){return t(e)===Number&&!Number.isNaN(e)},string:b,boolean:function(e){return t(e)===Boolean},function:function(e){return t(e)===Function},array:_,weakMap:function(e){return n(e,WeakMap)},nodeList:w,element:function(e){return n(e,Element)},textNode:function(e){return t(e)===Text},event:function(e){return n(e,Event)},keyboardEvent:function(e){return n(e,KeyboardEvent)},cue:function(e){return n(e,window.TextTrackCue)||n(e,window.VTTCue)},track:function(e){return n(e,TextTrack)||!h(e)&&b(e.kind)},url:function(e){if(n(e,window.URL))return!0;let t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!x(new URL(t).hostname)}catch(e){return!1}},empty:x},C=function(){let e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){return e=!0,null}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function l(n,o,a){let i=this,s=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],l=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if(n&&"addEventListener"in n&&!D.empty(o)&&D.function(a)){let e=o.split(" "),t=l;C&&(t={passive:r,capture:l}),e.forEach(function(e){i&&i.eventListeners&&s&&i.eventListeners.push({element:n,type:e,callback:a,options:t}),n[s?"addEventListener":"removeEventListener"](e,a)})}}function F(e){l.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!0,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function M(e){l.call(this,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",2<arguments.length?arguments[2]:void 0,!1,!(3<arguments.length&&void 0!==arguments[3])||arguments[3],4<arguments.length&&void 0!==arguments[4]&&arguments[4])}function ae(o){let a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length?arguments[2]:void 0,s=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=4<arguments.length&&void 0!==arguments[4]&&arguments[4];l.call(this,o,a,function e(){M(o,a,e,s,r);let t=arguments.length,n=new Array(t);for(let e=0;e<t;e++)n[e]=arguments[e];i.apply(this,n)},!0,s,r)}function B(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};D.element(e)&&!D.empty(t)&&(t=new CustomEvent(t,{bubbles:n,detail:Object.assign({},o,{emulator:this})}),e.dispatchEvent(t))}let I=s(158),O=s.n(I);function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(n,o){let a=[],i=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(i=(e=t.next()).done)&&(a.push(e.value),!o||a.length!==o);i=!0);}catch(e){t=!0,s=e}finally{try{i||null==_0x557ef0.return||_0x557ef0.return()}finally{if(t)throw s}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function A(e,i){e=e.length?e:[e];Array.from(e).reverse().forEach(function(e,t){let n=0<t?i.cloneNode(!0):i,o=e.parentNode,a=e.nextSibling;n.appendChild(e),a?o.insertBefore(n,a):o.appendChild(n)})}function R(n,e){D.element(n)&&!D.empty(e)&&Object.entries(e).filter(function(e){e=P(e,2)[1];return!D.nullOrUndefined(e)}).forEach(function(e){var e=P(e,2),t=e[0],e=e[1];return n.setAttribute(t,e)})}function U(e,t,n){let o=document.createElement(e);return D.object(t)&&R(o,t),D.string(n)&&(o.innerText=n),o}function N(e){D.nodeList(e)||D.array(e)?Array.from(e).forEach(N):D.element(e)&&D.element(e.parentNode)&&e.parentNode.removeChild(e)}function z(e,t){if(!D.string(e)||D.empty(e))return{};let s={},r=t;return e.split(",").forEach(function(e){let t=e.trim(),n=t.replace(".",""),o=t.replace(/[[\]]/g,"").split("="),a=o[0],i=1<o.length?o[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":D.object(r)&&D.string(r.class)&&(r.class+=" ".concat(n)),s.class=n;break;case"#":s.id=t.replace("#","");break;case"[":s[a]=i}}),s}function V(t,n){if(D.element(t)){let e=n;(e=D.boolean(e)?e:!t.hidden)?t.setAttribute("hidden",""):t.removeAttribute("hidden")}}function G(t,n,o){if(D.nodeList(t))return Array.from(t).map(function(e){return G(e,n,o)});if(D.element(t)){let e=void 0!==o?o?"add":"remove":"toggle";return t.classList[e](n),t.classList.contains(n)}return!1}function k(e,t){return D.element(e)&&e.classList.contains(t)}function L(e,t){let n={Element:Element};return(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(e,t)}function c(e){return this.elements.container.querySelectorAll(e)}function H(e){return this.elements.container.querySelector(e)}function ie(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];D.element(e)&&(e.focus(),t&&G(e,this.config.classNames.tabFocus))}function q(e){return E.a.bind(O.a)(e)}let se,re,le,ce=(se=document.createElement("span"),re={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},le=Object.keys(re).find(function(e){return void 0!==se.style[e]}),!!D.string(le)&&re[le]);function de(e){setTimeout(function(){try{V(e,!0),e.offsetHeight,V(e,!1)}catch(e){}},0)}let ue,X={isEdge:"Netscape"===navigator.appName&&-1<navigator.appVersion.indexOf("Edge"),isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform),info:function(){let e=/(MSIE|(?!Gecko.+)Firefox|(?!AppleWebKit.+Chrome.+)Safari|(?!AppleWebKit.+)Chrome|AppleWebKit(?!.+Chrome|.+Safari)|Gecko(?!.+Firefox))(?: |\/)([\d\.apre]+)/.exec(navigator.userAgent);return{name:e[1].toLowerCase(),version:e[2]}}},Y={rangeInput:((ue=document.createElement("input")).type="range")===ue.type,touch:"ontouchstart"in document.documentElement,transitions:!1!==ce,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches,webgl:function(){let i={DETECTED:!1};if(!i.DETECTED){let a=document.createElement("canvas");if(a&&a.getContext)for(let n=["webgl2","experimental-webgl2","webgl","experimental-webgl"],o=0,e=n.length;o<e;++o){let e=n[o],t=a.getContext(e);if(t){i.WEBGL_CONTEXT=e,i.WEBGL_VERSION=t.getParameter(t.VERSION),i.WEBGL_VENDOR=t.getParameter(t.VENDOR),i.WEBGL_SL_VERSION=t.getParameter(t.SHADING_LANGUAGE_VERSION),i.MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE);var s=t.getExtension("WEBGL_debug_renderer_info");s&&(i.WEBGL_VENDOR=t.getParameter(s.UNMASKED_VENDOR_WEBGL),i.WEBGL_RENDERER=t.getParameter(s.UNMASKED_RENDERER_WEBGL)),i.DETECTED=!0;break}}}return i}(),wasm:"undefined"!=typeof WebAssembly&&D.object(WebAssembly),audioContext:"undefined"!=typeof AudioContext};function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(){let t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=new Array(1<a?a-1:0);for(let e=arguments.length,t=1;t<e;t++)n[t-1]=arguments[t];if(!n.length)return t;let o=n.shift();return D.object(o)?(Object.keys(o).forEach(function(e){D.object(o[e])?(Object.keys(t).includes(e)||Object.assign(t,fe({},e,{})),W(t[e],o[e])):Object.assign(t,fe({},e,o[e]))}),W.apply(void 0,[t].concat(n))):t}function pe(e,t,n){let o=0<arguments.length&&void 0!==e?e:"",a=1<arguments.length&&void 0!==t?t:"",i=2<arguments.length&&void 0!==n?n:"";return o.replace(new RegExp(a.toString().replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"),i.toString())}let me={get:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(D.empty(t)||D.empty(n))return"";e=n.i18n;let o=t.split(".").reduce(function(e,t){return e&&e[t]},e);if(D.empty(o))return"";t={"{seektime}":n.seekTime,"{title}":n.title};return Object.entries(t).forEach(function(e){t=2;var e=function(e){if(Array.isArray(e))return e}(e=e)||function(n,o){let a=[],i=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(i=(e=t.next()).done)&&(a.push(e.value),!o||a.length!==o);i=!0);}catch(e){t=!0,s=e}finally{try{i||null==_0x2f59ed.return||_0x2f59ed.return()}finally{if(t)throw s}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),t=e[0],e=e[1];o=pe(o,t,e)}),o}};function he(n,o){for(let t=0;t<o.length;t++){let e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}u=[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.getItem("___test")||window.localStorage.setItem("___test","___test"),!0)}catch(e){return!1}}}],he((e=ye).prototype,[{key:"get",value:function(e){if(!ye.supported||!this.enabled)return null;var t=window.localStorage.getItem(this.key);if(D.empty(t))return null;t=JSON.parse(t);return D.string(e)&&e.length?t[e]:t}},{key:"set",value:function(t){if(ye.supported&&this.enabled&&D.object(t)){let e=this.get();W(e=D.empty(e)?{}:e,t),window.localStorage.setItem(this.key,JSON.stringify(e))}}}]),he(e,u);let ge=ye;function ye(e,t){if(!(this instanceof ye))throw new TypeError("Cannot call a class as a function");this.enabled=!0,this.key=t}let ve,be=s(6),_e=s(159),we=s.n(_e),xe={"2xScaleHQ.glslp":'shaders = 1\n\nshader0 = "2xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"4xScaleHQ.glslp":'shaders = 1\n\nshader0 = "4xScaleHQ.glsl"\nfilter_linear0 = false\nscale_type_0 = source\n',"crt-easymode.glslp":"shaders = 1\n\nshader0 = crt-easymode.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","crt-aperture.glslp":"shaders = 1\n\nshader0 = crt-aperture.glsl\nfilter_linear0 = false\n","crt-geom.glslp":"shaders = 1\n\nshader0 = crt-geom.glsl\nfilter_linear0 = false\nscale_type_0 = source\n","crt-mattias.glslp":"\nshaders = 1\nshader0 = crt-mattias.glsl\nfilter_linear0 = false\n","2xScaleHQ.glsl":"/*\n2xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 dx = vec2(x, 0.0);\nvec2 dy = vec2(0.0, y);\nt1 = vec4(vTexCoord - dg1, vTexCoord - dy);\nt2 = vec4(vTexCoord - dg2, vTexCoord + dx);\nt3 = vec4(vTexCoord + dg1, vTexCoord + dy);\nt4 = vec4(vTexCoord + dg2, vTexCoord - dx);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 0.325;      // start smoothing wt.\nfloat k = -0.250;      // wt. decrease factor\nfloat max_w = 0.25;    // max filter weight\nfloat min_w =-0.05;    // min filter weight\nfloat lum_add = 0.25;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c00 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 c10 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 c20 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 c01 = COMPAT_TEXTURE(Source, t4.zw).xyz; \nvec3 c11 = COMPAT_TEXTURE(Source, vTexCoord).xyz; \nvec3 c21 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 c02 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 c12 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 c22 = COMPAT_TEXTURE(Source, t3.xy).xyz; \n\nfloat md1 = dot(abs(c00 - c22), dt);\nfloat md2 = dot(abs(c02 - c20), dt);\n\nfloat w1 = dot(abs(c22 - c11), dt) * md2;\nfloat w2 = dot(abs(c02 - c11), dt) * md1;\nfloat w3 = dot(abs(c00 - c11), dt) * md2;\nfloat w4 = dot(abs(c20 - c11), dt) * md1;\n\nfloat t1 = w1 + w3;\nfloat t2 = w2 + w4;\nfloat ww = max(t1, t2) + 0.0001;\n\nc11 = (w1 * c00 + w2 * c20 + w3 * c22 + w4 * c02 + ww * c11) / (t1 + t2 + ww);\n\nfloat lc1 = k / (0.12 * dot(c10 + c12 + c11, dt) + lum_add);\nfloat lc2 = k / (0.12 * dot(c01 + c21 + c11, dt) + lum_add);\n\nw1 = clamp(lc1 * dot(abs(c11 - c10), dt) + mx, min_w, max_w);\nw2 = clamp(lc2 * dot(abs(c11 - c21), dt) + mx, min_w, max_w);\nw3 = clamp(lc1 * dot(abs(c11 - c12), dt) + mx, min_w, max_w);\nw4 = clamp(lc2 * dot(abs(c11 - c01), dt) + mx, min_w, max_w);\nFragColor = vec4(w1 * c10 + w2 * c21 + w3 * c12 + w4 * c01 + (1.0 - w1 - w2 - w3 - w4) * c11, 1.0);\n} \n#endif\n","4xScaleHQ.glsl":"/*\n4xGLSLHqFilter shader\n\nCopyright (C) 2005 guest(r) - guest.r@gmail.com\n\nThis program is free software; you can redistribute it and/or\nmodify it under the terms of the GNU General Public License\nas published by the Free Software Foundation; either version 2\nof the License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program; if not, write to the Free Software\nFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n*/\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n// compatibility #defines\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\nTEX0.xy = TexCoord.xy;\nfloat x = 0.5 * SourceSize.z;\nfloat y = 0.5 * SourceSize.w;\nvec2 dg1 = vec2( x, y);\nvec2 dg2 = vec2(-x, y);\nvec2 sd1 = dg1 * 0.5;\nvec2 sd2 = dg2 * 0.5;\nvec2 ddx = vec2(x, 0.0);\nvec2 ddy = vec2(0.0, y);\nt1 = vec4(vTexCoord - sd1, vTexCoord - ddy);\nt2 = vec4(vTexCoord - sd2, vTexCoord + ddx);\nt3 = vec4(vTexCoord + sd1, vTexCoord + ddy);\nt4 = vec4(vTexCoord + sd2, vTexCoord - ddx);\nt5 = vec4(vTexCoord - dg1, vTexCoord - dg2);\nt6 = vec4(vTexCoord + dg1, vTexCoord + dg2);\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\nCOMPAT_VARYING vec4 t1;\nCOMPAT_VARYING vec4 t2;\nCOMPAT_VARYING vec4 t3;\nCOMPAT_VARYING vec4 t4;\nCOMPAT_VARYING vec4 t5;\nCOMPAT_VARYING vec4 t6;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nfloat mx = 1.0;      // start smoothing wt.\nfloat k = -1.10;      // wt. decrease factor\nfloat max_w = 0.75;    // max filter weight\nfloat min_w = 0.03;    // min filter weight\nfloat lum_add = 0.33;  // affects smoothing\nvec3 dt = vec3(1.0);\n\nvoid main()\n{\nvec3 c  = COMPAT_TEXTURE(Source, vTexCoord).xyz;\nvec3 i1 = COMPAT_TEXTURE(Source, t1.xy).xyz; \nvec3 i2 = COMPAT_TEXTURE(Source, t2.xy).xyz; \nvec3 i3 = COMPAT_TEXTURE(Source, t3.xy).xyz; \nvec3 i4 = COMPAT_TEXTURE(Source, t4.xy).xyz; \nvec3 o1 = COMPAT_TEXTURE(Source, t5.xy).xyz; \nvec3 o3 = COMPAT_TEXTURE(Source, t6.xy).xyz; \nvec3 o2 = COMPAT_TEXTURE(Source, t5.zw).xyz;\nvec3 o4 = COMPAT_TEXTURE(Source, t6.zw).xyz;\nvec3 s1 = COMPAT_TEXTURE(Source, t1.zw).xyz; \nvec3 s2 = COMPAT_TEXTURE(Source, t2.zw).xyz; \nvec3 s3 = COMPAT_TEXTURE(Source, t3.zw).xyz; \nvec3 s4 = COMPAT_TEXTURE(Source, t4.zw).xyz; \n\nfloat ko1=dot(abs(o1-c),dt);\nfloat ko2=dot(abs(o2-c),dt);\nfloat ko3=dot(abs(o3-c),dt);\nfloat ko4=dot(abs(o4-c),dt);\n\nfloat k1=min(dot(abs(i1-i3),dt),max(ko1,ko3));\nfloat k2=min(dot(abs(i2-i4),dt),max(ko2,ko4));\n\nfloat w1 = k2; if(ko3<ko1) w1*=ko3/ko1;\nfloat w2 = k1; if(ko4<ko2) w2*=ko4/ko2;\nfloat w3 = k2; if(ko1<ko3) w3*=ko1/ko3;\nfloat w4 = k1; if(ko2<ko4) w4*=ko2/ko4;\n\nc=(w1*o1+w2*o2+w3*o3+w4*o4+0.001*c)/(w1+w2+w3+w4+0.001);\nw1 = k*dot(abs(i1-c)+abs(i3-c),dt)/(0.125*dot(i1+i3,dt)+lum_add);\nw2 = k*dot(abs(i2-c)+abs(i4-c),dt)/(0.125*dot(i2+i4,dt)+lum_add);\nw3 = k*dot(abs(s1-c)+abs(s3-c),dt)/(0.125*dot(s1+s3,dt)+lum_add);\nw4 = k*dot(abs(s2-c)+abs(s4-c),dt)/(0.125*dot(s2+s4,dt)+lum_add);\n\nw1 = clamp(w1+mx,min_w,max_w); \nw2 = clamp(w2+mx,min_w,max_w);\nw3 = clamp(w3+mx,min_w,max_w); \nw4 = clamp(w4+mx,min_w,max_w);\n\nFragColor = vec4((w1*(i1+i3)+w2*(i2+i4)+w3*(s1+s3)+w4*(s2+s4)+c)/(2.0*(w1+w2+w3+w4)+1.0), 1.0);\n} \n#endif\n","crt-easymode.glsl":"#if defined(VERTEX)\n\n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING out\n    #define COMPAT_ATTRIBUTE in\n    #define COMPAT_TEXTURE texture\n    #else\n    #define COMPAT_VARYING varying\n    #define COMPAT_ATTRIBUTE attribute\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _oPosition1;\n    vec4 _r0005;\n    COMPAT_ATTRIBUTE vec4 VertexCoord;\n    COMPAT_ATTRIBUTE vec4 TexCoord;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform mat4 MVPMatrix;\n    uniform int FrameDirection;\n    uniform int FrameCount;\n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _oTex;\n    _r0005 = VertexCoord.x*MVPMatrix[0];\n    _r0005 = _r0005 + VertexCoord.y*MVPMatrix[1];\n    _r0005 = _r0005 + VertexCoord.z*MVPMatrix[2];\n    _r0005 = _r0005 + VertexCoord.w*MVPMatrix[3];\n    _oPosition1 = _r0005;\n    _oTex = TexCoord.xy;\n    gl_Position = _r0005;\n    TEX0.xy = TexCoord.xy;\n    }\n    #elif defined(FRAGMENT)\n    \n    #if __VERSION__ >= 130\n    #define COMPAT_VARYING in\n    #define COMPAT_TEXTURE texture\n    out vec4 FragColor;\n    #else\n    #define COMPAT_VARYING varying\n    #define FragColor gl_FragColor\n    #define COMPAT_TEXTURE texture2D\n    #endif\n    \n    #ifdef GL_ES\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n    #define COMPAT_PRECISION mediump\n    #else\n    #define COMPAT_PRECISION\n    #endif\n    COMPAT_VARYING     float _frame_rotation;\n    struct input_dummy {\n    vec2 _video_size;\n    vec2 _texture_size;\n    vec2 _output_dummy_size;\n    float _frame_count;\n    float _frame_direction;\n    float _frame_rotation;\n    };\n    vec4 _ret_0;\n    float _TMP30;\n    float _TMP29;\n    float _TMP28;\n    float _TMP13;\n    float _TMP32;\n    float _TMP11;\n    float _TMP10;\n    float _TMP31;\n    float _TMP9;\n    float _TMP8;\n    float _TMP15;\n    float _TMP14;\n    float _TMP33;\n    vec4 _TMP34;\n    vec4 _TMP27;\n    vec4 _TMP25;\n    vec4 _TMP23;\n    vec4 _TMP21;\n    vec4 _TMP26;\n    vec4 _TMP24;\n    vec4 _TMP22;\n    vec4 _TMP20;\n    float _TMP4;\n    vec4 _TMP3;\n    vec4 _TMP2;\n    float _TMP19;\n    float _TMP18;\n    float _TMP17;\n    float _TMP16;\n    vec4 _TMP1;\n    vec2 _TMP0;\n    uniform sampler2D Texture;\n    input_dummy _IN1;\n    float _TMP43;\n    float _x_step0044;\n    float _curve0044;\n    float _a0048;\n    float _val0052;\n    float _a0052;\n    vec4 _TMP57;\n    vec4 _x0072;\n    vec2 _c0086;\n    vec4 _x0088;\n    vec4 _x0094;\n    vec2 _c0098;\n    vec4 _x0100;\n    vec2 _c0104;\n    vec4 _x0106;\n    vec4 _sample_min0110;\n    vec4 _sample_max0110;\n    vec4 _r0112;\n    vec4 _TMP117;\n    vec2 _co0124;\n    vec2 _c0126;\n    vec4 _x0128;\n    vec4 _x0134;\n    vec2 _c0138;\n    vec4 _x0140;\n    vec2 _c0144;\n    vec4 _x0146;\n    vec4 _sample_min0150;\n    vec4 _sample_max0150;\n    vec4 _r0152;\n    vec4 _TMP157;\n    float _TMP163;\n    float _x_step0164;\n    float _curve0164;\n    float _a0168;\n    float _val0172;\n    float _a0172;\n    float _TMP183;\n    float _TMP189;\n    float _x0190;\n    float _a0196;\n    float _x0198;\n    vec2 _x0200;\n    float _x0208;\n    COMPAT_VARYING vec4 TEX0;\n    \n    uniform COMPAT_PRECISION vec2 OutputSize;\n    uniform COMPAT_PRECISION vec2 TextureSize;\n    uniform COMPAT_PRECISION vec2 InputSize;\n    void main()\n    {\n    vec2 _dx1;\n    vec2 _dy;\n    vec2 _pix_co;\n    vec2 _tex_co;\n    vec2 _dist;\n    vec3 _col2;\n    vec3 _col21;\n    vec4 _coeffs1;\n    float _luma;\n    float _bright;\n    float _scan_weight;\n    vec2 _mod_fac;\n    int _dot_no;\n    vec3 _mask_weight;\n    vec3 _TMP37;\n    _dx1 = vec2(1.00000000E+00/TextureSize.x, 0.00000000E+00);\n    _dy = vec2(0.00000000E+00, 1.00000000E+00/TextureSize.y);\n    _pix_co = TEX0.xy*TextureSize - vec2( 5.00000000E-01, 5.00000000E-01);\n    _TMP0 = floor(_pix_co);\n    _tex_co = (_TMP0 + vec2( 5.00000000E-01, 5.00000000E-01))/TextureSize;\n    _dist = fract(_pix_co);\n    _x_step0044 = float((_dist.x >= 5.00000000E-01));\n    _a0048 = 2.50000000E-01 - (_dist.x - _x_step0044)*(_dist.x - _x_step0044);\n    _TMP33 = inversesqrt(_a0048);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0052 = 5.00000000E-01 - _dist.x;\n    _val0052 = float((_a0052 > 0.00000000E+00));\n    _TMP15 = _val0052 - float((_a0052 < 0.00000000E+00));\n    _curve0044 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP43 = _dist.x + 2.50000000E-01*(_curve0044 - _dist.x);\n    _coeffs1 = 3.14159274E+00*vec4(1.00000000E+00 + _TMP43, _TMP43, 1.00000000E+00 - _TMP43, 2.00000000E+00 - _TMP43);\n    _TMP1 = abs(_coeffs1);\n    _TMP57 = max(_TMP1, vec4( 9.99999975E-06, 9.99999975E-06, 9.99999975E-06, 9.99999975E-06));\n    _TMP16 = sin(_TMP57.x);\n    _TMP17 = sin(_TMP57.y);\n    _TMP18 = sin(_TMP57.z);\n    _TMP19 = sin(_TMP57.w);\n    _TMP2 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _x0072 = _TMP57/2.00000000E+00;\n    _TMP16 = sin(_x0072.x);\n    _TMP17 = sin(_x0072.y);\n    _TMP18 = sin(_x0072.z);\n    _TMP19 = sin(_x0072.w);\n    _TMP3 = vec4(_TMP16, _TMP17, _TMP18, _TMP19);\n    _coeffs1 = ((2.00000000E+00*_TMP2)*_TMP3)/(_TMP57*_TMP57);\n    _TMP4 = dot(_coeffs1, vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _coeffs1 = _coeffs1/_TMP4;\n    _c0086 = _tex_co - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0086);\n    _x0088 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0088;\n    _TMP22 = COMPAT_TEXTURE(Texture, _tex_co);\n    _x0094 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0094;\n    _c0098 = _tex_co + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0098);\n    _x0100 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0100;\n    _c0104 = _tex_co + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0104);\n    _x0106 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0106;\n    _r0112 = _coeffs1.x*_TMP21;\n    _r0112 = _r0112 + _coeffs1.y*_TMP23;\n    _r0112 = _r0112 + _coeffs1.z*_TMP25;\n    _r0112 = _r0112 + _coeffs1.w*_TMP27;\n    _sample_min0110 = min(_TMP23, _TMP25);\n    _sample_max0110 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0110, _r0112);\n    _TMP117 = max(_sample_min0110, _TMP34);\n    _co0124 = _tex_co + _dy;\n    _c0126 = _co0124 - _dx1;\n    _TMP20 = COMPAT_TEXTURE(Texture, _c0126);\n    _x0128 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP20 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP21 = _TMP20*_x0128;\n    _TMP22 = COMPAT_TEXTURE(Texture, _co0124);\n    _x0134 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP22 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP23 = _TMP22*_x0134;\n    _c0138 = _co0124 + _dx1;\n    _TMP24 = COMPAT_TEXTURE(Texture, _c0138);\n    _x0140 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP24 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP25 = _TMP24*_x0140;\n    _c0144 = _co0124 + 2.00000000E+00*_dx1;\n    _TMP26 = COMPAT_TEXTURE(Texture, _c0144);\n    _x0146 = vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00) + (_TMP26 - vec4( 1.00000000E+00, 1.00000000E+00, 1.00000000E+00, 1.00000000E+00));\n    _TMP27 = _TMP26*_x0146;\n    _r0152 = _coeffs1.x*_TMP21;\n    _r0152 = _r0152 + _coeffs1.y*_TMP23;\n    _r0152 = _r0152 + _coeffs1.z*_TMP25;\n    _r0152 = _r0152 + _coeffs1.w*_TMP27;\n    _sample_min0150 = min(_TMP23, _TMP25);\n    _sample_max0150 = max(_TMP23, _TMP25);\n    _TMP34 = min(_sample_max0150, _r0152);\n    _TMP157 = max(_sample_min0150, _TMP34);\n    _x_step0164 = float((_dist.y >= 5.00000000E-01));\n    _a0168 = 2.50000000E-01 - (_dist.y - _x_step0164)*(_dist.y - _x_step0164);\n    _TMP33 = inversesqrt(_a0168);\n    _TMP14 = 1.00000000E+00/_TMP33;\n    _a0172 = 5.00000000E-01 - _dist.y;\n    _val0172 = float((_a0172 > 0.00000000E+00));\n    _TMP15 = _val0172 - float((_a0172 < 0.00000000E+00));\n    _curve0164 = 5.00000000E-01 - _TMP14*_TMP15;\n    _TMP163 = _dist.y + (_curve0164 - _dist.y);\n    _col2 = _TMP117.xyz + _TMP163*(_TMP157.xyz - _TMP117.xyz);\n    _luma = dot(vec3( 2.12599993E-01, 7.15200007E-01, 7.22000003E-02), _col2);\n    _TMP8 = max(_col2.y, _col2.z);\n    _TMP9 = max(_col2.x, _TMP8);\n    _bright = (_TMP9 + _luma)/2.00000000E+00;\n    _TMP31 = min(6.49999976E-01, _bright);\n    _TMP183 = max(3.49999994E-01, _TMP31);\n    _x0190 = _bright*1.50000000E+00;\n    _TMP31 = min(1.50000000E+00, _x0190);\n    _TMP189 = max(1.50000000E+00, _TMP31);\n    _a0196 = TEX0.y*2.00000000E+00*3.14159274E+00*TextureSize.y;\n    _TMP10 = cos(_a0196);\n    _x0198 = _TMP10*5.00000000E-01 + 5.00000000E-01;\n    _TMP11 = pow(_x0198, _TMP189);\n    _scan_weight = 1.00000000E+00 - _TMP11;\n    _x0200 = (TEX0.xy*OutputSize*TextureSize)/InputSize;\n    _mod_fac = floor(_x0200);\n    _x0208 = _mod_fac.x/3.00000000E+00;\n    _TMP32 = floor(_x0208);\n    _TMP13 = _mod_fac.x - 3.00000000E+00*_TMP32;\n    _dot_no = int(_TMP13);\n    if (_dot_no == 0) {\n    _mask_weight = vec3( 1.00000000E+00, 6.99999988E-01, 6.99999988E-01);\n    } else {\n    if (_dot_no == 1) {\n    _mask_weight = vec3( 6.99999988E-01, 1.00000000E+00, 6.99999988E-01);\n    } else {\n    _mask_weight = vec3( 6.99999988E-01, 6.99999988E-01, 1.00000000E+00);\n    }\n    }\n    if (InputSize.y >= 4.00000000E+02) {\n    _scan_weight = 1.00000000E+00;\n    }\n    _col21 = _col2.xyz;\n    _col2 = _col2*vec3(_scan_weight, _scan_weight, _scan_weight);\n    _col2 = _col2 + _TMP183*(_col21 - _col2);\n    _col2 = _col2*_mask_weight;\n    _TMP28 = pow(_col2.x, 5.55555582E-01);\n    _TMP29 = pow(_col2.y, 5.55555582E-01);\n    _TMP30 = pow(_col2.z, 5.55555582E-01);\n    _col2 = vec3(_TMP28, _TMP29, _TMP30);\n    _TMP37 = _col2*1.20000005E+00;\n    _ret_0 = vec4(_TMP37.x, _TMP37.y, _TMP37.z, 1.00000000E+00);\n    FragColor = _ret_0;\n    return;\n    }\n    #endif\n","crt-aperture.glsl":'\n/*\nCRT Shader by EasyMode\nLicense: GPL\n*/\n/*\n#pragma parameter SHARPNESS_IMAGE "Sharpness Image" 1.0 1.0 5.0 1.0\n#pragma parameter SHARPNESS_EDGES "Sharpness Edges" 3.0 1.0 5.0 1.0\n#pragma parameter GLOW_WIDTH "Glow Width" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HEIGHT "Glow Height" 0.5 0.05 0.65 0.05\n#pragma parameter GLOW_HALATION "Glow Halation" 0.1 0.0 1.0 0.01\n#pragma parameter GLOW_DIFFUSION "Glow Diffusion" 0.05 0.0 1.0 0.01\n#pragma parameter MASK_COLORS "Mask Colors" 2.0 2.0 3.0 1.0\n#pragma parameter MASK_STRENGTH "Mask Strength" 0.3 0.0 1.0 0.05\n#pragma parameter MASK_SIZE "Mask Size" 1.0 1.0 9.0 1.0\n#pragma parameter SCANLINE_SIZE_MIN "Scanline Size Min." 0.5 0.5 1.5 0.05\n#pragma parameter SCANLINE_SIZE_MAX "Scanline Size Max." 1.5 0.5 1.5 0.05\n#pragma parameter GAMMA_INPUT "Gamma Input" 2.4 1.0 5.0 0.1\n#pragma parameter GAMMA_OUTPUT "Gamma Output" 2.4 1.0 5.0 0.1\n#pragma parameter BRIGHTNESS "Brightness" 1.5 0.0 2.0 0.05\n* */\n\n#define Coord TEX0\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define OUT out\n#define IN  in\n#define tex2D texture\n#else\n#define OUT varying \n#define IN attribute \n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nIN  vec4 VertexCoord;\nIN  vec4 Color;\nIN  vec2 TexCoord;\nOUT vec4 color;\nOUT vec2 Coord;\n\nuniform mat4 MVPMatrix;\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\n\nvoid main()\n{\ngl_Position = MVPMatrix * VertexCoord;\ncolor = Color;\nCoord = TexCoord;\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define IN in\n#define tex2D texture\nout vec4 FragColor;\n#else\n#define IN varying\n#define FragColor gl_FragColor\n#define tex2D texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define PRECISION mediump\n#else\n#define PRECISION\n#endif\n\nuniform PRECISION int FrameDirection;\nuniform PRECISION int FrameCount;\nuniform PRECISION vec2 OutputSize;\nuniform PRECISION vec2 TextureSize;\nuniform PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nIN vec2 Coord;\n\n#ifdef PARAMETER_UNIFORM\nuniform PRECISION float SHARPNESS_IMAGE;\nuniform PRECISION float SHARPNESS_EDGES;\nuniform PRECISION float GLOW_WIDTH;\nuniform PRECISION float GLOW_HEIGHT;\nuniform PRECISION float GLOW_HALATION;\nuniform PRECISION float GLOW_DIFFUSION;\nuniform PRECISION float MASK_COLORS;\nuniform PRECISION float MASK_STRENGTH;\nuniform PRECISION float MASK_SIZE;\nuniform PRECISION float SCANLINE_SIZE_MIN;\nuniform PRECISION float SCANLINE_SIZE_MAX;\nuniform PRECISION float GAMMA_INPUT;\nuniform PRECISION float GAMMA_OUTPUT;\nuniform PRECISION float BRIGHTNESS;\n#else\n#define SHARPNESS_IMAGE 1.0\n#define SHARPNESS_EDGES 3.0\n#define GLOW_WIDTH 0.5\n#define GLOW_HEIGHT 0.5\n#define GLOW_HALATION 0.1\n#define GLOW_DIFFUSION 0.05\n#define MASK_COLORS 2.0\n#define MASK_STRENGTH 0.3\n#define MASK_SIZE 1.0\n#define SCANLINE_SIZE_MIN 0.5\n#define SCANLINE_SIZE_MAX 1.5\n#define GAMMA_INPUT 2.4\n#define GAMMA_OUTPUT 2.4\n#define BRIGHTNESS 1.5\n#endif\n\n#define FIX(c) max(abs(c), 1e-5)\n#define PI 3.141592653589\n#define saturate(c) clamp(c, 0.0, 1.0)\n#define TEX2D(c) pow(tex2D(tex, c).rgb, vec3(GAMMA_INPUT))\n\nmat3 get_color_matrix(sampler2D tex, vec2 co, vec2 dx)\n{\nreturn mat3(TEX2D(co - dx), TEX2D(co), TEX2D(co + dx));\n}\n\nvec3 blur(mat3 m, float dist, float rad)\n{\nvec3 x = vec3(dist - 1.0, dist, dist + 1.0) / rad;\nvec3 w = exp2(x * x * -1.0);\n\nreturn (m[0] * w.x + m[1] * w.y + m[2] * w.z) / (w.x + w.y + w.z);\n}\n\nvec3 filter_gaussian(sampler2D tex, vec2 co, vec2 tex_size)\n{\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / tex_size.y);\nvec2 pix_co = co * tex_size;\nvec2 tex_co = (floor(pix_co) + 0.5) / tex_size;\nvec2 dist = (fract(pix_co) - 0.5) * -1.0;\n\nmat3 line0 = get_color_matrix(tex, tex_co - dy, dx);\nmat3 line1 = get_color_matrix(tex, tex_co, dx);\nmat3 line2 = get_color_matrix(tex, tex_co + dy, dx);\nmat3 column = mat3(blur(line0, dist.x, GLOW_WIDTH),\n                       blur(line1, dist.x, GLOW_WIDTH),\n                       blur(line2, dist.x, GLOW_WIDTH));\n\nreturn blur(column, dist.y, GLOW_HEIGHT);\n}\n\nvec3 filter_lanczos(sampler2D tex, vec2 co, vec2 tex_size, float sharp)\n{\ntex_size.x *= sharp;\n\nvec2 dx = vec2(1.0 / tex_size.x, 0.0);\nvec2 pix_co = co * tex_size - vec2(0.5, 0.0);\nvec2 tex_co = (floor(pix_co) + vec2(0.5, 0.0)) / tex_size;\nvec2 dist = fract(pix_co);\nvec4 coef = PI * vec4(dist.x + 1.0, dist.x, dist.x - 1.0, dist.x - 2.0);\n\ncoef = FIX(coef);\ncoef = 2.0 * sin(coef) * sin(coef / 2.0) / (coef * coef);\ncoef /= dot(coef, vec4(1.0));\n\nvec4 col1 = vec4(TEX2D(tex_co), 1.0);\nvec4 col2 = vec4(TEX2D(tex_co + dx), 1.0);\n\nreturn (mat4(col1, col1, col2, col2) * coef).rgb;\n}\n\nvec3 get_scanline_weight(float x, vec3 col)\n{\nvec3 beam = mix(vec3(SCANLINE_SIZE_MIN), vec3(SCANLINE_SIZE_MAX), col);\nvec3 x_mul = 2.0 / beam;\nvec3 x_offset = x_mul * 0.5;\n\nreturn smoothstep(0.0, 1.0, 1.0 - abs(x * x_mul - x_offset)) * x_offset;\n}\n\nvec3 get_mask_weight(float x)\n{\nfloat i = mod(floor(x * OutputSize.x * TextureSize.x / (InputSize.x * MASK_SIZE)), MASK_COLORS);\n\nif (i == 0.0) return mix(vec3(1.0, 0.0, 1.0), vec3(1.0, 0.0, 0.0), MASK_COLORS - 2.0);\nelse if (i == 1.0) return vec3(0.0, 1.0, 0.0);\nelse return vec3(0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\nvec3 col_glow = filter_gaussian(Texture, Coord, TextureSize);\nvec3 col_soft = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_IMAGE);\nvec3 col_sharp = filter_lanczos(Texture, Coord, TextureSize, SHARPNESS_EDGES);\nvec3 col = sqrt(col_sharp * col_soft);\n\ncol *= get_scanline_weight(fract(Coord.y * TextureSize.y), col_soft);\ncol_glow = saturate(col_glow - col);\ncol += col_glow * col_glow * GLOW_HALATION;\ncol = mix(col, col * get_mask_weight(Coord.x) * MASK_COLORS, MASK_STRENGTH);\ncol += col_glow * GLOW_DIFFUSION;\ncol = pow(col * BRIGHTNESS, vec3(1.0 / GAMMA_OUTPUT));\n\nFragColor = vec4(col, 1.0);\n}\n\n#endif\n',"crt-geom.glsl":'\n/*\nCRT-interlaced\n\nCopyright (C) 2010-2012 cgwg, Themaister and DOLLS\n\nThis program is free software; you can redistribute it and/or modify it\nunder the terms of the GNU General Public License as published by the Free\nSoftware Foundation; either version 2 of the License, or (at your option)\nany later version.\n\n(cgwg gave their consent to have the original version of this shader\ndistributed under the GPL in this message:\n\nhttp://board.byuu.org/viewtopic.php?p=26075#p26075\n\n"Feel free to distribute my shaders under the GPL. After all, the\nbarrel distortion code was taken from the Curvature shader, which is\nunder the GPL."\n)\nThis shader variant is pre-configured with screen curvature\n*/\n/*\n#pragma parameter CRTgamma "CRTGeom Target Gamma" 2.4 0.1 5.0 0.1\n#pragma parameter monitorgamma "CRTGeom Monitor Gamma" 2.2 0.1 5.0 0.1\n#pragma parameter d "CRTGeom Distance" 1.6 0.1 3.0 0.1\n#pragma parameter CURVATURE "CRTGeom Curvature Toggle" 1.0 0.0 1.0 1.0\n#pragma parameter R "CRTGeom Curvature Radius" 2.0 0.1 10.0 0.1\n#pragma parameter cornersize "CRTGeom Corner Size" 0.03 0.001 1.0 0.005\n#pragma parameter cornersmooth "CRTGeom Corner Smoothness" 1000.0 80.0 2000.0 100.0\n#pragma parameter x_tilt "CRTGeom Horizontal Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter y_tilt "CRTGeom Vertical Tilt" 0.0 -0.5 0.5 0.05\n#pragma parameter overscan_x "CRTGeom Horiz. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter overscan_y "CRTGeom Vert. Overscan %" 100.0 -125.0 125.0 1.0\n#pragma parameter DOTMASK "CRTGeom Dot Mask Toggle" 0.3 0.0 0.3 0.3\n#pragma parameter SHARPER "CRTGeom Sharpness" 1.0 1.0 3.0 1.0\n#pragma parameter scanline_weight "CRTGeom Scanline Weight" 0.3 0.1 0.5 0.05\n*/\n\n#ifndef PARAMETER_UNIFORM\n#define CRTgamma 2.4\n#define monitorgamma 2.2\n#define d 1.6\n#define CURVATURE 1.0\n#define R 2.0\n#define cornersize 0.03\n#define cornersmooth 1000.0\n#define x_tilt 0.0\n#define y_tilt 0.0\n#define overscan_x 100.0\n#define overscan_y 100.0\n#define DOTMASK 0.3\n#define SHARPER 1.0\n#define scanline_weight 0.3\n#endif\n\n#if defined(VERTEX)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\n#define FIX(c) max(abs(c), 1e-5);\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = R*acos(a);\nreturn uv*r/sin(r/R);\n}\n\nvec2 fwtrans(vec2 uv)\n{\nfloat r = FIX(sqrt(dot(uv,uv)));\nuv *= sin(r/R)/r;\nfloat x = 1.0-cos(r/R);\nfloat D = d/R + x*cosangle.x*cosangle.y+dot(uv,sinangle);\nreturn d*(uv*cosangle-x*sinangle)/D;\n}\n\nvec3 maxscale()\n{\nvec2 c = bkwtrans(-R * sinangle / (1.0 + R/d*cosangle.x*cosangle.y));\nvec2 a = vec2(0.5,0.5)*aspect;\nvec2 lo = vec2(fwtrans(vec2(-a.x,c.y)).x, fwtrans(vec2(c.x,-a.y)).y)/aspect;\nvec2 hi = vec2(fwtrans(vec2(+a.x,c.y)).x, fwtrans(vec2(c.x,+a.y)).y)/aspect;\nreturn vec3((hi+lo)*aspect*0.5,max(hi.x-lo.x,hi.y-lo.y));\n}\n\nvoid main()\n{\n// START of parameters\n\n// gamma of simulated CRT\n//\tCRTgamma = 1.8;\n// gamma of display monitor (typically 2.2 is correct)\n//\tmonitorgamma = 2.2;\n// overscan (e.g. 1.02 for 2% overscan)\noverscan = vec2(1.00,1.00);\n// aspect ratio\naspect = vec2(1.0, 0.75);\n// lengths are measured in units of (approximately) the width\n// of the monitor simulated distance from viewer to monitor\n//\td = 2.0;\n// radius of curvature\n//\tR = 1.5;\n// tilt angle in radians\n// (behavior might be a bit wrong if both components are\n// nonzero)\nconst vec2 angle = vec2(0.0,0.0);\n// size of curved corners\n//\tcornersize = 0.03;\n// border smoothness parameter\n// decrease if borders are too aliased\n//\tcornersmooth = 1000.0;\n\n// END of parameters\n\nvec4 _oColor;\nvec2 _otexCoord;\ngl_Position = VertexCoord.x * MVPMatrix[0] + VertexCoord.y * MVPMatrix[1] + VertexCoord.z * MVPMatrix[2] + VertexCoord.w * MVPMatrix[3];\n_oPosition1 = gl_Position;\n_oColor = COLOR;\n_otexCoord = TexCoord.xy;\nCOL0 = COLOR;\nTEX0.xy = TexCoord.xy;\n\n// Precalculate a bunch of useful values we\'ll need in the fragment\n// shader.\nsinangle = sin(vec2(x_tilt, y_tilt)) + vec2(0.001);//sin(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\ncosangle = cos(vec2(x_tilt, y_tilt)) + vec2(0.001);//cos(vec2(max(abs(x_tilt), 1e-3), max(abs(y_tilt), 1e-3)));\nstretch = maxscale();\n\nilfac = vec2(1.0,clamp(floor(InputSize.y/200.0), 1.0, 2.0));\n\n// The size of one texel, in texture-coordinates.\nvec2 sharpTextureSize = vec2(SHARPER * TextureSize.x, TextureSize.y);\none = ilfac / sharpTextureSize;\n\n// Resulting X pixel-coordinate of the pixel we\'re drawing.\nmod_factor = TexCoord.x * TextureSize.x * OutputSize.x / InputSize.x;\n\n}\n\n#elif defined(FRAGMENT)\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nstruct output_dummy {\nvec4 _color;\n};\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// Comment the next line to disable interpolation in linear gamma (and\n// gain speed).\n#define LINEAR_PROCESSING\n\n// Enable screen curvature.\n//        #define CURVATURE\n\n// Enable 3x oversampling of the beam profile\n#define OVERSAMPLE\n\n// Use the older, purely gaussian beam profile\n//#define USEGAUSSIAN\n\n// Macros.\n#define FIX(c) max(abs(c), 1e-5);\n#define PI 3.141592653589\n\n#ifdef LINEAR_PROCESSING\n#       define TEX2D(c) pow(COMPAT_TEXTURE(Texture, (c)), vec4(CRTgamma))\n#else\n#       define TEX2D(c) COMPAT_TEXTURE(Texture, (c))\n#endif\n\nCOMPAT_VARYING vec2 one;\nCOMPAT_VARYING float mod_factor;\nCOMPAT_VARYING vec2 ilfac;\nCOMPAT_VARYING vec2 overscan;\nCOMPAT_VARYING vec2 aspect;\nCOMPAT_VARYING vec3 stretch;\nCOMPAT_VARYING vec2 sinangle;\nCOMPAT_VARYING vec2 cosangle;\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CRTgamma;\nuniform COMPAT_PRECISION float monitorgamma;\nuniform COMPAT_PRECISION float d;\nuniform COMPAT_PRECISION float CURVATURE;\nuniform COMPAT_PRECISION float R;\nuniform COMPAT_PRECISION float cornersize;\nuniform COMPAT_PRECISION float cornersmooth;\nuniform COMPAT_PRECISION float x_tilt;\nuniform COMPAT_PRECISION float y_tilt;\nuniform COMPAT_PRECISION float overscan_x;\nuniform COMPAT_PRECISION float overscan_y;\nuniform COMPAT_PRECISION float DOTMASK;\nuniform COMPAT_PRECISION float SHARPER;\nuniform COMPAT_PRECISION float scanline_weight;\n#endif\n\nfloat intersect(vec2 xy)\n{\nfloat A = dot(xy,xy)+d*d;\nfloat B = 2.0*(R*(dot(xy,sinangle)-d*cosangle.x*cosangle.y)-d*d);\nfloat C = d*d + 2.0*R*d*cosangle.x*cosangle.y;\nreturn (-B-sqrt(B*B-4.0*A*C))/(2.0*A);\n}\n\nvec2 bkwtrans(vec2 xy)\n{\nfloat c = intersect(xy);\nvec2 point = vec2(c)*xy;\npoint -= vec2(-R)*sinangle;\npoint /= vec2(R);\nvec2 tang = sinangle/cosangle;\nvec2 poc = point/cosangle;\nfloat A = dot(tang,tang)+1.0;\nfloat B = -2.0*dot(poc,tang);\nfloat C = dot(poc,poc)-1.0;\nfloat a = (-B+sqrt(B*B-4.0*A*C))/(2.0*A);\nvec2 uv = (point-a*sinangle)/cosangle;\nfloat r = FIX(R*acos(a));\nreturn uv*r/sin(r/R);\n}\n\nvec2 transform(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord-vec2(0.5))*aspect*stretch.z+stretch.xy;\nreturn (bkwtrans(coord)/vec2(overscan_x / 100.0, overscan_y / 100.0)/aspect+vec2(0.5)) * InputSize / TextureSize;\n}\n\nfloat corner(vec2 coord)\n{\ncoord *= TextureSize / InputSize;\ncoord = (coord - vec2(0.5)) * vec2(overscan_x / 100.0, overscan_y / 100.0) + vec2(0.5);\ncoord = min(coord, vec2(1.0)-coord) * aspect;\nvec2 cdist = vec2(cornersize);\ncoord = (cdist - min(coord,cdist));\nfloat dist = sqrt(dot(coord,coord));\nreturn clamp((cdist.x-dist)*cornersmooth,0.0, 1.0);\n}\n\n// Calculate the influence of a scanline on the current pixel.\n//\n// \'distance\' is the distance in texture coordinates from the current\n// pixel to the scanline in question.\n// \'color\' is the colour of the scanline at the horizontal location of\n// the current pixel.\nvec4 scanlineWeights(float distance, vec4 color)\n{\n// "wid" controls the width of the scanline beam, for each RGB\n// channel The "weights" lines basically specify the formula\n// that gives you the profile of the beam, i.e. the intensity as\n// a function of distance from the vertical center of the\n// scanline. In this case, it is gaussian if width=2, and\n// becomes nongaussian for larger widths. Ideally this should\n// be normalized so that the integral across the beam is\n// independent of its width. That is, for a narrower beam\n// "weights" should have a higher peak at the center of the\n// scanline than for a wider beam.\n#ifdef USEGAUSSIAN\nvec4 wid = 0.3 + 0.1 * pow(color, vec4(3.0));\nvec4 weights = vec4(distance / wid);\nreturn 0.4 * exp(-weights * weights) / wid;\n#else\nvec4 wid = 2.0 + 2.0 * pow(color, vec4(4.0));\nvec4 weights = vec4(distance / scanline_weight);\nreturn 1.4 * exp(-pow(weights * inversesqrt(0.5 * wid), wid)) / (0.6 + 0.2 * wid);\n#endif\n}\n\nvoid main()\n{\n// Here\'s a helpful diagram to keep in mind while trying to\n// understand the code:\n//\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  01  |  11  |  21  |  31  | <-- current scanline\n//  |      | @    |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//  |  02  |  12  |  22  |  32  | <-- next scanline\n//  |      |      |      |      |\n// -------------------------------\n//  |      |      |      |      |\n//\n// Each character-cell represents a pixel on the output\n// surface, "@" represents the current pixel (always somewhere\n// in the bottom half of the current scan-line, or the top-half\n// of the next scanline). The grid of lines represents the\n// edges of the texels of the underlying texture.\n\n// Texture coordinates of the texel containing the active pixel.\nvec2 xy = (CURVATURE > 0.5) ? transform(TEX0.xy) : TEX0.xy;\n\nfloat cval = corner(xy);\n\n// Of all the pixels that are mapped onto the texel we are\n// currently rendering, which pixel are we currently rendering?\nvec2 ilvec = vec2(0.0,ilfac.y > 1.5 ? mod(float(FrameCount),2.0) : 0.0);\nvec2 ratio_scale = (xy * TextureSize - vec2(0.5) + ilvec)/ilfac;\n#ifdef OVERSAMPLE\nfloat filter_ = InputSize.y/OutputSize.y;//fwidth(ratio_scale.y);\n#endif\nvec2 uv_ratio = fract(ratio_scale);\n\n// Snap to the center of the underlying texel.\nxy = (floor(ratio_scale)*ilfac + vec2(0.5) - ilvec) / TextureSize;\n\n// Calculate Lanczos scaling coefficients describing the effect\n// of various neighbour texels in a scanline on the current\n// pixel.\nvec4 coeffs = PI * vec4(1.0 + uv_ratio.x, uv_ratio.x, 1.0 - uv_ratio.x, 2.0 - uv_ratio.x);\n\n// Prevent division by zero.\ncoeffs = FIX(coeffs);\n\n// Lanczos2 kernel.\ncoeffs = 2.0 * sin(coeffs) * sin(coeffs / 2.0) / (coeffs * coeffs);\n\n// Normalize.\ncoeffs /= dot(coeffs, vec4(1.0));\n\n// Calculate the effective colour of the current and next\n// scanlines at the horizontal location of the current pixel,\n// using the Lanczos coefficients above.\nvec4 col  = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, 0.0)),\n                TEX2D(xy),\n                TEX2D(xy + vec2(one.x, 0.0)),\n                TEX2D(xy + vec2(2.0 * one.x, 0.0))) * coeffs,\n                0.0, 1.0);\nvec4 col2 = clamp(mat4(\n                TEX2D(xy + vec2(-one.x, one.y)),\n                TEX2D(xy + vec2(0.0, one.y)),\n                TEX2D(xy + one),\n                TEX2D(xy + vec2(2.0 * one.x, one.y))) * coeffs,\n                0.0, 1.0);\n\n#ifndef LINEAR_PROCESSING\ncol  = pow(col , vec4(CRTgamma));\ncol2 = pow(col2, vec4(CRTgamma));\n#endif\n\n// Calculate the influence of the current and next scanlines on\n// the current pixel.\nvec4 weights  = scanlineWeights(uv_ratio.y, col);\nvec4 weights2 = scanlineWeights(1.0 - uv_ratio.y, col2);\n#ifdef OVERSAMPLE\nuv_ratio.y =uv_ratio.y+1.0/3.0*filter_;\nweights = (weights+scanlineWeights(uv_ratio.y, col))/3.0;\nweights2=(weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2))/3.0;\nuv_ratio.y =uv_ratio.y-2.0/3.0*filter_;\nweights=weights+scanlineWeights(abs(uv_ratio.y), col)/3.0;\nweights2=weights2+scanlineWeights(abs(1.0-uv_ratio.y), col2)/3.0;\n#endif\n\nvec3 mul_res  = (col * weights + col2 * weights2).rgb * vec3(cval);\n\n// dot-mask emulation:\n// Output pixels are alternately tinted green and magenta.\nvec3 dotMaskWeights = mix(\nvec3(1.0, 1.0 - DOTMASK, 1.0),\nvec3(1.0 - DOTMASK, 1.0, 1.0 - DOTMASK),\nfloor(mod(mod_factor, 2.0))\n);\n\nmul_res *= dotMaskWeights;\n\n// Convert the image gamma for display on our output device.\nmul_res = pow(mul_res, vec3(1.0 / monitorgamma));\n\n// Color the texel.\noutput_dummy _OUT;\n_OUT._color = vec4(mul_res, 1.0);\nFragColor = _OUT._color;\nreturn;\n} \n#endif\n\n',"crt-mattias.glsl":'\n#pragma parameter CURVATURE "Curvature" 0.5 0.0 1.0 0.05\n#pragma parameter SCANSPEED "Scanline Crawl Speed" 1.0 0.0 10.0 0.5\n#if defined(VERTEX)\n#if __VERSION__ >= 130\n#define COMPAT_VARYING out\n#define COMPAT_ATTRIBUTE in\n#define COMPAT_TEXTURE texture\n#else\n#define COMPAT_VARYING varying \n#define COMPAT_ATTRIBUTE attribute \n#define COMPAT_TEXTURE texture2D\n#endif\n\n#ifdef GL_ES\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\nCOMPAT_ATTRIBUTE vec4 VertexCoord;\nCOMPAT_ATTRIBUTE vec4 COLOR;\nCOMPAT_ATTRIBUTE vec4 TexCoord;\nCOMPAT_VARYING vec4 COL0;\nCOMPAT_VARYING vec4 TEX0;\n\nvec4 _oPosition1; \nuniform mat4 MVPMatrix;\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\n\n#define vTexCoord TEX0.xy\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\nvoid main()\n{\n    gl_Position = MVPMatrix * VertexCoord;\n    TEX0.xy = TexCoord.xy;\n}\n\n#elif defined(FRAGMENT)\n\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define COMPAT_PRECISION mediump\n#else\n#define COMPAT_PRECISION\n#endif\n\n#if __VERSION__ >= 130\n#define COMPAT_VARYING in\n#define COMPAT_TEXTURE texture\nout COMPAT_PRECISION vec4 FragColor;\n#else\n#define COMPAT_VARYING varying\n#define FragColor gl_FragColor\n#define COMPAT_TEXTURE texture2D\n#endif\n\nuniform COMPAT_PRECISION int FrameDirection;\nuniform COMPAT_PRECISION int FrameCount;\nuniform COMPAT_PRECISION vec2 OutputSize;\nuniform COMPAT_PRECISION vec2 TextureSize;\nuniform COMPAT_PRECISION vec2 InputSize;\nuniform sampler2D Texture;\nCOMPAT_VARYING vec4 TEX0;\n\n// compatibility #defines\n#define Source Texture\n#define vTexCoord TEX0.xy\n\n#define SourceSize vec4(TextureSize, 1.0 / TextureSize) //either TextureSize or InputSize\n#define OutSize vec4(OutputSize, 1.0 / OutputSize)\n\n#ifdef PARAMETER_UNIFORM\nuniform COMPAT_PRECISION float CURVATURE, SCANSPEED;\n#else\n#define CURVATURE 0.5\n#define SCANSPEED 1.0\n#endif\n\n#define iChannel0 Texture\n#define iTime (float(FrameCount) / 60.0)\n#define iResolution OutputSize.xy\n#define fragCoord gl_FragCoord.xy\n\nvec3 sample_( sampler2D tex, vec2 tc )\n{\n    vec3 s = pow(COMPAT_TEXTURE(tex,tc).rgb, vec3(2.2));\n    return s;\n}\n\nvec3 blur(sampler2D tex, vec2 tc, float offs)\n{\n    vec4 xoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) / (iResolution.x * TextureSize.x / InputSize.x);\n    vec4 yoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) / (iResolution.y * TextureSize.y / InputSize.y);\n    tc = tc * InputSize / TextureSize;\n    \n    vec3 color = vec3(0.0, 0.0, 0.0);\n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.x)) * 0.00366;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.x)) * 0.01465;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.x)) * 0.02564;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.x)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.x)) * 0.00366;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.y)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.y)) * 0.05861;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.y)) * 0.09524;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.y)) * 0.05861;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.y)) * 0.01465;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, 0.0)) * 0.02564;\n    color += sample_(tex,tc + vec2(xoffs.y, 0.0)) * 0.09524;\n    color += sample_(tex,tc + vec2(    0.0, 0.0)) * 0.15018;\n    color += sample_(tex,tc + vec2(xoffs.z, 0.0)) * 0.09524;\n    color += sample_(tex,tc + vec2(xoffs.w, 0.0)) * 0.02564;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.z)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.z)) * 0.05861;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.z)) * 0.09524;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.z)) * 0.05861;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.z)) * 0.01465;\n    \n    color += sample_(tex,tc + vec2(xoffs.x, yoffs.w)) * 0.00366;\n    color += sample_(tex,tc + vec2(xoffs.y, yoffs.w)) * 0.01465;\n    color += sample_(tex,tc + vec2(    0.0, yoffs.w)) * 0.02564;\n    color += sample_(tex,tc + vec2(xoffs.z, yoffs.w)) * 0.01465;\n    color += sample_(tex,tc + vec2(xoffs.w, yoffs.w)) * 0.00366;\n\n    return color;\n}\n\nfloat rand(vec2 co)\n{\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt= dot(co.xy ,vec2(a,b));\n    float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nvec2 curve(vec2 uv)\n{\n    uv = (uv - 0.5) * 2.0;\n    uv *= 1.1;\t\n    uv.x *= 1.0 + pow((abs(uv.y) / 5.0), 2.0);\n    uv.y *= 1.0 + pow((abs(uv.x) / 4.0), 2.0);\n    uv  = (uv / 2.0) + 0.5;\n    uv =  uv *0.92 + 0.04;\n    return uv;\n}\n\nvoid main()\n{\n    vec2 q = (vTexCoord.xy * TextureSize.xy / InputSize.xy);//fragCoord.xy / iResolution.xy;\n    vec2 uv = q;\n    uv = mix( uv, curve( uv ), CURVATURE ) * InputSize.xy / TextureSize.xy;\n    vec3 col;\n    float x =  sin(0.1*iTime+uv.y*21.0)*sin(0.23*iTime+uv.y*29.0)*sin(0.3+0.11*iTime+uv.y*31.0)*0.0017;\n    float o =2.0*mod(fragCoord.y,2.0)/iResolution.x;\n    x+=o;\n    uv = uv * TextureSize / InputSize;\n    col.r = 1.0*blur(iChannel0,vec2(uv.x+0.0009,uv.y+0.0009),1.2).x+0.005;\n    col.g = 1.0*blur(iChannel0,vec2(uv.x+0.000,uv.y-0.0015),1.2).y+0.005;\n    col.b = 1.0*blur(iChannel0,vec2(uv.x-0.0015,uv.y+0.000),1.2).z+0.005;\n    col.r += 0.2*blur(iChannel0,vec2(uv.x+0.0009,uv.y+0.0009),2.25).x-0.005;\n    col.g += 0.2*blur(iChannel0,vec2(uv.x+0.000,uv.y-0.0015),1.75).y-0.005;\n    col.b += 0.2*blur(iChannel0,vec2(uv.x-0.0015,uv.y+0.000),1.25).z-0.005;\n    float ghs = 0.05;\n    col.r += ghs*(1.0-0.299)*blur(iChannel0,0.75*vec2(0.01, -0.027)+vec2(uv.x+0.001,uv.y+0.001),7.0).x;\n    col.g += ghs*(1.0-0.587)*blur(iChannel0,0.75*vec2(-0.022, -0.02)+vec2(uv.x+0.000,uv.y-0.002),5.0).y;\n    col.b += ghs*(1.0-0.114)*blur(iChannel0,0.75*vec2(-0.02, -0.0)+vec2(uv.x-0.002,uv.y+0.000),3.0).z;\n    \n    \n\n    col = clamp(col*0.4+0.6*col*col*1.0,0.0,1.0);\n    float vig = (0.0 + 1.0*16.0*uv.x*uv.y*(1.0-uv.x)*(1.0-uv.y));\n    vig = pow(vig,0.3);\n    col *= vec3(vig);\n\n    col *= vec3(0.95,1.05,0.95);\n    col = mix( col, col * col, 0.3) * 3.8;\n\n    float scans = clamp( 0.35+0.15*sin(3.5*(iTime * SCANSPEED)+uv.y*iResolution.y*1.5), 0.0, 1.0);\n    \n    float s = pow(scans,0.9);\n    col = col*vec3( s) ;\n\n    col *= 1.0+0.0015*sin(300.0*iTime);\n    \n    col*=1.0-0.15*vec3(clamp((mod(fragCoord.x+o, 2.0)-1.0)*2.0,0.0,1.0));\n    col *= vec3( 1.0 ) - 0.25*vec3( rand( uv+0.0001*iTime),  rand( uv+0.0001*iTime + 0.3 ),  rand( uv+0.0001*iTime+ 0.5 )  );\n    col = pow(col, vec3(0.45));\n\n    if (uv.x < 0.0 || uv.x > 1.0)\n        col *= 0.0;\n    if (uv.y < 0.0 || uv.y > 1.0)\n        col *= 0.0;\n    \n\n    float comp = smoothstep( 0.1, 0.9, sin(iTime) );\n\n    FragColor = vec4(col,1.0);\n} \n#endif\n'},Se=s(57),J=s(11),K={addStyleHook:function(){G(this.elements.container,this.config.selectors.container.replace(".",""),!0),G(this.elements.container,this.config.classNames.uiSupported,!0),G(this.elements.container,this.config.classNames.hideControls,!0)},build:function(){this.listeners.media(),D.element(this.elements.controls)||(oe.inject.call(this),this.listeners.controls()),this.volume=null,this.muted=null,oe.updateVolume.call(this),G(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0},toggleControls:function(t){var o=this.elements.controls;if(o){let n=0,e=c.call(this,".".concat(q({ejs__dialogs:!0})," > .").concat(q({ejs__dialog:!0})));Array.from(e).forEach(function(e,t){!0!==e.hidden&&(n+=1)}),0<n?this.toggleControls(!1):this.toggleControls(Boolean(t||this.paused||o.pressed||o.hover))}}};function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if("object"===Te(e)&&e.files&&(e=e.files[0]),this.littleEndian=!1,this.offset=0,this._lastRead=null,"object"===Te(e)&&e.name&&e.size){if("function"!=typeof window.FileReader)throw new Error("Incompatible Browser");this.fileName=e.name,this.fileType=e.type,this.fileSize=e.size,this._fileReader=new FileReader,(this._fileReader.marcFile=this)._fileReader.addEventListener("load",function(){this.marcFile._u8array=new Uint8Array(this.result),this.marcFile._dataView=new DataView(this.result),t&&t.call()},!1),this._fileReader.readAsArrayBuffer(e)}else if("object"===Te(e)&&"string"==typeof e.fileName&&"boolean"==typeof e.littleEndian){this.fileName=e.fileName,this.fileType=e.fileType,this.fileSize=e.fileSize;new ArrayBuffer(e);this._u8array=new Uint8Array(this.fileType),this._dataView=new DataView(this.fileType),e.copyToFile(this,0),t&&t.call()}else if("object"===Te(e)&&"number"==typeof e.byteLength)this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e.byteLength,void 0!==e.buffer&&(e=e.buffer),this._u8array=new Uint8Array(e),this._dataView=new DataView(e),t&&t.call();else{if("number"!=typeof e)throw new Error("Invalid source");this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e,s=new ArrayBuffer(e),this._u8array=new Uint8Array(s),this._dataView=new DataView(s),t&&t.call()}}o.IS_MACHINE_LITTLE_ENDIAN=(ve=new ArrayBuffer(2),new DataView(ve).setInt16(0,256,!0),256===new Int16Array(ve)[0]),o.prototype.seek=function(e){this.offset=e},o.prototype.skip=function(e){this.offset+=e},o.prototype.isEOF=function(){return!(this.offset<this.fileSize)},o.prototype.slice=function(e,t){let n;return t=t||this.fileSize-e,void 0!==this._u8array.buffer.slice?((n=new o(0)).fileSize=t,n._u8array=new Uint8Array(this._u8array.buffer.slice(e,e+t))):(n=new o(t),this.copyToFile(n,e,t,0)),n.fileName=this.fileName,n.fileType=this.fileType,n.littleEndian=this.littleEndian,n},o.prototype.copyToFile=function(t,n,o,a){void 0===a&&(a=n),o=o||this.fileSize-n;for(let e=0;e<o;e++)t._u8array[a+e]=this._u8array[n+e]},o.prototype.save=function(){let n;try{n=new Blob([this._u8array],{type:this.fileType})}catch(e){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"InvalidStateError"!==e.name||!window.BlobBuilder)throw new Error("Incompatible Browser");let t=new BlobBuilder;t.append(this._u8array.buffer),n=t.getBlob(this.fileType)}saveAs(n,this.fileName)},o.prototype.readU8=function(){return this._lastRead=this._u8array[this.offset],this.offset++,this._lastRead},o.prototype.readU16=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8):this._lastRead=(this._u8array[this.offset]<<8)+this._u8array[this.offset+1],this.offset+=2,this._lastRead>>>0},o.prototype.readU24=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16):this._lastRead=(this._u8array[this.offset]<<16)+(this._u8array[this.offset+1]<<8)+this._u8array[this.offset+2],this.offset+=3,this._lastRead>>>0},o.prototype.readU32=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16)+(this._u8array[this.offset+3]<<24):this._lastRead=(this._u8array[this.offset]<<24)+(this._u8array[this.offset+1]<<16)+(this._u8array[this.offset+2]<<8)+this._u8array[this.offset+3],this.offset+=4,this._lastRead>>>0},o.prototype.readBytes=function(t){this._lastRead=new Array(t);for(let e=0;e<t;e++)this._lastRead[e]=this._u8array[this.offset+e];return this.offset+=t,this._lastRead},o.prototype.readString=function(t){this._lastRead="";for(let e=0;e<t&&this.offset+e<this.fileSize&&0<this._u8array[this.offset+e];e++)this._lastRead=this._lastRead+String.fromCharCode(this._u8array[this.offset+e]);return this.offset+=t,this._lastRead},o.prototype.writeU8=function(e){this._u8array[this.offset]=e,this.offset++},o.prototype.writeU16=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=e>>8):(this._u8array[this.offset]=e>>8,this._u8array[this.offset+1]=255&e),this.offset+=2},o.prototype.writeU24=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16):(this._u8array[this.offset]=(16711680&e)>>16,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=255&e),this.offset+=3},o.prototype.writeU32=function(e){this.littleEndian?(this._u8array[this.offset]=255&e,this._u8array[this.offset+1]=(65280&e)>>8,this._u8array[this.offset+2]=(16711680&e)>>16,this._u8array[this.offset+3]=(4278190080&e)>>24):(this._u8array[this.offset]=(4278190080&e)>>24,this._u8array[this.offset+1]=(16711680&e)>>16,this._u8array[this.offset+2]=(65280&e)>>8,this._u8array[this.offset+3]=255&e),this.offset+=4},o.prototype.writeBytes=function(t){for(let e=0;e<t.length;e++)this._u8array[this.offset+e]=t[e];this.offset+=t.length},o.prototype.writeString=function(t,n){n=n||t.length;for(let e=0;e<t.length&&e<n;e++)this._u8array[this.offset+e]=t.charCodeAt(e);for(;s<n;s++)this._u8array[this.offset+s]=0;this.offset+=n};let Q=o,i=0;function r(){this.records=[],this.truncate=!1}function Ee(e){let t=new r;e.seek(5);for(var n,o;!e.isEOF();){if(4542278===(n=e.readU24())){if(e.isEOF())break;if(e.offset+3===e.fileSize){t.truncate=e.readU24();break}}(o=e.readU16())===i?t.addRLERecord(n,e.readU16(),e.readU8()):t.addSimpleRecord(n,e.readBytes(o))}return t}r.prototype.addSimpleRecord=function(e,t){this.records.push({offset:e,type:1,length:t.length,data:t})},r.prototype.addRLERecord=function(e,t,n){this.records.push({offset:e,type:i,length:t,byte:n})},r.prototype.toString=function(){nSimpleRecords=0;for(let e=nRLERecords=0;e<this.records.length;e++)this.records[e].type===i?nRLERecords++:nSimpleRecords++;let e="Simple records: "+nSimpleRecords;return e=(e+="\nRLE records: "+nRLERecords)+("\nTotal records: "+this.records.length),this.truncate&&(e+="\nTruncate at: 0x"+this.truncate.toString(16)),e},r.prototype.export=function(e){for(let e=5,t=0;t<this.records.length;t++)this.records[t].type===i?e+=8:e+=5+this.records[t].data.length;for(a+=3,this.truncate&&(a+=3),(tempFile=new Q(a)).fileName=e+".ips",tempFile.writeString("PATCH"),s=0;s<this.records.length;s++){var t=this.records[s];tempFile.writeU24(t.offset),t.type===i?(tempFile.writeU16(0),tempFile.writeU16(t.length),tempFile.writeU8(t.byte)):(tempFile.writeU16(t.data.length),tempFile.writeBytes(t.data))}return tempFile.writeString("EOF"),_0x512785.truncate&&tempFile.writeU24(_0x512785.truncate),tempFile},r.prototype.apply=function(n){let t;if(this.truncate)t=n.slice(0,this.truncate);else{for(let e=n.fileSize,t=0;t<this.records.length;t++){var o=this.records[t];o.type===i?o.offset+o.length>e&&(e=o.offset+o.length):o.offset+o.data.length>e&&(e=o.offset+o.data.length)}s===n.fileSize?t=n.slice(0,n.fileSize):(t=new Q(s),n.copyToFile(t,0))}for(n.seek(0),_0x5a0a71=0;_0x5a0a71<this.records.length;_0x5a0a71++)if(t.seek(this.records[_0x5a0a71].offset),this.records[_0x5a0a71].type===i)for(let e=0;e<this.records[_0x5a0a71].length;e++)t.writeU8(this.records[_0x5a0a71].byte);else t.writeBytes(this.records[_0x5a0a71].data);return t},"0123456789abcdef".split("");let Ce=function(){for(let t,e=[],n=0;n<256;n++){t=n;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return a}();function Z(a,i,s){for(let e=i?new Uint8Array(a._u8array.buffer,i):a._u8array,t=-1,n=s?e.length-4:e.length,o=0;o<n;o++)t=t>>>8^Ce[255&(t^e[o])];return(-1^_0x20e2c1)>>>0}let Me=1,Ie=2,Oe=3;function Pe(){this.sourceSize=0,this.targetSize=0,this.metaData="",this.actions=[],this.sourceChecksum=0,this.targetChecksum=0,this.patchChecksum=0}function Ae(n){n.readVLV=Re,n.littleEndian=!0;let o=new Pe;n.seek(4),o.sourceSize=n.readVLV(),o.targetSize=n.readVLV();var e=n.readVLV();e&&(o.metaData=n.readString(e));for(var a,t=n.fileSize-12;n.offset<t;){let e=n.readVLV(),t={type:3&e,length:1+(e>>2)};t.type===Me?t.bytes=n.readBytes(t.length):t.type!==Ie&&t.type!==Oe||(a=n.readVLV(),t.relativeOffset=(1&a?-1:1)*(a>>1)),o.actions.push(t)}if(o.sourceChecksum=n.readU32(),o.targetChecksum=n.readU32(),o.patchChecksum=n.readU32(),o.patchChecksum!==Z(n,0,!0))throw new Error("error_crc_patch");return o}function Re(){for(let e=0,t=1;;){var n=this.readU8();if(e+=(127&n)*t,128&n)break;e+=t<<=7}return this._lastRead=p}function Ne(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),e--}}function ze(t){for(let e=0;;){if(0==(t>>=7)){e++;break}e++,t--}return a}Pe.prototype.toString=function(){var e="Source size: "+this.sourceSize;return(e=(e+="\nTarget size: "+this.targetSize)+("\nMetadata: "+this.metaData))+("\n#Actions: "+this.actions.length)},Pe.prototype.validateSource=function(e,t){return this.sourceChecksum===Z(e,t)},Pe.prototype.apply=function(a,e){if(e&&!this.validateSource(a))throw new Error("error_crc_input");for(let t=new Q(this.targetSize),n=0,e=0,o=0;o<this.actions.length;o++){var i=this.actions[o];if(0===i.type)a.copyToFile(t,t.offset,i.length),t.skip(i.length);else if(i.type===Me)t.writeBytes(i.bytes);else if(i.type===Ie){n+=i.relativeOffset;for(let e=i.length;e--;)t.writeU8(a._u8array[n]),n++}else if(i.type===Oe)for(e+=i.relativeOffset,_0x5c2263=i.length;_0x5c2263--;)t.writeU8(t._u8array[e]),e++}if(e&&this.targetChecksum!==Z(s))throw new Error("error_crc_output");return s},Pe.prototype.export=function(e){let t="BPS1".length;t=(t=(t=(t+=ze(this.sourceSize))+ze(this.targetSize))+ze(this.metaData.length))+this.metaData.length;for(let e=0;e<this.actions.length;e++)t+=ze(((_0x38dad6=this.actions[e]).length-1<<2)+_0x38dad6.type),_0x38dad6.type===Me?t+=_0x38dad6.length:_0x38dad6.type!==Ie&&_0x38dad6.type!==Oe||(t+=ze((Math.abs(_0x38dad6.relativeOffset)<<1)+(_0x38dad6.relativeOffset<0?1:0)));let n=new Q(t+=12);for(n.fileName=e+".bps",n.littleEndian=!0,n.writeVLV=Ne,n.writeString("BPS1"),n.writeVLV(this.sourceSize),n.writeVLV(this.targetSize),n.writeVLV(this.metaData.length),n.writeString(this.metaData,this.metaData.length),s=0;s<this.actions.length;s++){var o=this.actions[s];n.writeVLV((o.length-1<<2)+o.type),o.type===Me?n.writeBytes(o.bytes):o.type!==Ie&&o.type!==Oe||n.writeVLV((Math.abs(o.relativeOffset)<<1)+(o.relativeOffset<0?1:0))}return n.writeU32(this.sourceChecksum),n.writeU32(this.targetChecksum),n.writeU32(this.patchChecksum),n};let ke="UPS1";function d(){this.records=[],this.sizeInput=0,this.sizeOutput=0,this.checksumInput=0,this.checksumOutput=0}function Le(e){for(;;){var t=127&e;if(0==(e>>=7)){this.writeU8(128|t);break}this.writeU8(t),--e}}function je(){for(let e=0,t=1;;){var n=this.readU8();if(-1==n)throw new Error("Can't read UPS VLV at 0x"+(this.offset-1).toString(16));if(e+=(127&n)*t,0!=(128&n))break;e+=t<<=7}return p}function De(t){for(let e=0;e++,0!=(t>>=7);)--t;return a}function Fe(t){let e=new d;for(t.readVLV=je,t.seek(ke.length),e.sizeInput=t.readVLV(),e.sizeOutput=t.readVLV();t.offset<t.fileSize-12;){t.readVLV();for(let e=[];t.readU8();)e.push(t._lastRead);e.addRecord(s,_0x3bca86)}return t.littleEndian=!0,e.checksumInput=t.readU32(),e.checksumOutput=t.readU32(),t.littleEndian=!1,e}d.prototype.addRecord=function(e,t){this.records.push({offset:e,XORdata:t})},d.prototype.toString=function(){var e="Records: "+(void 0).records.length;return(e=(e=(e+="\nInput file size: "+(void 0).sizeInput)+("\nOutput file size: "+(void 0).sizeOutput))+("\nInput file checksum: "+padZeroes((void 0).checksumInput,4)))+("\nOutput file checksum: "+padZeroes((void 0).checksumOutput,4))},d.prototype.export=function(e){let t=ke.length;t=(t+=De(this.sizeInput))+De(this.sizeOutput);for(let e=0;e<this.records.length;e++)t=(t+=De(this.records[e].offset))+(this.records[e].XORdata.length+1);for(t+=12,(tempFile=new Q(t)).writeVLV=Le,tempFile.fileName=e+".ups",tempFile.writeString(ke),tempFile.writeVLV(this.sizeInput),tempFile.writeVLV(this.sizeOutput),s=0;s<this.records.length;s++)tempFile.writeVLV(this.records[s].offset),tempFile.writeBytes(this.records[s].XORdata),tempFile.writeU8(0);return tempFile.littleEndian=!0,tempFile.writeU32(this.checksumInput),tempFile.writeU32(this.checksumOutput),tempFile.writeU32(Z(tempFile,0,!0)),tempFile},d.prototype.validateSource=function(e,t){return Z(e,t)===this.checksumInput};var e,u,$={_FS:{createFolder:function(e,t,n,o){var a,i;$.FS&&("function"==typeof $.FS.mkdir&&window.PATH?(a=PATH.join2("string"==typeof e?e:$.FS.getPath(e),t),i=$.FS.getMode(n,o),$.FS.mkdir(a,i)):$.FS.createFolder(e,t,n,o))}},romdb:null,supportBatterySave:!(d.prototype.apply=function(t,e){e&&this.validateSource(t),tempFile=new Q(this.sizeOutput),t.copyToFile(tempFile,0,this.sizeInput),t.seek(0);for(let e=0;e<this.records.length;e++){var n=this.records[e];tempFile.skip(n.offset),t.skip(n.offset);for(let e=0;e<n.XORdata.length;e++)tempFile.writeU8((t.isEOF()?0:t.readU8())^n.XORdata[e]);tempFile.skip(1),t.skip(1)}return e&&(Z(tempFile),this.checksumOutput),tempFile}),hash:"2b35cacf70ae",hash2:"f5cbb3f38c0bb20e4",hash3:"88cc8ad0c350400499a0",loading:null,gamePatch:null,saveFilenames:[],FS:null,Module:null,aspectRatio:4/3,memData:null,wasmData:null,coreFileData:{},coreFileName:"",coreFileVersion:"",isMobileDevice:!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||""),create:function(){let f=this;window.URL=window.URL||window.webkitURL;let p,m,h,n=!1,o=!1,i=!1,g=0,y=!1,v={oldCores:{psx:["bin","iso","cue","img","mdf","pbp","toc","cbn","m3u"],nds:["nds","bin"],nes:["fds","nes","unif","unf"],snes:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2002:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2005:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],snes2010:["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"],gb:["gb","gbc","dmg"],gba:["gb","gbc","gba"],vbanext:["gba"],vb:["vb","vboy","bin"],"3do":["iso","bin","cue"],lynx:["lnx"],jaguar:["j64","jag","rom","abs","cof","bin","prg"],a7800:["a78","bin"],a2600:["a26","bin"],ngp:["ngp","ngc"],n64:["n64","v64","z64","bin","u1","ndd"],pce:["pce","bin","iso","cue","ccd","img","chd"],sega:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],segacd:["mdx","md","smd","gen","bin","iso","cue","sms","gg","sg","68k","chd"],"32x":["32x","bin","gen","smd","md","cue","iso","sms"],saturn:["bin","cue","iso"],msx:["rom","mx1","mx2","dsk","cas"],bluemsx:["rom","ri","mx1","mx2","col","dsk","cas","sg","sc","m3u"],ws:["ws","wsc"],arcade:["zip"],"fba0.2.97.29":["zip"],mame2003:["zip"],mame:["zip"]},newCores:{fceumm:["fds","nes","unif","unf"],snes9x:["smc","sfc","swc","fig","bs","st"],a5200:["a52","bin"],gambatte:["gb","gbc","dmg"],mgba:["gb","gbc","gba"],beetle_vb:["vb","vboy","bin"],mupen64plus_next:["n64","v64","z64","bin","u1","ndd","gb"],fbalpha2012_cps1:["zip"],fbalpha2012_cps2:["zip"],mame2003:["zip"],desmume2015:["nds","bin"],melonds:["nds"],mednafen_psx:["cue","toc","m3u","ccd","exe","pbp","chd"],mednafen_psx_hw:["cue","toc","m3u","ccd","exe","pbp","chd"],nestopia:["fds","nes","unif","unf"],opera:["iso","bin","chd","cue"]}},b={oldCores:{psx:"psx",nds:"nds",nes:"nes",snes:"snes",snes2002:"snes2002",snes2005:"snes2005",snes2010:"snes2010",gb:"gb",gbc:"gb",gba:"gba",vbanext:"vbanext",vb:"vb",n64:"n64","3do":"3do",segaMS:"sega",segaGG:"sega",segaMD:"sega",segaCD:"segacd",sega32x:"32x",segaSaturn:"saturn",ngp:"ngp",pce:"pce",msx:"bluemsx",atari2600:"a2600",atari7800:"a7800",atari5200:"a5200",lynx:"lynx",ws:"ws",arcade:"arcade","fba0.2.97.29":"fba0.2.97.29",jaguar:"jaguar",mame2003:"mame2003"},newCores:{nes:"fceumm",snes:"snes9x",atari5200:"a5200",gb:"gambatte",gba:"mgba",vb:"beetle_vb",n64:"mupen64plus_next",nds:"desmume2015",mame2003:"mame2003",arcade:"fbalpha2012_cps1",psx:"mednafen_psx_hw","3do":"opera"}},a={fceumm:"nes",snes9x:"snes",a5200:"atari5200",gambatte:"gb",mgba:"gba",beetle_vb:"vb",mupen64plus_next:"n64",desmume2015:"nds",mame2003:"mame2003",fbalpha2012_cps1:"arcade",fbalpha2012_cps2:"arcade",mednafen_psx:"psx",mednafen_psx_hw:"psx",melonds:"nds",nestopia:"nes",opera:"3do"},_=function(e,t){return!0===t?a[e]||e:1===t?b.oldCores[e]:b.newCores[e]||e},w=this,x=w.system,s=(window.getSystem=_,window._0x29078e=b,window._0x1e0766=v,p=w.customPaths&&"string"==typeof w.customPaths["extract7z.js"]?w.customPaths["extract7z.js"]:w.dataPath+"extract7z.js",m=w.customPaths&&"string"==typeof w.customPaths["extractzip.js"]?w.customPaths["extractzip.js"]:w.dataPath+"extractzip.js?v=1",h=w.customPaths&&"string"==typeof w.customPaths["libunrar.js"]?w.customPaths["libunrar.js"]:w.dataPath+"libunrar.js",U("canvas",{})),S=(this.game.appendChild(s),$.loading=U("div",{class:this.config.classNames.loading}),this.elements.container.appendChild($.loading),{"loading-info":q({"loading-info":!0}),ad:q({ad:!0}),"close-ad":q({"close-ad":!0}),"start-game":q({"start-game":!0}),on:q({on:!0}),p1:q({p1:!0}),p2:q({p2:!0}),p3:q({p3:!0}),p4:q({p4:!0})});var e;"string"==typeof w.adUrl?($.loading.innerHTML='\n        <div>\n        <div class="'+S.ad+'" style="display:block !important;width:300px !important">\n        <div class="'+S["close-ad"]+'" hidden><a href="#" onclick="return false"></a></div>\n        <iframe scrolling="no" frameborder="no" style="width:300px !important;height:250px !important;display: block !important;" src="'+w.adUrl+'"></iframe>\n        </div>\n        <div class="'+S["loading-info"]+'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="'+S.p1+'"></div>\n        <div class="'+S.p2+'"></div>\n        <div class="'+S.p3+'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="'+S["start-game"]+'">'+me.get("playNow",w.config)+"</a>\n        </div>\n        </div>",e=U("iframe",{src:w.adUrl,scrolling:"no",frameborder:"no",style:"width:300px !important;height:250px !important;display: block !important;"}),$.loading.querySelector(".".concat(S.ad)).removeChild($.loading.querySelector(".".concat(S.ad," iframe"))),$.loading.querySelector(".".concat(S.ad)).appendChild(e),Y.webgl.DETECTED||(V($.loading.querySelector(".".concat(S["start-game"])),!0),$.loading.querySelector(".".concat(S.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'),$.loading.querySelector(".".concat(S.ad," iframe")).style.setProperty("display","block","important"),$.loading.querySelector(".".concat(S.ad," iframe")).style.setProperty("visibility","visible","important"),$.loading.querySelector(".".concat(S.ad)).style.setProperty("display","block","important"),$.loading.querySelector(".".concat(S.ad)).style.setProperty("visibility","visible","important")):($.loading.innerHTML='\n        <div>\n        <div class="'.concat(S["loading-info"],'" style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <div class="').concat(S.p1,'"></div>\n        <div class="').concat(S.p2,'"></div>\n        <div class="').concat(S.p3,'"></div>\n        </div>\n        <div style="position: absolute;bottom: 20px;left: 50%;transform: translateX(-50%);">\n        <a href="#" onclick="return false" class="').concat(S["start-game"],'">').concat(me.get("playNow",w.config),"</a>\n        </div>\n        </div>"),Y.webgl.DETECTED||(V($.loading.querySelector(".".concat(S["start-game"])),!0),$.loading.querySelector(".".concat(S.p3)).innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to initialize WebGL.</strong>'));let r=window.URL||window.webkitURL,T=function(e){return 80===e[0]&&75===e[1]&&(3===e[2]&&4===e[3]||5===e[2]&&6===e[3]||7===e[2]&&8===e[3])?"zip":55===e[0]&&122===e[1]&&188===e[2]&&175===e[3]&&39===e[4]&&28===e[5]?"7z":82===e[0]&&97===e[1]&&114===e[2]&&33===e[3]&&26===e[4]&&7===e[5]&&(0===e[6]||1===e[6]&&0==e[7])?"rar":void 0},E=async function(e){e=await(await fetch(e)).text(),e=new Blob([e],{type:"application/javascript"}),e=window.URL.createObjectURL(e);return new Worker(e)},C=async function(e){var t=await(await fetch(e)).text(),e=new Blob(["\nlet dataToPass = [];\nModule = {\n    monitorRunDependencies: function(left)  {\n        if (left == 0) {\n            setTimeout(function() {\n                unrar(dataToPass, null);\n            }, 100);\n        }\n    },\n    onRuntimeInitialized: function() {\n    },\n    locateFile: function(file) {\n        return '"+e+".mem';\n    }\n};\n"+t+'\nlet unrar = function(data, password) {\n    let cb = function(fileName, fileSize, progress) {\n        postMessage({"t":4,"current":progress,"total":fileSize, "name": fileName});\n    };\n\n    let rarContent = readRARContent(data.map(function(d) {\n        return {\n            name: d.name,\n            content: new Uint8Array(d.content)\n        }\n    }), password, cb)\n    let rec = function(entry) {\n        if (entry.type === \'file\') {\n            postMessage({"t":2,"file":entry.fullFileName,"size":entry.fileSize,"data":entry.fileContent});\n        } else if (entry.type === \'dir\') {\n            Object.keys(entry.ls).forEach(function(k) {\n                rec(entry.ls[k]);\n            })\n        } else {\n            throw "Unknown type";\n        }\n    }\n    rec(rarContent);\n    postMessage({"t":1});\n    return rarContent;\n};\nonmessage = function(data) {\n    dataToPass.push({name:  \'test.rar\', content: data.data});\n};\n                '],{type:"application/javascript"}),t=window.URL.createObjectURL(e);return new Worker(t)},M=null,d=null,l=null;try{M=new Se({dbVersion:1,storePrefix:"ejs-",storeName:"system",keyPath:null,autoIncrement:!1,onStoreReady:function(){n=!0},onError:function(){n=!0}}),d=new Se({dbVersion:1,storePrefix:"ejs-",storeName:"roms",keyPath:null,autoIncrement:!1,onStoreReady:function(){o=!0},onError:function(){o=!0}}),l=new Se({dbVersion:1,storePrefix:"ejs-",storeName:"bios",keyPath:null,autoIncrement:!1,onStoreReady:function(){i=!0},onError:function(){i=!0}})}catch(e){n=!0,o=!0,i=!0,console.log(e)}F.call(w,w.elements.container,"start-game",function(e){w.started=!0,w.playing=!0,V($.loading.querySelector(".".concat(S["loading-info"])),!0),!te||"undefined"!=te.virtualGamepadContainer&&null!==te.virtualGamepadContainer||K.toggleControls.call(w,!0);let t=q({"ejs__tooltip--visible":!0}),n=w.elements.buttons.gamepad.querySelector(".".concat(q({ejs__tooltip:!0}))),o=(G(n,t,!0),setTimeout(function(){G(n,t,!1)},5e3),"string"==typeof w.adUrl&&(V($.loading.querySelector(".".concat(S["close-ad"])),!1),!0!==w.config.noAutoAdClose&&setTimeout(function(){w.started&&$.loading.querySelector(".".concat(S.ad))&&$.loading.querySelector(".".concat(S.ad)).parentNode.removeChild($.loading.querySelector(".".concat(S.ad)))},1e4)),V($.loading.querySelector(".".concat(S["start-game"])),!0),W(oe.defaultCoreOptionsValues.call(f),oe.storage.get("core-options")||{}));"n64"===_(w.system,!0)&&o&&Object.keys(o).forEach(function(e){"glupen64-aspect"===e&&"16:9"===o[e]&&(s.height=s.width/16*9,$.aspectRatio=16/9)}),"arcade"!==_(f.system,!0)&&"fba0.2.97.29"!==_(f.system,!0)||o&&Object.keys(o).forEach(function(e){"fba-aspect"===e&&"PAR"===o[e]&&(s.height=s.width/16*9,$.aspectRatio=16/9)}),"gba"===_(w.system,!0)&&(s.height=s.width/1.5,$.aspectRatio=1.5);{let e=f;"undefined"!=typeof RI?(document.removeEventListener("mousemove",RI.eventHandler,!1),s.removeEventListener("mousedown",RI.canvasEventHandler,!1),s.removeEventListener("mouseup",RI.canvasEventHandler,!1),e.elements.container.addEventListener("mousemove",function(e){let t=0,n=0,o=e.offsetX-$.Module.canvas.offsetLeft,a=e.offsetY-$.Module.canvas.offsetTop;if("mousemove"===e.type){t=o<0?(o=0,-$.Module.canvas.offsetWidth):o>$.Module.canvas.offsetWidth?(o=$.Module.canvas.offsetWidth,$.Module.canvas.offsetWidth):o-RI.currentX,n=a<0?(a=0,-$.Module.canvas.offsetHeight):a>$.Module.canvas.offsetHeight?(a=$.Module.canvas.offsetHeight,$.Module.canvas.offsetHeight):a-RI.currentY,RI.currentX=o,RI.currentY=a;for(let e=0;e<RI.contexts.length;e+=1)HEAP32[RI.contexts[e].state+32>>2]=t,HEAP32[RI.contexts[e].state+36>>2]=n}},!1),e.elements.container.addEventListener("mousedown",RI.canvasEventHandler,!1),e.elements.container.addEventListener("mouseup",RI.canvasEventHandler,!1),a=function(r){if(r.targetTouches[0]){let t,n,o=0,a=0,e=r.target.getBoundingClientRect(),i=r.targetTouches[0].clientX-e.left,s=r.targetTouches[0].clientY-e.top;o=i<0?(i=0,-$.Module.canvas.offsetWidth):i>$.Module.canvas.offsetWidth?(i=$.Module.canvas.offsetWidth,$.Module.canvas.offsetWidth):i-RI.currentX,a=s<0?(s=0,-$.Module.canvas.offsetHeight):s>$.Module.canvas.offsetHeight?(s=$.Module.canvas.offsetHeight,$.Module.canvas.offsetHeight):s-RI.currentY,RI.currentX=i,RI.currentY=s;for(let e=0;e<RI.contexts.length;e+=1)HEAP32[RI.contexts[e].state+32>>2]=o,HEAP32[RI.contexts[e].state+36>>2]=a;switch(r.type){case"touchend":case"touchstart":if(0===r.button)n=40;else{if(2!==r.button)break;n=41}t="touchend"===r.type?0:1;for(let e=0;e<RI.contexts.length;e+=1)HEAP8[RI.contexts[e].state+n>>0]=t}}},e.elements.container.addEventListener("touchstart",a,!1),e.elements.container.addEventListener("touchend",a,!1)):(a=function(e){e=new MouseEvent(e.type,e);$.Module.canvas.dispatchEvent(e)},H.call(f,".".concat(q({ejs__dialogs:!0}))).addEventListener("mousemove",a,!1),H.call(f,".".concat(q({ejs__dialogs:!0}))).addEventListener("mousedown",a,!1),H.call(f,".".concat(q({ejs__dialogs:!0}))).addEventListener("mouseup",a,!1))}var a;"msx"===_(w.system,!0)&&"undefined"!=typeof RI&&(document.removeEventListener("keydown",RI.eventHandler,!1),document.removeEventListener("keyup",RI.eventHandler,!1),a=function(n){var e=n.keyCode,o=e>>3,a=1<<(7&e);switch(n.type){case"keyup":case"keydown":if(32<=o)throw"key code error! bad code: "+e;for(let t=0;t<RI.contexts.length;t++){let e=HEAP8[RI.contexts[t].state+o>>0];"keyup"===n.type?e&=~a:e|=a,HEAP8[RI.contexts[t].state+o>>0]=e}}},document.addEventListener("keydown",a,!1),document.addEventListener("keyup",a,!1)),setTimeout(function(){let a;a=X.info(),null===te.setVolume&&"undefined"!=typeof RA?(RA.queueAudio=function(){let e,t=w.volume,n=RA.bufIndex,o=(e=RA.bufIndex?RA.buffers[RA.bufIndex-1].endTime:RA.context.currentTime,RA.buffers[n].endTime=e+RA.buffers[n].duration,RA.context.createBufferSource());if(o.buffer=RA.buffers[n],1===(t=w.muted?0:t))o.connect(RA.context.destination);else{let e=RA.context.createGain();o.connect(e),e.connect(RA.context.destination),X.isEdge||"chrome"===a.name&&parseInt(a.version,10)<=60||"firefox"===a.name&&parseInt(a.version,10)<=56||"opera"===a.name&&parseInt(a.version,10)<=44?e.gain.value=t:"firefox"===a.name?e.gain.setValueAtTime(t,RA.context.currentTime):e.gain.setValueAtTime(t,RA.context.currentTime,0)}o.start(e),RA.bufIndex+=1,RA.bufOffset=0},X.isIos&&window.addEventListener("touchstart",function(){if(RA.context){RA.context.resume();let e=RA.context.createBufferSource();e.connect(RA.context.destination),e.start()}},!1)):te.setVolume()},500),setTimeout(function(){w.elements.container.focus()},30),void 0===window.addRunDependency&&(window.Module=void 0)}),"string"==typeof w.adUrl&&F.call(w,$.loading.querySelector(".".concat(S["close-ad"])),"click",function(e){e instanceof MouseEvent&&w.started&&$.loading.querySelector(".".concat(S.ad))&&$.loading.querySelector(".".concat(S.ad)).parentNode.removeChild($.loading.querySelector(".".concat(S.ad))),w.elements.container.focus()});let I=function(a){if($.gamePatch){let l=$.getStartName(!0),e=l.split("/"),t=e.pop().split(".").pop(),n=($.gamePatch.split(".").pop(),$.gamePatch.split("/").pop().split(".").shift()),o="".concat(e.join("/"),"/").concat(n,".").concat(t);o=o.replace(/\#/g,""),$.gamePatch.startsWith("blob:")&&(o=l);var c,d=$.gamePatch;if($.FS.rename(l,o),a.startName=o,l=$.getStartName(!0),"snes"===_(a.system,!0)||["snes2002","snes2005","snes2010"].includes(_(a.system,!0))){let e,t,n,o=new Q($.FS.readFile(l)),a=Z(o),i=new Q($.FS.readFile(d)),s=i.readString(6),r=o._u8array.length%1024;s.startsWith("PATCH")?(e=Ee(i),0==r&&"B19ED489"===a.toString(16).toUpperCase()&&((t=new Uint8Array(o._u8array.length+512)).set(new Uint8Array(512),0),t.set(o._u8array,512),o=new Q(t))):s.startsWith(ke)?e=Fe(i):s.startsWith("BPS1")&&(e=Ae(i),0<r&&"A31BEAD4"===a.toString(16).toUpperCase()&&(t=o._u8array.slice?o._u8array.slice(r):o._u8array.subarray(r),o=new Q(t)));try{(n=e.apply(o,!1))&&(0<(c=n._u8array.length%1024)&&(t=n._u8array.slice?n._u8array.slice(c):n._u8array.subarray(c),n=new Q(t)),$.FS.unlink(d),$.FS.unlink(l),$.FS.writeFile(l,n._u8array))}catch(e){}}else{let e,t,n=new Q($.FS.readFile(l)),o=new Q($.FS.readFile(d)),a=o.readString(6);a.startsWith("PATCH")?e=Ee(o):a.startsWith(ke)?e=Fe(o):a.startsWith("BPS1")&&(e=Ae(o));try{(t=e.apply(n,!1))&&($.FS.unlink(d),$.FS.unlink(l),$.FS.writeFile(l,t._u8array))}catch(e){}}}},O=function(){var e=2===f.coreVer?"INITIAL_MEMORY":"TOTAL_MEMORY",t=_(f.system,!0);y?(window.Module[e]=268435456,["jaguar"].includes(t)&&(window.Module[e]=268435456),["nds","nes","snes","arcade","mame"].includes(t)&&(window.Module[e]=0),["snes2002","snes2005","snes2010"].includes(t)&&(window.Module[e]=0),"gba"==t&&(window.Module[e]=0),"3do"==t&&(window.Module[e]=0),"n64"==t&&(window.Module[e]=0)):("nes"===t&&(window.Module[e]=134217728),window.Module[e]=g+67108864,["arcade","mame","mame2003","fba0.2.97.29"].includes(t)&&(window.Module[e]=g+268435456,$.isMobileDevice&&(window.Module[e]=314572800)),["n64","nds","jaguar"].includes(t)&&(window.Module[e]=g+268435456,$.isMobileDevice&&(window.Module[e]=314572800)),"gba"==t&&(window.Module[e]=268435456)),"undefined"!=typeof EJS_MEMORY&&(window.Module[e]=EJS_MEMORY)},u=function(e,t){function n(t){if(s.innerHTML="Game Data ready",t)try{O(),I(i);let e=[t,[$.hash,$.hash2,$.hash3].join("")];if("undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&e.unshift("-v"),$.Module.callMain(e),2===w.coreVer){$.Module.resumeMainLoop(),$.Module.setCanvasSize(800,600);let e=0,t=setInterval(function(){20<e&&clearInterval(t),e++,$.Module.setCanvasSize(800,600)},100)}B.call(i,i.elements.container,"start-game");try{a()}catch(e){}}catch(e){console.log(e),s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Failed to start game</strong>'}else s.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">Invalid Rom</strong>'}function o(e){if(e.data){if(1===e.data.t&&(!i.startName&&c&&(i.startName=c),e.target.terminate(),n(i.startName)),2===e.data.t){var a=(2===i.coreVer?v.newCores:v.oldCores)[l.toLowerCase()];let t=e.data.file.split("/"),n=t.pop(),o=n.split(".").pop();n=n.replace(/\#/g,""),$.FS.createPath("/",t.join("/"),!0,!0);for(let e=a.length-1;0<=e;--e)a[e]===o.toLowerCase()&&e>r&&(r=e,i.startName=["",t.join("/"),n].join("/"),i.startName=i.startName.replace(/\/+/,"/"));n&&($.FS.createDataFile("/".concat(t.join("/")),n,e.data.data,!0,!1),g+=e.data.data.length),c="/".concat(t.join("/"),"/").concat(n)}var t;4===e.data.t&&0<e.data.total&&(t=Math.floor(e.data.current/e.data.total*100),e=e.data.name||"",t<=100&&0<t&&(s.innerHTML=f.localization("Decompress Game Data")+e+" "+t+"%"))}}let i=f,s=$.loading.querySelector(".".concat(S.p3)),r=-1,l=_(x,f.coreVer),a=function(){if(2===i.coreVer){i.elements.settings.panels.home.querySelector('[role="menu"]').innerHTML="",ne.setNormalOptionsMenu.call(i),ne.setCoreOptionsMenu.call(i);let e=$.Module.cwrap("toggleMainLoop","null",["number"]);$.Module.resumeMainLoop=function(){e(1)},$.Module.pauseMainLoop=function(){e(0)}}"string"==typeof i.loadStateOnStart&&fetch(i.loadStateOnStart).then(function(e){e.arrayBuffer().then(function(e){e=new Uint8Array(e);EJS_loadState(e)})})},c=(window.EJS_terminate=function(){if($.Module.pauseMainLoop(),i&&i.eventListeners)for(var e in i)for(let t=0;t<i.eventListeners.length;t++){let e=i.eventListeners[t];e.element.removeEventListener(e.type,e.callback,e.capture)}if(window.EJS_RESET_VARS){let t=[],n=[];for(var o in window)t.push(o);for(let e=0;e<t.length;e++)window.EJS_RESET_VARS.includes(t[e])||n.push(t[e]);for(let e=0;e<n.length;e++)window[n[e]]&&delete window[n[e]]}},""),d=!1;var u;if(["arcade","mame","mame2003","fba0.2.97.29"].includes(_(i.system,!0))||(u=t.slice?t.slice(0,10):t.subarray(0,10),"7z"===(u=T(u))?(E(p).then(function(e){e.onmessage=o,e.postMessage(t)}),d=!0):"zip"===u?(E(m).then(function(e){e.onmessage=o,e.postMessage(t)}),d=!0):"rar"===u&&(C(h).then(function(e){e.onmessage=o,e.postMessage(t)}),d=!0)),!d){i.startName=i.getStartName(),i.startName||(i.startName="rom");try{g+=t.length,$.FS.createDataFile("/",i.startName,t,!0,!1)}catch(e){console.log(e)}n(i.startName)}},c=function(){let i=f,s=$.loading.querySelector(".".concat(S.p3)),e=f.config,r=e.gameUrl,l=e.system,t=("vbanext"==l&&(l="gba"),"string"==typeof r?r.split("/"):"ga.me"),c=t[t.length-1];(c=-1<c.indexOf("?")?c.substr(0,c.indexOf("?")):c).split(".").pop(),s.innerHTML=f.localization("Download Game Data"),["arcade","mame","mame2003","fba0.2.97.29"].includes(_(i.system,!0))&&i.config.gameParentUrl&&(s.innerHTML+=" (2/2)"),i.config.gamePatchUrl&&(s.innerHTML+=" (2/2)"),"string"!=typeof r?"[object Blob]"===r.toString()?r.arrayBuffer().then(function(e){u(c,new Uint8Array(e))}):"[object ArrayBuffer]"===r.toString()?u(c,new Uint8Array(r)):u(c,Uint8Array.from(r)):J.a.head(r,{}).then(function(e){function t(){J.a.get(r,{onDownloadProgress:function(e){e=e.total?" "+Math.floor(e.loaded/e.total*100).toString()+"%":" "+(e.loaded/1048576).toFixed(2)+"MB";["arcade","mame","mame2003","fba0.2.97.29"].includes(_(i.system,!0))&&i.config.gameParentUrl||i.config.gamePatchUrl?s.innerHTML=f.localization("Download Game Data")+" (2/2)"+e:s.innerHTML=f.localization("Download Game Data")+e},responseType:"arraybuffer"}).then(function(e){e=new Uint8Array(e.data);"string"!=typeof f.config.gameUrl||"string"==typeof f.config.gameUrl&&(f.config.gameUrl.startsWith("blob:")||f.config.gameUrl.startsWith("file:")||f.config.gameUrl.startsWith("chrome-extension:")||"file:"===window.location.protocol||"chrome-extension:"===window.location.protocol)||f.cacheLimit&&f.cacheLimit<e.byteLength||!f.cacheLimit&&1073741824<e.byteLength||(a&&d.db&&($.saveFilenames.push(a),d.put(a,{filename:c,filesize:e.length,filetype:o,key:a,lastaccess:(new Date).valueOf()})),d.db&&d.put(a,{filename:c,filesize:e.length,filetype:o,key:a,data:e})),u(c,e)}).catch(function(e){j(e,s,f)})}let n=e.headers["content-length"],o=e.headers["content-type"],a="".concat(l,"-").concat(c);d.db?d.get(a,function(e){e&&e.filename===c&&e.filesize-n==0&&e.filetype===o&&e.key?u(e.filename,e.data):t()}):t()}).catch(function(e){j(e,s,f)})},P=function(){let t=$.loading.querySelector(".".concat(S.p3)),n=f.config.gamePatchUrl;if(n){let e=n.split("/"),r=e[e.length-1];(r=-1<r.indexOf("?")?r.substr(0,r.indexOf("?")):r).split(".").pop(),t.innerHTML=f.localization("Download Game Data")+" (1/2)",J.a.get(n,{onDownloadProgress:function(e){e=e.total?" "+Math.floor(e.loaded/e.total*100).toString()+"%":" "+(e.loaded/1048576).toFixed(2)+"MB";t.innerHTML=f.localization("Download Game Data")+" (1/2)"+e},responseType:"arraybuffer"}).then(function(e){function t(o){if(o.data){if(1===o.data.t&&(o.target.terminate(),c()),2===o.data.t){let e=o.data.file.split("/"),t=e.pop(),n=t.split(".").pop();$.FS.createPath("/",e.join("/"),!0,!0),$.FS.createDataFile("/"+e.join("/"),t,o.data.data,!0,!1),g+=o.data.data.length,["ips","bps","ups"].includes(n)&&!$.gamePatch&&($.gamePatch="/"+e.join("/")+"/"+t)}var e;4===o.data.t&&0<o.data.total&&(e=Math.floor(o.data.current/o.data.total*100),o=o.data.name||"",e<=100&&0<e&&(a.innerHTML=f.localization("Decompress Game Patch")+" ".concat(o," ").concat(e,"%")))}}let n=new Uint8Array(e.data),o=r.split(".").pop(),a=$.loading.querySelector(".".concat(S.p3)),i=n.slice?n.slice(0,10):n.subarray(0,10),s=T(i);"7z"===s?E(p).then(function(e){e.onmessage=t,e.postMessage(n)}):"zip"===s?E(m).then(function(e){e.onmessage=t,e.postMessage(n)}):"rar"===s?C(h).then(function(e){e.onmessage=t,e.postMessage(n)}):(g+=n.length,$.gamePatch="/"+o,$.FS.createDataFile("/",o,n,!0,!1),c())}).catch(function(e){j(e,m,f)})}else c()},A=function(){let t=f,s=$.loading.querySelector(".".concat(S.p3)),r=f.config.gameParentUrl;if(r&&["arcade","mame","mame2003","fba0.2.97.29"].includes(_(t.system,!0))){let e=r.split("/"),i=e[e.length-1];(i=-1<i.indexOf("?")?i.substr(0,i.indexOf("?")):i).split(".").pop(),s.innerHTML=f.localization("Download Game Data")+" (1/2)",t.config.gamePatchUrl&&(s.innerHTML=f.localization("Download Game Data")+" (1/3)"),J.a.head(r,{}).then(function(e){function t(){J.a.get(r,{onDownloadProgress:function(e){e=e.total?" "+Math.floor(e.loaded/e.total*100).toString()+"%":" "+(e.loaded/1048576).toFixed(2)+"MB";s.innerHTML=f.localization("Download Game Data")+" (1/2)"+e},responseType:"arraybuffer"}).then(function(e){var e=new Uint8Array(e.data),t=(a&&d.db&&($.saveFilenames.push(a),d.put(a,{filename:i,filesize:e.length,filetype:o,key:a,lastaccess:(new Date).valueOf()}),d.db&&d.put(a,{filename:i,filesize:e.length,filetype:o,key:a,data:e})),i.replace(/\#/g,""));try{g+=e.length,$.FS.createDataFile("/",t,e,!0,!1),P()}catch(e){console.log(e)}}).catch(function(e){j(e,s,f)})}let n=e.headers["content-length"],o=e.headers["content-type"],a=(e.headers["last-modified"],"".concat(x,"-").concat(i));d.db?d.get(a,function(e){e&&e.filename===i&&e.filesize-n==0&&e.filetype===o&&e.key?($.FS.createDataFile("/",e.filename,e.data,!0,!1),P()):t()}):t()}).catch(function(e){j(e,s,f)})}else P()},R=function(e,t){function n(n){if(n.data){if(1===n.data.t&&(a.innerHTML="BIOS ready",n.target.terminate(),A()),2===n.data.t){let e=n.data.file.split("/"),t=e.pop();t.split(".").pop(),$.FS.createPath("/",e.join("/"),!0,!0),$.FS.createDataFile("/"+e.join("/"),t,n.data.data,!0,!1),g+=n.data.data.length}var e;4===n.data.t&&0<n.data.total&&(e=Math.floor(n.data.current/n.data.total*100),n=n.data.name||"",e<=100&&0<e&&(a.innerHTML="Decompress BIOS ".concat(n," ").concat(e,"%")))}}let o=f,a=$.loading.querySelector(".".concat(S.p2)),i=(e.split(".").pop(),t.slice?t.slice(0,10):t.subarray(0,10)),s=T(i);"7z"===s?E(p).then(function(e){e.onmessage=n,e.postMessage(t)}):"rar"===s?C(h).then(function(e){e.onmessage=n,e.postMessage(t)}):"zip"!==s||["arcade","mame","mame2003","fba0.2.97.29"].includes(_(o.system,!0))?(g+=t.length,a.innerHTML="BIOS ready",$.FS.createDataFile("/",e,t,!0,!1),A()):E(m).then(function(e){e.onmessage=n,e.postMessage(t)})},N=function(){if($.loading.querySelector(".".concat(S.p1)).innerHTML="Game Core ready",$.Module._supports_states&&(ee.statesSupported=$.Module.cwrap("supports_states","number",[])),ee.statesSupported)try{f.statesSupported=!!ee.statesSupported(),D.element(f.elements.buttons.netplay)&&V(f.elements.buttons.netplay,!ne.supportNetPlay.call(f)),D.element(f.elements.buttons.saveState)&&V(f.elements.buttons.saveState,!f.statesSupported),D.element(f.elements.buttons.loadState)&&V(f.elements.buttons.loadState,!f.statesSupported),V(oe.contextMenu.querySelectorAll("ul li").item(2),!f.statesSupported),V(oe.contextMenu.querySelectorAll("ul li").item(3),!f.statesSupported)}catch(e){}let r=f.config.biosUrl,e=(te.bindFunction.call(f),te.setGamepadDialog.call(f),te.setMessageDialog.call(f),te.setCacheDialog.call(f),te.setLoadingDialog.call(f),te.setNetplayDialog.call(f),te.setCheatDialog.call(f),te.initGamepad.call(f),te.initKeyboard.call(f),te.listeners.call(f),$._FS.createFolder("/","etc",!0,!0),$.FS.mkdir("/data"),$.FS.mkdir("/data/saves"),"undefined"!=typeof IDBFS?$.FS.mount(IDBFS,{},"/data/saves"):$.FS.mount($.FS.filesystems.IDBFS,{},"/data/saves"),$.FS.mkdir("/shader"),$.FS.syncfs(!0,function(e){}),te.initShaders(),"");e=(e=(e=(e=(e+="savefile_directory = /data/saves\n")+"video_vsync = true\nscreenshot_directory = /\n")+"video_shader = /shader/shader.glslp\nvideo_shader_enable = true\n")+"video_font_enable = false\nvideo_scale = 1.0\n")+"video_gpu_screenshot = false\naudio_latency = 96\n";var t=_(f.system,!0);let n=oe.defaultCoreOptionsValues.call(f),o=(f.lightgun&&("nes"===t&&(e+='input_libretro_device_p2 = "258"\n'),"segaMS"!==t&&"segaMD"!==t&&"segaCD"!==t||(n.genesis_plus_gx_gun_cursor="yes",n.genesis_plus_gx_invert_mouse="yes",n.genesis_plus_gx_bram="per game",e+='input_libretro_device_p2 = "260"\n'),"snes"===t&&(e+='input_libretro_device_p2 = "260"\n'),["snes2002","snes2005","snes2010","snesnext"].includes(t)&&(e+='input_libretro_device_p2 = "260"\n')),f.mouse&&("snes"===t&&(e+="input_libretro_device_p1 = 2\n"),["snes2002","snes2005","snes2010","snesnext"].includes(t)&&(e+="input_libretro_device_p1 = 2\n")),f.multitap&&["snes2002","snes2005","snes2010","snesnext","snes"].includes(t)&&(e+="input_libretro_device_p2 = 257\n"),"n64"===t&&(e+="input_libretro_device_p1 = 5\n"),e=e+"fastforward_ratio = 1.0\n"+"video_smooth = false\n",W(n,oe.storage.get("core-options")||{})),a="";if(2===f.coreVer?($.FS.createDataFile("/etc","retroarch.cfg",e,!0,!0),$._FS.createFolder("/home/web_user","retroarch",!0,!0),$._FS.createFolder("/home/web_user/retroarch","userdata",!0,!0),$.FS.createDataFile("/home/web_user/retroarch/userdata","retroarch.cfg",a,!0,!0)):($.FS.createDataFile("/etc","retroarch.cfg",e,!0,!0),$._FS.createFolder("/home/web_user",".config",!0,!0),$._FS.createFolder("/home/web_user/.config","retroarch",!0,!0),$.FS.createDataFile("/home/web_user/.config/retroarch","retroarch-core-options.cfg",a,!0,!0)),o&&Object.keys(o).forEach(function(t){if(f.lightgun&&"nes"===_(f.system,!0)&&"system_type"===t)return!1;a+="".concat(t,' = "').concat(o[t],'"\n'),F.call(f,f.elements.container,"start-game",function(e){te.setVariable(t,o[t])})}),r){let e=r.split("/"),i=e[e.length-1],s=((i=-1<i.indexOf("?")?i.substr(0,i.indexOf("?")):i).split(".").pop(),$.loading.querySelector(".".concat(S.p2)));J.a.head(r,{}).then(function(e){function t(){J.a.get(r,{onDownloadProgress:function(e){e=e.total?" "+Math.floor(e.loaded/e.total*100).toString()+"%":" "+(e.loaded/1048576).toFixed(2)+"MB";s.innerHTML=f.localization("Download BIOS")+e},responseType:"arraybuffer"}).then(function(e){e=new Uint8Array(e.data);l.db&&l.put(x,{filename:i,filesize:e.length,filetype:o,data:e}),R(i,e)}).catch(function(e){j(e,s,f)})}let n=e.headers["content-length"],o=e.headers["content-type"],a=(e.headers["last-modified"],f.system);l.db?l.get(a,function(e){e&&e.filename===i&&e.filesize-n==0&&e.filetype===o?R(e.filename,e.data):t()}):t()}).catch(function(e){j(e,s,f)})}else A()},z=function(e){e=e.byteLength?new Uint8Array(e):e;"undefined"!=typeof GLOBAL_BASE?$.Module.HEAPU8.set(e,GLOBAL_BASE):"undefined"!=typeof Runtime&&Runtime.GLOBAL_BASE?$.Module.HEAPU8.set(e,Runtime.GLOBAL_BASE):$.Module.HEAPU8.set(e,8)},k=function(t){function n(n){if(n.data){if(1===n.data.t&&(B.call(w,w.elements.container,"script-loaded"),n.target.terminate()),2===n.data.t){let e=n.data.file.split("/").pop(),t=e.split(".").pop();$.coreFileData[e]=n.data.data,"js"!==t||e.includes(".worker.js")||(o=n.data.data),"mem"===t&&($.memData=n.data.data),"wasm"===t&&($.wasmData=n.data.data)}4===n.data.t&&0<n.data.total&&(e.innerHTML=f.localization("Decompress Game Core")+" ".concat(Math.floor(n.data.current/n.data.total*100),"%"))}}let e=$.loading.querySelector(".".concat(S.p1)),o="";F.call(w,w.elements.container,"script-loaded",function(e){{null!==$.wasmData?(window.Module.wasmBinary=$.wasmData,O(),window.Module.monitorRunDependencies=function(e){0===e&&N()},window.Module.onRuntimeInitialized=function(){}):(O(),window.Module.monitorRunDependencies=function(e){console.log("monitorRunDependencies, ",e)},window.Module.onRuntimeInitialized=function(){$.Module||($.Module=window.Module),$.Module&&$.Module.FS?$.FS=$.Module.FS:$.FS=window.FS,console.log("onRuntimeInitialized"),N()});let n=window.Module;if(null!==$.wasmData&&(n.wasmBinary=$.wasmData),X.isIos&&null!==$.wasmData){let e=new Blob([o],{type:"text/javascript"}),t=U("script",{src:r.createObjectURL(e)});document.body.appendChild(t),t.onload=function(){void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&($.Module=EmulatorJS(n),EmulatorJS=void 0),null!==$.memData&&2!==w.coreVer&&z($.memData),$.Module||($.Module=window.Module),$.Module&&$.Module.FS?$.FS=$.Module.FS:$.FS=window.FS}}else o=function(n){let o=[];for(let t=0;t<n.length;t+=1){let e=n[t];255<e&&(e&=255),o.push(String.fromCharCode(e))}return o.join("")}(o),window.eval(o),void 0===window.addRunDependency&&"undefined"!=typeof EmulatorJS&&($.Module=EmulatorJS(n),EmulatorJS=void 0),null!==$.memData&&2!==w.coreVer&&z($.memData),$.Module||($.Module=window.Module),$.Module&&$.Module.FS?$.FS=$.Module.FS:$.FS=window.FS,window.EJS_MODULE=$.Module,window.ejs_loader=$,window.ejs_media=te;return void(o=null)}});E(p).then(function(e){e.onmessage=n,e.postMessage(t)})},L=function(t){V($.loading.querySelector(".".concat(S["start-game"])),!0);let a=$.loading.querySelector(".".concat(S.p1));if(a.innerHTML=f.localization("Loading")+"...",!0===n&&!0===o&&!0===i){window.Module={TOTAL_MEMORY:268435456,noInitialRun:!0,arguments:[],preRun:[],postRun:[],canvas:s,print:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},printErr:function(e){!0===window.EJS_DEBUG_XX&&console.log(e)},totalDependencies:0,monitorRunDependencies:function(e){},locateFile:function(e){let t=null;var n;return e.includes(".worker.js")?(Object.keys($.coreFileData).includes(e)&&(t=$.coreFileData[e]),n=new Blob([""],{type:"application/javascript"}),window.URL.createObjectURL(n)):e.includes(".js.mem")&&Object.keys($.coreFileData).includes(e)?(t=$.coreFileData[e],URL.createObjectURL(new Blob([t.buffer]))):null},readAsync:function(t,n,o){if(t instanceof ArrayBuffer)setTimeout(function(){n(t)},500);else{let e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){200==e.status||0==e.status&&e.response?n(e.response):o()},e.onerror=o,e.send()}}};let u=function(n,o){var e=f.customPaths&&"string"==typeof f.customPaths[n]?f.customPaths[n]:2===f.coreVer?f.dataPath+"cores/"+n+"?v="+o:f.dataPath+"old/"+n+"?v="+o;J.a.get(e,{onDownloadProgress:function(e){e=e.total?" "+Math.floor(e.loaded/e.total*100).toString()+"%":" "+(e.loaded/1048576).toFixed(2)+"MB";a.innerHTML=f.localization("Download Game Core")+e},responseType:"arraybuffer"}).then(function(e){let t=new Uint8Array(e.data);if(M.db&&M.put(n,{version:o,data:t}),2===f.coreVer)k(t);else{let e=t.slice?t.slice(12):t.subarray(12);e.set([55,122,188,175,39,28,0,3],0),t=null,k(e)}}).catch(function(e){j(e,a,f)})};var e=f.customPaths&&"string"==typeof f.customPaths["v.json"]?f.customPaths["v.json"]:f.dataPath+"v.json";return J.a.get(e,{}).then(function(s){let r,l=b,c=s.data,d=$.loading.querySelector(".".concat(S.p1));if(l=!0===f.config.oldCores&&c.oldCores[f.system]||!c.newCores[_(f.system)]||!Y.wasm&&!Boolean(c.newCores[_(f.system)].asmjs)||X.isIos?(c=c.oldCores[f.system],l.oldCores[f.system]):(f.coreVer=2,delete Module.readAsync,Module.INITIAL_MEMORY=Module.TOTAL_MEMORY,delete Module.TOTAL_MEMORY,f.elements.settings.panels.home.querySelector('[role="menu"]').innerHTML="",ne.setNormalOptionsMenu.call(f),ne.setCoreOptionsMenu.call(f),c=c.newCores[_(f.system)],_(f.system)),c){let n=c.version||1,e=Boolean(c.netplay),t=Boolean(c.state),o=Boolean(c.asmjs),a=Boolean(c.wasm),i=("nds"!==f.system||Y.wasm||2===f.coreVer||(t=!1),!1===f.statesSupported&&(t=!1),$.coreFileVersion=n,$.coreFileName=l,!1);if(["webgl2","experimental-webgl2"].includes(Y.webgl.WEBGL_CONTEXT)&&(i=!0),"undefined"!=typeof EJS_N64_LEGACY&&1==EJS_N64_LEGACY&&(i=!1),"mame"==f.system){let e=f.mameCore;if(!e||null===e||2!==e.split("|").length)return void(d.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+f.localization("Missing mame config")+"</strong>");s=e.split("|");$.coreFileName="".concat(f.system,"-").concat(s[0]),t="1"===s[1],D.element(f.elements.buttons.saveState)&&V(f.elements.buttons.saveState,!t),D.element(f.elements.buttons.loadState)&&V(f.elements.buttons.loadState,!t),V(oe.contextMenu.querySelectorAll("ul li").item(2),!t),V(oe.contextMenu.querySelectorAll("ul li").item(3),!t),r=2===f.coreVer?"":f.system.concat("-old-").concat(s[0],"-wasm.data"),s[0]?(Y.wasm&&a?y=!0:(d.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+f.localization("Webassembly support is not detected in this browser")+"</strong>",r=""),r&&(M.db?M.get(r,function(t){if(t&&t.version===n)if(2===w.coreVer)k(t.data);else{let e=t.data.slice?t.data.slice(12):t.data.subarray(12);e.set([55,122,188,175,39,28,0,3],0),k(e)}else u(r,n)}):u(r,n))):d.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+f.localization("Unsupported Game")+"</strong>"}else{r=!1;let e;if(Y.wasm&&a?(e="wasm",r=!0,"n64"!==f.system||i||2===f.coreVer||(e="legacy-wasm"),y=!0):o&&(r=!0,e="asmjs","n64"!==f.system||i||2===f.coreVer||(e="legacy-asmjs")),!0!==r)return void(d.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+f.localization("Please upgrade your browser to the latest version")+"</strong>");r=2===f.coreVer?l+"-"+e+".data":l+"-old-"+e+".data","undefined"!=typeof EJS_CUSTOM_COREFILE&&(r=EJS_CUSTOM_COREFILE),M.db?M.get(r,function(t){if(!t||t.version!==n||"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX)u(r,n);else if(2===w.coreVer)k(t.data);else{let e=t.data.slice?t.data.slice(12):t.data.subarray(12);e.set([55,122,188,175,39,28,0,3],0),k(e)}}):u(r,n)}e||D.element(f.elements.buttons.netplay)&&V(f.elements.buttons.netplay,!0),D.element(f.elements.buttons.saveState)&&V(f.elements.buttons.saveState,!t),D.element(f.elements.buttons.loadState)&&V(f.elements.buttons.loadState,!t),V(oe.contextMenu.querySelectorAll("ul li").item(2),!t),V(oe.contextMenu.querySelectorAll("ul li").item(3),!t),f.statesSupported=t,window.innerWidth<400&&(D.element(f.elements.inputs.volume)&&V(f.elements.inputs.volume,!0),D.element(f.elements.buttons.mute)&&V(f.elements.buttons.mute,!0),D.element(f.elements.buttons.cheat)&&V(f.elements.buttons.cheat,!0)),f.config.buttons&&(!1===f.config.buttons.playPause&&D.element(f.elements.buttons.play[0])&&V(f.elements.buttons.play[0],!0),!1===f.config.buttons.restart&&D.element(f.elements.buttons.restart)&&V(f.elements.buttons.restart,!0),!1===f.config.buttons.mute&&D.element(f.elements.buttons.mute)&&V(f.elements.buttons.mute,!0),!1===f.config.buttons.settings&&D.element(f.elements.buttons.settings)&&V(f.elements.buttons.settings,!0),!1===f.config.buttons.fullscreen&&D.element(f.elements.buttons.fullscreen)&&V(f.elements.buttons.fullscreen,!0),!1===f.config.buttons.saveState&&D.element(f.elements.buttons.saveState)&&V(f.elements.buttons.saveState,!0),!1===f.config.buttons.loadState&&D.element(f.elements.buttons.loadState)&&V(f.elements.buttons.loadState,!0),!1===f.config.buttons.screenRecord&&D.element(f.elements.buttons.screenRecord)&&V(f.elements.buttons.screenRecord,!0),!1===f.config.buttons.cacheManager&&D.element(f.elements.buttons.cacheManager)&&V(f.elements.buttons.cacheManager,!0),!1===f.config.buttons.gamepad&&D.element(f.elements.buttons.gamepad)&&V(f.elements.buttons.gamepad,!0),!1===f.config.buttons.cheat&&D.element(f.elements.buttons.cheat)&&V(f.elements.buttons.cheat,!0),!1===f.config.buttons.volume&&D.element(f.elements.inputs.volume)&&V(f.elements.inputs.volume,!0),!1===f.config.buttons.screenshot&&V(oe.contextMenu.querySelectorAll("ul li").item(0),!0),!1===f.config.buttons.quickSave&&V(oe.contextMenu.querySelectorAll("ul li").item(2),!0),!1===f.config.buttons.quickLoad&&V(oe.contextMenu.querySelectorAll("ul li").item(3),!0))}else d.innerHTML='<strong style="color:#f00;text-shadow: 0px 0px 3px;">'+f.localization("Invalid System")+"</strong>"}).catch(function(e){j(e,t,w)}),$.romdb=d,!1}setTimeout(L,50)};ae($.loading.querySelector(".".concat(S["start-game"])),"click touchstart",L),!0===w.startOnLoad&&$.loading.querySelector(".".concat(S["start-game"])).click()}};let g=$;const Be=s(161);function Ue(e){return function(n){if(Array.isArray(n)){for(let e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ve(n,o){for(let t=0;t<o.length;t++){let e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}let Ge,He,qe,Xe,Ye,y=(Ge=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],He=function(){function u(e){var t=e.targetModal,n=e.triggers,n=void 0===n?[]:n,o=e.onShow,o=void 0===o?function(){}:o,a=e.onClose,a=void 0===a?function(){}:a,i=e.openTrigger,i=void 0===i?"data-micromodal-trigger":i,s=e.closeTrigger,s=void 0===s?"data-micromodal-close":s,r=e.disableScroll,r=void 0!==r&&r,l=e.disableFocus,l=void 0!==l&&l,c=e.awaitCloseAnimation,c=void 0!==c&&c,d=e.debugMode,d=void 0!==d&&d,e=e.closeByEsckey,e=void 0===e||e;if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");this.modal=document.getElementById(t),this.config={debugMode:d,disableScroll:r,openTrigger:i,closeTrigger:s,onShow:o,onClose:a,awaitCloseAnimation:c,disableFocus:l,closeByEsckey:e},0<n.length&&this.registerTriggers.apply(this,Ue(n)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}let e,t;return e=u,t=[{key:"registerTriggers",value:function(){for(let e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e.addEventListener("click",function(){return u.showModal()})})}},{key:"showModal",value:function(){this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(q({"is-open":!0})),this.setFocusToFirstNode(),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){let t=this.modal;this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",function e(){t.classList.remove(q({"is-open":!0})),t.removeEventListener("animationend",e,!1)},!1):t.classList.remove(q({"is-open":!0}))}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){this.config.closeByEsckey&&27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){let t=this.modal.querySelectorAll(Ge);return Object.keys(t).map(function(e){return t[e]})}},{key:"setFocusToFirstNode",value:function(){if(!this.config.disableFocus){let e=this.getFocusableNodes();e.length&&e[0].focus()}}},{key:"maintainFocus",value:function(e){let t=this.getFocusableNodes();var n;this.modal.contains(document.activeElement)?(n=t.indexOf(document.activeElement),e.shiftKey&&0===n&&(t[t.length-1].focus(),e.preventDefault()),e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault())):t[0].focus()}}],Ve(e.prototype,t),u}(),qe=null,Xe=function(e){if(!document.getElementById(e))return!1},Ye=function(e,t){if(e.length<=0&&(console.warn("MicroModal v".concat(version,": Please specify at least one %c'micromodal-trigger'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>')),!t)return!0;for(var n in t)Xe(n);return!0},{init:function(e){let t=Object.assign({},{openTrigger:"data-micromodal-trigger"},e),n=Ue(document.querySelectorAll("[".concat(t.openTrigger,"]"))),o=function(e,n){let o=[];return e.forEach(function(e){var t=e.attributes[n].value;void 0===o[t]&&(o[t]=[]),o[t].push(e)}),o}(n,t.openTrigger);if(!0!==t.debugMode||!1!==Ye(n,o))for(var a in o){var i=o[a];t.targetModal=a,t.triggers=Ue(i),new He(t)}},show:function(e,t){let n=t||{};return n.targetModal=e,!0===n.debugMode&&!1===Xe(e)?qe=null:(qe=new He(n)).showModal(),qe},close:function(){qe.closeModal()}});const ee={defaultControllers:{0:{0:{value:"88"},1:{value:"83"},2:{value:"16"},3:{value:"13"},4:{value:"38"},5:{value:"40"},6:{value:"37"},7:{value:"39"},8:{value:"90"},9:{value:"65"},10:{value:"81"},11:{value:"69"},12:{value:"82"},13:{value:"87"},14:{},15:{},16:{value:"72"},17:{value:"70"},18:{value:"71"},19:{value:"84"},20:{value:"76"},21:{value:"74"},22:{value:"75"},23:{value:"73"},24:{},25:{},26:{}},1:{},2:{},3:{}},controllers:{},virtualGamepadContainer:null,keyMap:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",27:"escape",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"left window key",92:"right window key",93:"select key",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num lock",145:"scroll lock",186:"semi-colon",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash",192:"grave accent",219:"open bracket",220:"back slash",221:"close braket",222:"single quote"},saveLoaddbDB:function(){try{return new Se({dbVersion:1,storePrefix:"ejs-",storeName:"states",keyPath:null,autoIncrement:!1,onStoreReady:function(){},onError:function(){}})}catch(e){console.log(e)}}(),saveLoadDB:function(n){try{if(!ee.saveLoaddbDB.db)return!1;if(oe&&"function"==typeof oe.getCoreOptionsValue){var e=oe.getCoreOptionsValue("save-state-location");if(!e||"download"===e)return!1;if(!this.getStartName())return!1;var o=oe.getCoreOptionsValue("save-state-slot");if(!o)return!1;let t=this.getStartName()+"-"+o;return async function(){if("save"===n)try{var e=await ee.saveState();ee.saveLoaddbDB.put(t,e)}catch(e){return}else ee.saveLoaddbDB.get(t,function(e){EJS_loadState(e)})}(),!0}return!1}catch(e){return!1}},disableInput:!1,disableControl:function(e){if(e){for(var t=0;t<24;t+=1)ee.simulateInputFn(0,t,0),ee.simulateInputFn(1,t,0),ee.simulateInputFn(2,t,0),ee.simulateInputFn(3,t,0);ee.disableInput=!0}else ee.disableInput=!1},loadRoomsListTimer:null,loadRoomsList:function(){},stopLoadRooms:function(){ee.loadRoomsListTimer&&clearTimeout(ee.loadRoomsListTimer)},openRoom:function(){},gamepad:null,allowCheat:!0,connection:null,connected:!1,playerName:"",players:[],waitingList:{},roomMaster:null,inputsData:{},coreOptionData:{},currentFrame:0,wait:!1,progressHelper:{},icons:{lock:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="lock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-lock fa-w-14 fa-3x"><path fill="currentColor" d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z" class=""></path></svg>'},isPaused:null,setVolume:null,setVariable:null,simulateInput:null,simulateInputFn:null,toggleShader:null,saveState:null,screenRecord:null,cacheManager:null,loadState:null,quickSaveState:null,quickLoadState:null,changeStateSlot:null,getScreenData:null,getStateInfo:null,setCheat:null,resetCheat:null,getGameCoreOptions:null,classNames:{"dialog-container":q({"dialog-container":!0}),tabs:q({tabs:!0}),"dialog-title":q({"dialog-title":!0}),"dialog-content":q({"dialog-content":!0}),"dialog-buttons":q({"dialog-buttons":!0}),overlay:q({overlay:!0}),"key-setting-popup":q({"key-setting-popup":!0}),"tabs-panel":q({"tabs-panel":!0}),"tabs-content":q({"tabs-content":!0}),"button-container":q({"button-container":!0}),set:q({set:!0}),active:q({active:!0}),"btn-cancel":q({"btn-cancel":!0}),"btn-reset":q({"btn-reset":!0}),"btn-clear":q({"btn-clear":!0}),"btn-create":q({"btn-create":!0}),"btn-submit":q({"btn-submit":!0}),"btn-join-room":q({"btn-join-room":!0}),"btn-quit":q({"btn-quit":!0}),"btn-create-room":q({"btn-create-room":!0}),"netplay-player-name":q({"netplay-player-name":!0}),"netplay-roomlist":q({"netplay-roomlist":!0}),"netplay-room-name-input":q({"netplay-room-name-input":!0}),"netplay-room-password-input":q({"netplay-room-password-input":!0}),"netplay-create-room-set":q({"netplay-create-room-set":!0}),"netplay-room":q({"netplay-room":!0}),modal:q({modal:!0}),modal__overlay:q({modal__overlay:!0}),modal__container:q({modal__container:!0}),modal__header:q({modal__header:!0}),modal__title:q({modal__title:!0}),modal__close:q({modal__close:!0}),modal__content:q({modal__content:!0}),modal__btn:q({modal__btn:!0}),"modal__btn-primary":q({"modal__btn-primary":!0}),"micromodal-slide":q({"micromodal-slide":!0}),modal__errmsg:q({modal__errmsg:!0}),modal__footer:q({modal__footer:!0}),"cheats-add":q({"cheats-add":!0}),"cheats-list":q({"cheats-list":!0}),"cheat-code-input":q({"cheat-code-input":!0}),"cheat-name-input":q({"cheat-name-input":!0}),"ejs-switch":q({"ejs-switch":!0}),"ejs-delete-cheat":q({"ejs-delete-cheat":!0})},initShaders:function(){var o=xe;for(let e=Object.keys(o),t,n=0;n<e.length;n+=1)t=o[e[n]],g.FS.writeFile("/shader/".concat(e[n]),t),oe.storage.get("shader")===e[n]&&g.FS.writeFile("/shader/shader.glslp",t)},setMessageDialog:function(){this.elements.dialogs.message.innerHTML='<div class="'+ee.classNames["dialog-container"]+'"><div class="'+ee.classNames["dialog-title"]+'"><h2>'+this.localization("Drop to load save state")+"</h2></div></div>"},setGamepadDialog:function(){let r=this,n=(r.elements.dialogs.gamepad.innerHTML='\n        <div class="'+ee.classNames["dialog-container"]+'">\n            <div class="'+ee.classNames["dialog-title"]+'">\n                <h4>'+r.localization("Control Settings")+'</h4>\n            </div>\n            \n            <ul class="'+ee.classNames.tabs+'" id="controls-tabs">\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-0" aria-selected="false" id="controls-0-label">'+r.localization("Player 1")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-1" aria-selected="false" id="controls-1-label">'+r.localization("Player 2")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-2" aria-selected="false" id="controls-2-label">'+r.localization("Player 3")+'</a></li>\n                <li class="tabs-title" role="presentation"><a href="#" onclick="return false" role="tab" aria-controls="controls-3" aria-selected="false" id="controls-3-label">'+r.localization("Player 4")+'</a></li>\n            </ul>\n            <div class="'+ee.classNames["dialog-content"]+'">\n            <div class="'+ee.classNames["tabs-content"]+' controls">\n                \n            </div>\n            </div>\n            <div class="'+ee.classNames["dialog-buttons"]+'">\n                <a href="#" onclick="return false" class="'+ee.classNames["btn-reset"]+'">'+r.localization("Reset")+'</a>\n                <a href="#" onclick="return false" class="'+ee.classNames["btn-clear"]+'">'+r.localization("Clear")+'</a>\n                <a href="#" onclick="return false" style="background-color:#929292;" class="'+ee.classNames["btn-close"]+'">'+r.localization("Close")+'</a>\n            </div>\n            <div class="'+ee.classNames.overlay+'" hidden>\n                <div class="'+ee.classNames["key-setting-popup"]+'">\n                    <span>[Select]</span><br />\n                    <div style="color:#fff !important">'+r.localization("Press keyboard or gamepad")+"</div>\n                </div>\n            </div>\n        </div>\n        ",'\n        <div class="'.concat(ee.classNames["tabs-panel"],'" id="controls-{index}" hidden>\n            <div>\n                <div style="">\n                    <div class="gamepad" style="font-size:12px">Connected gamepad: <span class="gamepad-name">n/a</span></div>\n                </div>\n                <div style="width:25%;float:left">&nbsp;</div>\n                <div style="font-size:12px;width:50%;float:left">\n                    <div class="row">\n                        <div style="text-align:center;width:50%;float:left">'+r.localization("Gamepad")+'</div>\n                        <div style="text-align:center;width:50%;float:left">'+r.localization("Keyboard")+'</div>\n                    </div>\n                </div>\n                <div style="clear:both"></div>\n            </div>\n        </div>')),o='\n        <div class="'.concat(ee.classNames["button-container"],'" data-id="{id}" data-index="{index}" data-label="{label}" style="margin-bottom:10px">\n            <div style="width:25%;float:left;font-size:12px">\n                <label>{label}:</label>\n            </div>\n            <div style="width:50%;float:left">\n                <div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="2" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="width:50%;float:left;padding: 0 5px;">\n                        <input style="text-align:center;height:25px;width: 100%;" type="text" data-id="{id}" data-value="" data-type="1" data-index="{index}" readonly="" placeholder="">\n                    </div>\n                    <div style="clear:both"></div>\n                </div>\n            </div>\n            <div style="width:25%;float:left">\n                <a class="').concat(ee.classNames.set,'" href="#" onclick="return false">'+r.localization("Set")+'</a>\n            </div>\n            <div style="clear:both"></div>\n        </div>'),a;"nes"===getSystem(r.system,!0)?a={0:"B",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",24:r.localization("QUICK SAVE STATE"),25:r.localization("QUICK LOAD STATE"),26:r.localization("CHANGE STATE SLOT")}:"snes"===getSystem(r.system,!0)?a={0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",24:r.localization("QUICK SAVE STATE"),25:r.localization("QUICK LOAD STATE"),26:r.localization("CHANGE STATE SLOT")}:"n64"===getSystem(r.system,!0)?(a={0:"B",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",10:"L",11:"R",12:"Z",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:r.localization("QUICK SAVE STATE"),25:r.localization("QUICK LOAD STATE"),26:r.localization("CHANGE STATE SLOT")},2===r.coreVer&&(a[0]="A",a[1]="B",delete a[8])):a="nds"===getSystem(r.system,!0)?{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",14:"Microphone",24:r.localization("QUICK SAVE STATE"),25:r.localization("QUICK LOAD STATE"),26:r.localization("CHANGE STATE SLOT")}:{0:"B",1:"Y",2:"SELECT",3:"START",4:"UP",5:"DOWN",6:"LEFT",7:"RIGHT",8:"A",9:"X",10:"L",11:"R",12:"L2",13:"R2",14:"L3",15:"R3",19:"L STICK UP",18:"L STICK DOWN",17:"L STICK LEFT",16:"L STICK RIGHT",23:"R STICK UP",22:"R STICK DOWN",21:"R STICK LEFT",20:"R STICK RIGHT",24:r.localization("QUICK SAVE STATE"),25:r.localization("QUICK LOAD STATE"),26:r.localization("CHANGE STATE SLOT")},["arcade","mame"].includes(getSystem(r.system,!0))&&(a[2]=r.localization("INSERT COIN")),!1===r.statesSupported&&(delete a[24],delete a[25],delete a[26]);for(let e=[2,3,4,5,6,7,8,0,9,1,10,11,12,13,14,15,19,18,17,16,23,22,21,20,24,25,26],t=0;t<=3;t+=1)!function(t){r.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames["tabs-content"])).innerHTML+=n.replace(/{index}/g,t),e.forEach(function(e){a[e]&&(r.elements.dialogs.gamepad.querySelector("#controls-".concat(t)).innerHTML+=o.replace(/{index}/g,t).replace(/{id}/g,e).replace(/{label}/g,a[e]))}),r.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="16"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="17"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="18"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="19"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="20"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="21"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="22"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc"),r.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(t,'"][data-type="2"]'))&&(r.elements.dialogs.gamepad.querySelector('[data-id="23"][data-index="'.concat(t,'"][data-type="2"]')).style.backgroundColor="#ccc")}(t);Object.keys(ee.controllers).forEach(function(o){ee.controllers[o]&&Object.keys(ee.controllers[o]).forEach(function(e){let t=r.elements.dialogs.gamepad.querySelector('[data-id="'.concat(e,'"][data-index="').concat(o,'"][data-type="1"]')),n=r.elements.dialogs.gamepad.querySelector('[data-id="'.concat(e,'"][data-index="').concat(o,'"][data-type="2"]'));if(!t||!n)return!1;e=ee.controllers[o][e];e&&(e.type&&1!==parseInt(e.type,10)?n.value="":e.value&&(t.value=ee.keyMap[e.value]||"",t.setAttribute("data-value",e.value)),e.value2&&(n.value=isNaN(e.value2)?e.value2:"button ".concat(parseInt(e.value2,10)+1),n.setAttribute("data-value",e.value2)))})}),F.call(this,r.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames["btn-close"])),"click",function(e){let t=r.elements.dialogs.gamepad.querySelectorAll("input"),a={};return Array.from(t).forEach(function(e){let t,n=e.getAttribute("data-index"),o=e.getAttribute("data-value");2===parseInt(e.getAttribute("data-type"),10)&&(t=e.getAttribute("data-value"));e=e.getAttribute("data-id");a[n]||(a[n]={}),a[n][e]||(a[n][e]={}),o&&(a[n][e].value=o),t&&(a[n][e].value2=t)}),oe.storage.set({controllers:a}),ee.controllers=a,V(r.elements.dialogs.gamepad,!0),r.elements.container.focus(),e.stopPropagation(),!1}),F.call(this,r.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames["btn-reset"])),"click",function(e){ee.controllers=JSON.parse(JSON.stringify(ee.defaultControllers)),localStorage.removeItem(oe.storage.key);let t=r.elements.dialogs.gamepad.querySelectorAll("input");for(let e=0;e<t.length;e++){var n=t[e].getAttribute("data-index"),o=t[e].getAttribute("data-type"),a=t[e].getAttribute("data-id"),i=1==o?"value":"value2";ee.defaultControllers[n]&&ee.defaultControllers[n][a]&&ee.defaultControllers[n][a][i]?(t[e].value=1==o?ee.keyMap[ee.defaultControllers[n][a][i]]:"button "+(parseInt(ee.defaultControllers[n][a][i])+1),t[e].setAttribute("data-value",ee.defaultControllers[n][a][i])):(t[e].value="",t[e].setAttribute("data-value",""))}}),F.call(this,r.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames["btn-clear"])),"click",function(e){let t={0:{},1:{},2:{},3:{}};for(var n in a)t[0][n]={},t[1][n]={},t[2][n]={},t[3][n]={};ee.controllers=t,localStorage.setItem(oe.storage.key,JSON.stringify({controllers:ee.controllers}));let o=r.elements.dialogs.gamepad.querySelectorAll("input");for(let e=0;e<o.length;e++)o[e].value="",o[e].setAttribute("data-value","")}),Array.from(r.elements.dialogs.gamepad.querySelectorAll(".".concat(ee.classNames.tabs," li"))).forEach(function(n){F.call(r,n,"mousedown",function(e){G(r.elements.dialogs.gamepad.querySelectorAll(".".concat(ee.classNames.tabs," li")),ee.classNames.active,!1),G(n,ee.classNames.active,!0);var t=n.querySelector("a").getAttribute("aria-controls");return Array.from(r.elements.dialogs.gamepad.querySelectorAll(".".concat(ee.classNames["tabs-content"]," .").concat(ee.classNames["tabs-panel"]))).forEach(function(e){V(e,!0)}),V(r.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames["tabs-content"]," #").concat(t)),!1),e.stopPropagation(),!1})}),B.call(r,r.elements.dialogs.gamepad.querySelector('[aria-controls="controls-0"]').parentNode,"mousedown");let l=r.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames.overlay));F.call(r,l,"mousedown",function(e){V(l,!0),e.stopPropagation()}),Array.from(r.elements.dialogs.gamepad.querySelectorAll(".".concat(ee.classNames["button-container"]))).forEach(function(t){F.call(r,t,"mousedown",function(e){B.call(r,t.querySelector("a.".concat(ee.classNames.set)),e.type,!0,{})})}),Array.from(r.elements.dialogs.gamepad.querySelectorAll(".".concat(ee.classNames["tabs-panel"]," a.").concat(ee.classNames.set))).forEach(function(s){F.call(r,s,"mousedown",function(e){let t=s.parentNode.parentNode,n=t.getAttribute("data-id"),o=t.getAttribute("data-index"),a=t.getAttribute("data-label"),i=(V(l,!1),l.setAttribute("data-id",n),l.setAttribute("data-index",o),"[ ".concat(a," ]"));ee.gamepad.gamepads[o]&&n<16?i+='<br /><span style="font-size:12px">Gamepad:'.concat(ee.gamepad.gamepads[o].id,"</span><br />"+r.localization("Press keyboard or gamepad")+"<br/>"+r.localization("Press escape (esc) to clear")):i+="<br />Press keyboard<br/>"+r.localization("Press escape (esc) to clear"),l.querySelector(".".concat(ee.classNames["key-setting-popup"])).innerHTML=i,e.stopPropagation()})})},setCacheDialog:function(){let t=this;t.elements.dialogs.cache.innerHTML='\n        <div class="'+ee.classNames["dialog-container"]+'">\n            <div class="'+ee.classNames["dialog-title"]+'">\n                <h4>'+t.localization("Cache Manager")+'</h4>\n            </div>\n            <div class="'+ee.classNames["dialog-content"]+'">\n\n            </div>\n            <div class="'+ee.classNames["dialog-buttons"]+'">\n                <a href="#" onclick="return false" class="'+ee.classNames["btn-clear-all"]+'">'+t.localization("Clear All")+'</a>\n                <a href="#" onclick="return false" class="'+ee.classNames["btn-cancel"]+'">'+t.localization("Close")+"</a>\n            </div>\n        </div>\n        ",F.call(this,t.elements.dialogs.cache.querySelector(".".concat(ee.classNames["btn-cancel"])),"click",function(e){return V(t.elements.dialogs.cache,!0),t.elements.container.focus(),e.stopPropagation(),!1}),F.call(this,t.elements.dialogs.cache.querySelector(".".concat(ee.classNames["btn-clear-all"])),"click",function(e){return g.romdb&&(g.romdb.clear(),t.elements.dialogs.cache.querySelector(".".concat(ee.classNames["dialog-content"])).innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"),_0x46992d.stopPropagation(),!1}),F.call(this,t.elements.dialogs.cache.querySelector(".".concat(ee.classNames["dialog-title"]," a")),"click",function(e){return g.romdb&&(g.romdb.clear(),t.elements.dialogs.cache.querySelector(".".concat(ee.classNames["dialog-content"])).innerHTML='<div style="text-align:center">'+t.localization("Empty")+"</div>"),e.stopPropagation(),!1})},showLoading:function(e){y.show("modal-6ed698f3d04061f5",{closeByEsckey:!1}),e&&console.log(""),V(this.elements.dialogs.loading,!1)},hideLoading:function(){y.close(),V(this.elements.dialogs.loading,!0)},setLoadingDialog:function(){this.elements.dialogs.loading&&(this.elements.dialogs.loading.innerHTML='\n            <div class="'.concat(ee.classNames.modal," ").concat(ee.classNames["micromodal-slide"],'" id="modal-6ed698f3d04061f5" aria-hidden="true">\n                <div class="').concat(ee.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(ee.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-6ed698f3d04061f5-title">\n                '+this.localization("Loading")+"...\n                </div>\n                </div>\n            </div>"))},setCheatDialog:function(){let s=this;if(s.elements.dialogs.cheat){s.elements.dialogs.cheat.innerHTML='\n            <div class="'.concat(ee.classNames["dialog-container"],'">\n                <div class="').concat(ee.classNames["dialog-title"],'">\n                    <h4>Cheats</h4>\n                </div>\n                <div class="').concat(ee.classNames["dialog-content"],'">\n                    <div class="').concat(ee.classNames["cheats-list"],'">\n                        \n                    </div>\n                </div>\n                <div class="').concat(ee.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(ee.classNames["cheats-add"],'">'+s.localization("Add Cheat")+'</a>\n                    <a href="#" onclick="return false" class="').concat(ee.classNames["btn-cancel"],'">Close</a>\n                </div>\n            </div>\n\n            \n\n            <div class="').concat(ee.classNames.modal," ").concat(ee.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484b" aria-hidden="true">\n                <div class="').concat(ee.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(ee.classNames.modal__container,'" style="width:100%" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484b-title">\n                    <div class="').concat(ee.classNames.modal__header,'">\n                    <h2 class="').concat(ee.classNames.modal__title,'" id="modal-85cd7a1c543a484b-title">\n                    '+s.localization("Add Cheat Code")+'\n                    </h2>\n                    <button class="').concat(ee.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(ee.classNames.modal__content,'" id="modal-85cd7a1c543a484b-content">\n\n                        <div class="').concat(ee.classNames.modal__errmsg,'"></div>\n                        <strong>'+s.localization("Code")+'</strong><br />\n                        <textarea style="width:100%;height:80px;" class="').concat(ee.classNames["cheat-code-input"],'"></textarea><br />\n                        <strong>'+s.localization("Description")+'</strong><br />\n                        <input type="text" class="').concat(ee.classNames["cheat-name-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(ee.classNames.modal__footer,'">\n                    <button class="').concat(ee.classNames.modal__btn," ").concat(ee.classNames["modal__btn-primary"],'">'+s.localization("Submit")+'</button>\n                    <button class="').concat(ee.classNames.modal__btn,'" data-modal-close aria-label="Close">'+s.localization("Close")+"</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            ");let a=s.elements.dialogs.cheat.querySelector("#modal-85cd7a1c543a484b"),i=(F.call(this,s.elements.dialogs.cheat.querySelector(".".concat(ee.classNames["cheats-add"])),"click",function(e){return y.show("modal-85cd7a1c543a484b",{closeTrigger:"data-modal-close"}),!1}),s.elements.dialogs.cheat.querySelector(".".concat(ee.classNames["cheats-list"]))),o=(F.call(this,a.querySelector(".".concat(ee.classNames["modal__btn-primary"])),"click",function(e){var t=a.querySelector(".".concat(ee.classNames["cheat-name-input"])).value,n=a.querySelector(".".concat(ee.classNames["cheat-code-input"])).value;if(t&&n){let e=i.querySelectorAll("input:checked");a.querySelector(".".concat(ee.classNames["cheat-name-input"])).value="",a.querySelector(".".concat(ee.classNames["cheat-code-input"])).value="",y.close();var o=s.cheats.length;s.cheats.push([t,n]),i.innerHTML+='<div class="'.concat(ee.classNames["ejs-switch"],'">\n                            <input type="checkbox" value="').concat(o,'" id="ejs-cheat-switch-').concat(o,'">\n                            <label for="ejs-cheat-switch-').concat(o,'">').concat(t,'</label>\n                            <a href="#" data-idx="').concat(o,'" onclick="return false" class="').concat(ee.classNames["ejs-delete-cheat"],'">&times;</a>\n                        </div>'),e.forEach(function(e,t){i.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")})}return"localStorage"in window&&s.getStartName()&&(localStorage.setItem("".concat(s.system,"-").concat(s.getStartName(),"-cheats"),JSON.stringify(s.cheats)),e.stopPropagation()),!1}),function(){if("localStorage"in window&&s.getStartName()){let e=localStorage.getItem("".concat(s.system,"-").concat(s.getStartName(),"-cheats"));try{e=JSON.parse(e)}catch(e){}e&&(s.cheats=e)}i.innerHTML="",s.cheats&&Array.isArray(s.cheats)&&s.cheats.forEach(function(e,t){var n=e[0];e[1],i.innerHTML+='<div class="'.concat(ee.classNames["ejs-switch"],'">\n                                <input type="checkbox" value="').concat(t,'" id="ejs-cheat-switch-').concat(t,'">\n                                <label for="ejs-cheat-switch-').concat(t,'">').concat(n,'</label>\n                                <a href="#" data-idx="').concat(t,'" onclick="return false" class="').concat(ee.classNames["ejs-delete-cheat"],'">&times;</a>\n                            </div>')})});F.call(s,i,"click",function(e){if(e.target&&e.target.classList.contains(ee.classNames["ejs-delete-cheat"])&&e.target.getAttribute("data-idx")){var t=e.target.getAttribute("data-idx");s.cheats.splice(t,1),"localStorage"in window&&s.getStartName()&&localStorage.setItem("".concat(s.system,"-").concat(s.getStartName(),"-cheats"),JSON.stringify(s.cheats));let n=[];i.querySelectorAll("input").forEach(function(e,t){n[t]=!!i.querySelector("#ejs-cheat-switch-".concat(t,":checked"))}),n.splice(t,1),o(),n.forEach(function(e,t){e&&i.querySelector("#ejs-cheat-switch-".concat(t)).setAttribute("checked","checked")})}return e.stopPropagation(),!1}),F.call(s,s.elements.container,"start-game",function(e){o()}),F.call(this,s.elements.dialogs.cheat.querySelector(".".concat(ee.classNames["btn-cancel"])),"click",function(e){return ee.resetCheat(),i.querySelectorAll("input:checked").forEach(function(e,t){e=s.cheats[e.value];e&&ee.setCheat(t,1,e[1])}),V(s.elements.dialogs.cheat,!0),s.elements.container.focus(),!1}),"arcade"!==getSystem(s.system,!0)&&"mame"!==getSystem(s.system,!0)&&"mame2003"!==getSystem(s.system,!0)&&"mame2010"!==getSystem(s.system,!0)||(D.element(s.elements.buttons.cheat)&&V(s.elements.buttons.cheat,!0),ee.allowCheat=!1),ee.setCheat||(V(s.elements.buttons.cheat,!0),ee.allowCheat=!1)}},setNetplayDialog:function(){var n,i,o,a,r,l,c,d,e,s,u,f,p=this,m=this,h=this;m.elements.dialogs.netplay&&(m.elements.dialogs.netplay.innerHTML='\n            <div class="'.concat(ee.classNames["dialog-container"],'">\n                <div class="').concat(ee.classNames["dialog-title"],'">\n                    <h4>'+m.localization("Netplay")+'</h4>\n                </div>\n                <div class="').concat(ee.classNames["dialog-content"],'">\n                    <div class="').concat(ee.classNames["netplay-roomlist"],'" hidden>\n                        <strong>'+m.localization("Rooms")+'</strong>\n                        <table style="width:100%" cellspacing=0>\n                            <thead>\n                                <tr>\n                                    <td>'+m.localization("Room Name")+"</td>\n                                    <td>"+m.localization("Players")+'</td>\n                                    <td></td>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td></td>\n                                    <td></td>\n                                    <td></td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n\n                    <div class="').concat(ee.classNames["netplay-room"],'" hidden>\n                        <strong>'+m.localization("Room Name")+"</strong>\n                        <div data-room-password>"+m.localization("Password")+': <span></span></div>\n                        <table style="width:100%" cellspacing="0">\n                            <thead>\n                            <tr>\n                                <td>'+m.localization("Player")+"</td>\n                                <td>"+m.localization("Name")+"</td>\n                                <td></td>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            <tr>\n                                <td>1</td>\n                                <td>"+m.localization("Name")+" 1</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>2</td>\n                                <td>"+m.localization("Name")+" 2</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>3</td>\n                                <td>"+m.localization("Name")+" 3</td>\n                                <td></td>\n                            </tr>\n                            <tr>\n                                <td>4</td>\n                                <td>"+m.localization("Name")+' 4</td>\n                                <td></td>\n                            </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                <div class="').concat(ee.classNames["dialog-buttons"],'">\n                    <a href="#" onclick="return false" class="').concat(ee.classNames["btn-quit"],'">'+m.localization("Quit Room")+'</a>\n                    <a href="#" onclick="return false" class="').concat(ee.classNames["btn-create-room"],'">'+m.localization("Create a Room")+'</a>\n                    <a href="#" onclick="return false" class="').concat(ee.classNames["btn-cancel"],'">'+m.localization("Close")+'</a>\n                </div>\n            </div>\n\n            \n            <div class="').concat(ee.classNames.modal," ").concat(ee.classNames["micromodal-slide"],'" id="modal-9de6c4e9ce2b9361" aria-hidden="true">\n                <div class="').concat(ee.classNames.modal__overlay,'" tabindex="-1">\n                <div class="').concat(ee.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-9de6c4e9ce2b9361-title">\n                    <div class="').concat(ee.classNames.modal__header,'">\n                    <h2 class="').concat(ee.classNames.modal__title,'" id="modal-9de6c4e9ce2b9361-title">\n                        '+m.localization("Set Player Name")+'\n                    </h2>\n                    </div>\n                    <main class="').concat(ee.classNames.modal__content,'" id="modal-9de6c4e9ce2b9361-content">\n\n                        <div class="').concat(ee.classNames.modal__errmsg,'"></div>\n                        <strong>'+m.localization("Player Name")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(ee.classNames["netplay-player-name"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(ee.classNames.modal__footer,'">\n                    <button class="').concat(ee.classNames.modal__btn," ").concat(ee.classNames["modal__btn-primary"],'">'+m.localization("Submit")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            <div class="').concat(ee.classNames.modal," ").concat(ee.classNames["micromodal-slide"],'" id="modal-85cd7a1c543a484a" aria-hidden="true">\n                <div class="').concat(ee.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(ee.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-85cd7a1c543a484a-title">\n                    <div class="').concat(ee.classNames.modal__header,'">\n                    <h2 class="').concat(ee.classNames.modal__title,'" id="modal-85cd7a1c543a484a-title">\n                    '+m.localization("Create a Room")+'\n                    </h2>\n                    <button class="').concat(ee.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(ee.classNames.modal__content,'" id="modal-85cd7a1c543a484a-content">\n\n                        <div class="').concat(ee.classNames.modal__errmsg,'"></div>\n                        <strong>'+m.localization("Room Name")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(ee.classNames["netplay-room-name-input"],'" /><br />\n                        <strong>Max Players</strong><br />\n                        <select data-max-players>\n                            <option value="2">2</option>\n                            <option value="3">3</option>\n                            <option value="4">4</option>\n                        </select>\n                        <br />\n                        <strong>'+m.localization("Password (optional)")+'</strong><br />\n                        <input type="text" maxlength="10" class="').concat(ee.classNames["netplay-room-password-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(ee.classNames.modal__footer,'">\n                    <button class="').concat(ee.classNames.modal__btn," ").concat(ee.classNames["modal__btn-primary"],'">'+m.localization("Submit")+'</button>\n                    <button class="').concat(ee.classNames.modal__btn,'" data-modal-close aria-label="Close">'+m.localization("Close")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            <div class="').concat(ee.classNames.modal," ").concat(ee.classNames["micromodal-slide"],'" id="modal-5aa765d61d8327de" aria-hidden="true">\n                <div class="').concat(ee.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(ee.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-5aa765d61d8327de-title">\n                    <div class="').concat(ee.classNames.modal__header,'">\n                    <h2 class="').concat(ee.classNames.modal__title,'" id="modal-5aa765d61d8327de-title">\n                        '+m.localization("Password")+'\n                    </h2>\n                    <button class="').concat(ee.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(ee.classNames.modal__content,'" id="modal-5aa765d61d8327de-content">\n\n                        <div class="').concat(ee.classNames.modal__errmsg,'"></div>\n                        <input type="text" maxlength="10" class="').concat(ee.classNames["netplay-room-password-input"],'" /><br />\n\n                    </main>\n                    <footer class="').concat(ee.classNames.modal__footer,'">\n                    <button class="').concat(ee.classNames.modal__btn," ").concat(ee.classNames["modal__btn-primary"],'">'+m.localization("Submit")+'</button>\n                    <button class="').concat(ee.classNames.modal__btn,'" data-modal-close aria-label="Close">'+m.localization("Close")+'</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            \n            <div class="').concat(ee.classNames.modal," ").concat(ee.classNames["micromodal-slide"],'" id="modal-7d8fd50ed642340b" aria-hidden="true">\n                <div class="').concat(ee.classNames.modal__overlay,'" tabindex="-1" data-modal-close>\n                <div class="').concat(ee.classNames.modal__container,'" role="dialog" aria-modal="true" aria-labelledby="modal-7d8fd50ed642340b-title">\n                    <div class="').concat(ee.classNames.modal__header,'">\n                    <h2 class="').concat(ee.classNames.modal__title,'" id="modal-7d8fd50ed642340b-title"></h2>\n                    <button class="').concat(ee.classNames.modal__close,'" aria-label="Close modal" data-modal-close></button>\n                    </div>\n                    <main class="').concat(ee.classNames.modal__content,'" id="modal-7d8fd50ed642340b-content">\n                        \n                    </main>\n                    <footer class="').concat(ee.classNames.modal__footer,'">\n                    <button class="').concat(ee.classNames.modal__btn," ").concat(ee.classNames["modal__btn-primary"],'" data-modal-close>OK</button>\n                    </footer>\n                </div>\n                </div>\n            </div>\n            \n            '),F.call(this,m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-cancel"])),"click",function(e){return V(m.elements.dialogs.netplay,!0),ee.disableControl(!1),ee.stopLoadRooms(),e.stopPropagation(),m.elements.container.focus(),!1}),window.setInterval(function(){var o="<ul>";ee.players.forEach(function(e,t){var n=null;e?(ee.connection.peers[e]?n=ee.connection.peers[e].extra:ee.connection.userid===e&&(n=ee.connection.extra),o+="<li>".concat(t+1,". ").concat(n.name,"</li>")):o+="<li>".concat(t+1,". </li>")}),o+="</ul>",m.elements.widgets.netplay.innerHTML=o},500),n=m.elements.dialogs.netplay.querySelector("#modal-9de6c4e9ce2b9361"),i=m.elements.dialogs.netplay.querySelector("#modal-85cd7a1c543a484a"),o=m.elements.dialogs.netplay.querySelector("#modal-7d8fd50ed642340b"),a=m.elements.dialogs.netplay.querySelector("#modal-5aa765d61d8327de"),r={},ee.connection=new Be,(e=p.serverURL.replace("http:","ws:").replace("https:","wss:")).endsWith("/")||(e+="/"),ee.connection.socketURL=e,e=X.info(),ee.connection.extra={name:ee.playerName,game_id:m.config.gameId,browser_name:e.name,room_name:" ",domain:document.domain},ee.connection.maxParticipantsAllowed=4,l=ee.netPlayInitFrame=0,c=!1,Module.postMainLoop=function(){var e,t;if(ee.currentFrame=parseInt(ee.currentFrameNum(),10),ee.connected)if(l+=1,ee.connection.isInitiator)if(1<=l){for(var n=[],o=ee.currentFrame-1;o<ee.currentFrame;o+=1)ee.inputsData[o]?ee.inputsData[o].forEach(function(e,t){n.push("".concat(e.index,"|").concat(e.key,"|").concat(e.status,"|").concat(e.frame))}):n.push("-1|||".concat(o));ee.connection.send(JSON.stringify({act:"sync-control",value:n})),l=0,ee.currentFrame%100==0&&Object.keys(ee.inputsData).forEach(function(e,t){e<ee.currentFrame-50&&(ee.inputsData[e]=null,delete ee.inputsData[e])});return}else return;else{if(ee.coreOptionData[ee.currentFrame]&&(e=ee.coreOptionData[ee.currentFrame].key,t=ee.coreOptionData[ee.currentFrame].value,oe.updateCoreOptions.call(m,e,t),delete ee.coreOptionData[ee.currentFrame]),ee.currentFrame<=0||ee.inputsData[ee.currentFrame])ee.wait=!1,ee.systemPause(0),g.Module.resumeMainLoop(),e=ee.inputsData[ee.currentFrame],ee.inputsData[ee.currentFrame]=null,delete ee.inputsData[ee.currentFrame],(e=e||[]).forEach(function(e,t){0<=e.index&&ee.simulateInputFn(e.index,e.key,e.status)});else{ee.wait=!0,ee.systemPause(1),g.Module.pauseMainLoop();var a=!1,i=Object.keys(ee.inputsData);0==i.length&&(a=!0);for(var s=0;s<i.length;s+=1)if(i[s]>ee.currentFrame){console.log("lost",ee.currentFrame),a=!0;break}a?ee.wait||(!c||c<(new Date).valueOf()-3e3)&&(ee.inputsData={},c=(new Date).valueOf(),ee.connection.send(JSON.stringify({act:"sync-mem",value:ee.connection.userid}),ee.roomMaster)):(ee.wait=!0,ee.systemPause(1),g.Module.pauseMainLoop())}ee.currentFrame%100==0&&Object.keys(ee.inputsData).forEach(function(e,t){e<ee.currentFrame-50&&(ee.inputsData[e]=null,delete ee.inputsData[e])})}},ee.connection.onopen=function(n){console.log("open",n),ee.connected=!0,ee.connection.isInitiator&&(-1===ee.players.indexOf(n)&&(0<ee.players.filter(function(e,t){return null==e}).length?ee.players.forEach(function(e,t){null!=e||ee.players.includes(n)||(ee.players[t]=n)}):ee.players.push(n)),ee.connection.send(JSON.stringify({act:"get-players-result",value:ee.players,coreOptions:oe.coreOptionsValues,newuser:n,master:ee.connection.userid}))),oe.updateCoreOptionMenuItems.call(m)},ee.connection.onFileStart=function(e){e=e.name.split("-");"reset"!==e[0]&&0!=e[0]||(ee.inputsData={},ee.disableControl(!0)),ee.showLoading.call(m),ee.connection.isInitiator?(ee.wait=!0,ee.systemPause(1),g.Module.pauseMainLoop()):ee.inputsData={}},d=!(ee.connection.onFileEnd=function(e){ee.hideLoading.call(m);var t=e.name.split("-"),n=t[0]>>0;"reset"===t[0]?(n=0,ee.connection.isInitiator?(ee.systemPause(0),ee.disableControl(!1)):(ee.inputsData={},t=e.data,ee.loadState(t,n),ee.wait=!1,ee.systemPause(0),ee.disableInput=!1),m.playing=!0,g.Module.resumeMainLoop()):"game.state"===t[1]&&(ee.connection.isInitiator?(ee.openRoom(m),ee.wait=!1,ee.systemPause(0)):(ee.netPlayInitFrame=n,t=e.data,ee.loadState(t,n),ee.wait=!1,ee.disableInput=!1,ee.connection.send(JSON.stringify({act:"wait-end",value:ee.connection.userid})),ee.hideLoading.call(m),m.playing=!0),g.Module.resumeMainLoop()),ee.connection.isInitiator||console.log("recv mem end",ee.currentFrame,e.name)}),ee.connection.onmessage=function(e){var t,s,n,o,e=e.data||e;try{t=JSON.parse(e)}catch(e){t=null}t&&("room-master"===t.act&&(ee.roomMaster=t.value),t.act,"short-pause"!==t.act||d||(ee.systemPause(1),g.Module.pauseMainLoop(),d=!0,ee.wait=!0,setTimeout(function(){ee.systemPause(0),g.Module.resumeMainLoop(),ee.wait=!1,d=!1},48)),"sync-control"===t.act&&(e=t.value,m.playing||ee.wait,s=ee.connection.userid,ee.players.indexOf(s),ee.connection.isInitiator,e.forEach(function(e,t){var e=e.split("|"),n=e[0]>>0,o=e[1]>>0,a=e[2]>>0,e=e[3]>>0,i=ee.currentFrame;ee.inputsData[e]||(ee.inputsData[e]=[]),-1!=n&&e===i&&ee.simulateInputFn(n,o,a),ee.connection.isInitiator?0<=n&&(ee.inputsData[i]||(ee.inputsData[i]=[]),-2!=o&&(ee.inputsData[i].push({index:n,key:o,status:a,frame:i}),ee.simulateInputFn(n,o,a)),d||e<=i-10&&(ee.systemPause(1),g.Module.pauseMainLoop(),d=!0,ee.wait=!0,setTimeout(function(){ee.systemPause(0),g.Module.resumeMainLoop(),ee.wait=!1,d=!1},48))):(""!==n&&ee.inputsData[e].push({index:n,key:o,status:a,frame:e}),ee.inputsData[ee.currentFrame]&&g.Module.resumeMainLoop(),i+10<=e&&e>ee.netPlayInitFrame+100&&ee.connection.send(JSON.stringify({act:"short-pause",value:s}),ee.roomMaster))})),t.act,t.act,"update-core-option"!==t.act||ee.connection.isInitiator||(ee.coreOptionData[t.frame]={key:t.key,value:t.value}),"restart-game"===t.act&&(ee.inputsData={},ee.connection.send(JSON.stringify({act:"sync-mem",value:ee.connection.userid}),ee.roomMaster)),"pause"===t.act&&g.Module.pauseMainLoop(),"resume"===t.act&&g.Module.resumeMainLoop(),"wait"===t.act&&(ee.wait=!0,ee.systemPause(1),t.value!==ee.connection.userid&&(ee.waitingList[t.value]=1),ee.disableControl(!0)),"wait-end"===t.act&&(ee.waitingList[t.value]&&delete ee.waitingList[t.value],0===Object.keys(ee.waitingList).length&&(ee.wait=!1,ee.systemPause(0),ee.disableInput=!1)),"sync-mem"===t.act&&(ee.wait=!0,ee.systemPause(1),n=t.value,ee.disableControl(!0),ee.connection.send(JSON.stringify({act:"wait",value:n})),(async()=>{var e=await ee.saveState(),e=(g.FS.createDataFile("/","game.state",e,!0,!0),g.Module.cwrap("load_state","number",["string","number"])("game.state",0),ee.inputsData={},new File([e],"0-game.state",{type:"",lastModified:new Date}));ee.connection.shareFile(e,n)})()),t.act,"get-players-result"===t.act&&(ee.players=t.value,ee.roomMaster=t.master,t.newuser===ee.connection.userid)&&(o=oe.coreOptionsValues,t.coreOptions&&Object.keys(t.coreOptions).forEach(function(e){o[e]!==t.coreOptions[e]&&oe.updateCoreOptions.call(m,e,t.coreOptions[e])}),ee.showLoading.call(m),ee.disableControl(!0),setTimeout(function(){ee.connection.send(JSON.stringify({act:"sync-mem",value:ee.connection.userid}),ee.roomMaster)},1),ee.roomMaster&&ee.connection.peers[ee.roomMaster]&&(ee.connection.extra.room_name=ee.connection.peers[ee.roomMaster].extra.room_name,ee.connection.updateExtraData()),ee.connection.peers[ee.roomMaster]&&(r=ee.connection.peers[ee.roomMaster].extra),ee.openRoom(m)))},ee.connection.onUserStatusChanged=function(e){console.log("userstatuschanged",e),"offline"===e.status&&0<=(e=ee.players.indexOf(e.userid))&&(ee.players[e]=null)},ee.connection.onleave=function(e){var t;console.log("onleave",e),e.userid&&0<=(t=ee.players.indexOf(e.userid))&&(ee.players[t]=null),ee.waitingList[e.userid]&&delete ee.waitingList[e.userid],ee.connection.isInitiator&&0===Object.keys(ee.waitingList).length&&ee.wait&&(ee.wait=!1,ee.systemPause(0),ee.disableInput=!1,ee.connection.send(JSON.stringify({act:"wait-end",value:ee.connection.userid}))),ee.openRoom(m),ee.inputsData={},ee.hideLoading.call(m)},e=function(){ee.connected=!1,ee.connection.password=null,ee.players=[],ee.connection.peersBackup=[],ee.waitingList={},ee.inputsData={},ee.hideLoading.call(m),V(m.elements.buttons.restart,!1),V(m.elements.buttons.loadState,!1),V(m.elements.buttons.saveState,!1),ee.allowCheat&&V(m.elements.buttons.cheat,!1),V(oe.contextMenu.querySelectorAll("ul li").item(2),!1),V(oe.contextMenu.querySelectorAll("ul li").item(3),!1),Array.from(m.elements.buttons.play).forEach(function(e){V(e,!1)}),oe.updateCoreOptionMenuItems.call(m)},ee.connection.close=e,ee.connection.disconnect=e,ee.connection.leave=e,u=function(e,t,n){ee.hideLoading.call(m),e?(ee.stopLoadRooms(),V(m.elements.buttons.restart,!0),V(m.elements.buttons.loadState,!0),V(m.elements.buttons.saveState,!0),ee.resetCheat(),V(m.elements.buttons.cheat,!0),V(oe.contextMenu.querySelectorAll("ul li").item(2),!0),V(oe.contextMenu.querySelectorAll("ul li").item(3),!0),Array.from(m.elements.buttons.play).forEach(function(e){V(e,!0)})):(y.close(),o.querySelector("#modal-7d8fd50ed642340b-content").innerHTML=n,y.show("modal-7d8fd50ed642340b",{closeTrigger:"data-modal-close"}))},f=function(e){var t=e.target.getAttribute("data-id");if("Y"===e.target.getAttribute("data-password"))y.show("modal-5aa765d61d8327de",{closeTrigger:"data-modal-close"}),a.setAttribute("data-id",t);else{ee.showLoading.call(m),ee.connection.userid=ee.connection.token();try{ee.connection.join(t,u)}catch(e){ee.hideLoading.call(m),o.querySelector("#modal-7d8fd50ed642340b-content").innerHTML="Error",y.show("modal-7d8fd50ed642340b",{closeTrigger:"data-modal-close"})}}return e.stopPropagation(),!1},ee.loadRoomsList=function(){V(m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["netplay-roomlist"])),!1),V(m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["netplay-room"])),!0),V(m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-create-room"])),!1),V(m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-quit"])),!0);let e=m.serverURL;e.endsWith("/")||(e+="/");var r=m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["netplay-roomlist"])).querySelector("tbody"),t=[e,"list?game_id=",m.config.gameId,"&domain=",window.location.hostname].join("");J.a.get(t,{}).then(function(e){var i,s;e.data&&(i=[],s=[],r.querySelectorAll("tr").forEach(function(e){s.push(e.getAttribute("id"))}),e.data.forEach(function(e){var t=e.name,n=(i.push(t),s.includes(t)&&(n=r.querySelector('tr[id="'.concat(t,'"]')),r.removeChild(n)),document.createElement("tr")),o=(n.setAttribute("id",t),e.password?ee.icons.lock:""),a=e.password?"Y":"N",t=e.users<e.max_users?'<span data-id="'.concat(t,'" data-password="').concat(a,'" class="').concat(ee.classNames["btn-join-room"],'">Join</span>'):"";n.innerHTML="<td>".concat(o," ").concat(e.name,"</td><td>").concat(e.users,"/").concat(e.max_users,"</td><td>").concat(t,"</td>"),F.call(p,n.querySelector(".".concat(ee.classNames["btn-join-room"])),"click",f),r.appendChild(n)}),r.querySelectorAll("tr").forEach(function(e){i.includes(e.id)||r.removeChild(e)})),ee.loadRoomsListTimer=setTimeout(ee.loadRoomsList,2e3)}).catch(function(e){console.log("Network Error",e),ee.loadRoomsListTimer=setTimeout(ee.loadRoomsList,2e3)})},ee.openRoom=function(){ee.stopLoadRooms(),V(h.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["netplay-roomlist"])),!0),V(h.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["netplay-room"])),!1),V(h.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-create-room"])),!0),V(h.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-quit"])),!1),ee.resetCheat(),V(h.elements.buttons.cheat,!0);var e=h.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["netplay-room"])),t=e.querySelector("[data-room-password]"),o=(null===ee.connection.password?V(t,!0):(V(t,!1),t.querySelector("span").innerText=ee.connection.password),e.querySelector("tbody"));o.innerHTML="",e.querySelector("strong").innerText=r.room_name,ee.players.forEach(function(e,t){var n=null;e&&(ee.connection.peers[e]?n=ee.connection.peers[e].extra:ee.connection.userid===e&&(n=ee.connection.extra),n&&n.name)&&((e=document.createElement("tr")).innerHTML="<td>".concat(t+1,"</td><td>").concat(n.name,"</td><td></td>"),o.appendChild(e))})},F.call(this,a.querySelector(".".concat(ee.classNames["modal__btn-primary"])),"click",function(e){var t=a.querySelector(".".concat(ee.classNames["netplay-room-password-input"])).value,t=(ee.showLoading.call(m),ee.connection.password=t,a.getAttribute("data-id"));ee.connection.join(t,function(e,t,n){u(e,0,n),e&&a.classList.remove(_0x449eac({"is-open":!0}))}),e.stopPropagation()}),F.call(this,n.querySelector(".".concat(ee.classNames["modal__btn-primary"])),"click",function(e){var t=(t=n.querySelector(".".concat(ee.classNames["netplay-player-name"])).value).replace(/<|>/g,"");n.querySelector(".".concat(ee.classNames.modal__errmsg)).innerHTML="",t.trim()&&(ee.playerName=t.trim(),ee.connection.extra.name=t.trim(),y.close()),e.stopPropagation()}),F.call(this,i.querySelector(".".concat(ee.classNames["modal__btn-primary"])),"click",function(e){var t=(t=i.querySelector(".".concat(ee.classNames["netplay-room-name-input"])).value).replace(/<|>/g,""),n=i.querySelector("select[data-max-players] option:checked").value;4<(n=n<2?2:n)&&(n=4);for(var o=0;o<n;o++)ee.players[o]=null;ee.connection.maxParticipantsAllowed=n;var a=i.querySelector(".".concat(ee.classNames["netplay-room-password-input"])).value;i.querySelector(".".concat(ee.classNames.modal__errmsg)).innerHTML="",t.trim()?(ee.connection.extra.room_name=t.trim(),""!==a.trim()&&(ee.connection.password=a.trim()),ee.showLoading.call(m),ee.connection.open(ee.connection.token(),function(e,t,n){ee.hideLoading.call(m),e?(ee.players[0]=ee.connection.userid,ee.roomMaster=ee.connection.userid,s.closeModal(),ee.stopLoadRooms(),r=ee.connection.extra,ee.openRoom(m),V(oe.contextMenu.querySelectorAll("ul li").item(2),!0),V(oe.contextMenu.querySelectorAll("ul li").item(3),!0)):i.querySelector(".".concat(ee.classNames.modal__errmsg)).innerHTML=n})):s.closeModal(),e.stopPropagation()}),F.call(this,m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-create-room"])),"click",function(e){return s=y.show("modal-85cd7a1c543a484a",{closeTrigger:"data-modal-close",onClose:function(){m.elements.container.focus()}}),e.stopPropagation(),!1}),F.call(this,m.elements.dialogs.netplay.querySelector(".".concat(ee.classNames["btn-quit"])),"click",function(e){return ee.connection.close(),ee.stopLoadRooms(),ee.loadRoomsList(),ee.inputsData={},e.stopPropagation(),!1}),window._0x378b5c=ee)},initKeyboard:function(){let t=this,a=this,i=this.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames.overlay));F.call(this,document.body,"keydown keyup",function(o){if(!(112<=o.which&&o.which<=123)){let e=!t.elements.dialogs.gamepad.hidden&&!i.hidden,n="keydown"===o.type;if(n&&e){let e=i.getAttribute("data-index"),t=i.getAttribute("data-id"),n=null;if(o.key&&"escape"===ee.keyMap[o.keyCode])return(n=a.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(e,'"][data-type="1"]'))).setAttribute("data-value",""),n.value=""(n=a.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(e,'"][data-type="2"]'))).setAttribute("data-value",""),n.value="",void V(i,!0);e=i.getAttribute("data-index"),t=i.getAttribute("data-id"),n=null,o.key&&((n=a.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(e,'"][data-type="1"]'))).setAttribute("data-value",o.keyCode),n.value=ee.keyMap[o.keyCode]),V(i,!0)}else Object.keys(ee.controllers).forEach(function(t){Object.keys(ee.controllers[t]).forEach(function(e){parseInt(ee.controllers[t][e].value,10)===o.keyCode&&["24","25","26"].includes(e)&&"keydown"==o.type&&!o.repeat&&("24"==e?ee.quickSaveState():"25"==e?ee.quickLoadState():"26"==e&&ee.changeStateSlot()),parseInt(ee.controllers[t][e].value,10)===o.keyCode&&(n?16<=e&&e<=23?ee.simulateInput(t,e,32767):ee.simulateInput(t,e,1):ee.simulateInput(t,e,0))})})}}),document.body.addEventListener("keydown",function(e){var t=e.keyCode||e.which;[32,37,38,39,40,112,113,114,115,116,117,118,119,120,121,122,123].includes(t)&&e.srcElement===a.elements.container&&e.preventDefault(),e.srcElement.className.split(/ +/).includes(ee.classNames.set)&&e.preventDefault()})},initGamepad:function(){let r=this,a=this,l=this.elements.dialogs.gamepad.querySelector(".".concat(ee.classNames.overlay)),n;try{n=new be}catch(e){return void console.warn("gamepad not supported")}(ee.gamepad=n).on("buttondown",function(n){if(r.elements.dialogs.gamepad.hidden||l.hidden)Object.keys(ee.controllers[n.gamepadIndex.toString()]).forEach(function(e){var t=n.gamepadIndex.toString();parseInt(ee.controllers[t][e].value2,10)===parseInt(n.index,10)&&["24","25","26"].includes(e)&&("24"==e?ee.quickSaveState():"25"==e?ee.quickLoadState():"26"==e&&ee.changeStateSlot()),parseInt(ee.controllers[t][e].value2,10)===parseInt(n.index,10)&&parseInt(t,10)===parseInt(n.gamepadIndex,10)&&ee.simulateInput(t,e,1)});else{var t=parseInt(l.getAttribute("data-index"),10),o=l.getAttribute("data-id");if(n.gamepadIndex===parseInt(t,10)){let e=null;(e=a.elements.dialogs.gamepad.querySelector('[data-id="'.concat(o,'"][data-index="').concat(t,'"][data-type="2"]'))).setAttribute("data-value",n.index),e.value="button ".concat(n.index+1),V(l,!0)}}}),n.on("buttonup",function(n){Object.keys(ee.controllers).forEach(function(t){Object.keys(ee.controllers[t]).forEach(function(e){parseInt(ee.controllers[t][e].value2,10)===parseInt(n.index,10)&&parseInt(t,10)===parseInt(n.gamepadIndex,10)&&ee.simulateInput(t,e,0)})})}),n.on("axischanged",function(n){var o=.5<(t=n.value)||t<-.5?0<t?1:-1:0;if(r.elements.dialogs.gamepad.hidden||l.hidden){ee.prevButtons||(ee.prevButtons={});let t=!1;var a=n.gamepadIndex.toString();ee.prevButtons[a]||(ee.prevButtons[a]={}),ee.prevButtons[a][n.axis]||(ee.prevButtons[a][n.axis]=0),ee.prevButtons[a].buttonID||(ee.prevButtons[a].buttonID=0);for(let e=0;e<Object.keys(ee.controllers[a]).length;e++){var i=Object.keys(ee.controllers[a])[e];ee.controllers[a][i].value2&&(ee.controllers[a][i].value2.split(":")[0]===n.axis&&parseInt(ee.controllers[a][i].value2.split(":")[1])===o&&["24","25","26"].includes(i)&&("24"==i?(t=!0,ee.quickSaveState()):"25"==i?(t=!0,ee.quickLoadState()):"26"==i&&ee.changeStateSlot()),0==o?ee.controllers[a][i].value2.split(":")[0]===n.axis&&(ee.prevButtons[a][n.axis]=o,ee.prevButtons[a].buttonID=i,ee.simulateInput(a,i,0)):((1===ee.prevButtons[a][n.axis]&&-1==o||-1===ee.prevButtons[a][n.axis]&&1==o)&&ee.simulateInput(a,ee.prevButtons[a].buttonID,0),ee.controllers[a][i].value2.split(":")[0]===n.axis&&parseInt(ee.controllers[a][i].value2.split(":")[1])===o&&(ee.prevButtons[a][n.axis]=o,ee.prevButtons[a].buttonID=i,t=!0,ee.simulateInput(a,i,1))))}if(t)return;if(!r.elements.dialogs.gamepad.hidden&&!l.hidden)return}else if(0!=o){var t=l.getAttribute("data-id"),s=parseInt(l.getAttribute("data-index"),10);let e=r.elements.dialogs.gamepad.querySelector('[data-id="'.concat(t,'"][data-index="').concat(s,'"][data-type="2"]'));e.setAttribute("data-value",n.axis+":"+o),e.value=n.axis+":"+o,V(l,!0)}Math.abs(n.value)<=.1&&(n.value=0);t=n.gamepadIndex;r.coreVer;"LEFT_STICK_X"===n.axis?0<n.value?(ee.simulateInput(t,16,32767*n.value),ee.simulateInput(t,17,0)):(ee.simulateInput(t,17,-32767*n.value),ee.simulateInput(t,16,0)):"LEFT_STICK_Y"===n.axis?0<n.value?(ee.simulateInput(t,18,32767*n.value),ee.simulateInput(t,19,0)):(ee.simulateInput(t,19,-32767*n.value),ee.simulateInput(t,18,0)):"RIGHT_STICK_X"===n.axis?0<n.value?(ee.simulateInput(t,20,32767*n.value),ee.simulateInput(t,21,0)):(ee.simulateInput(t,21,-32767*n.value),ee.simulateInput(t,20,0)):"RIGHT_STICK_Y"===n.axis&&(0<n.value?(ee.simulateInput(t,22,32767*n.value),ee.simulateInput(t,23,0)):(ee.simulateInput(t,23,32767*n.value),ee.simulateInput(t,22,0)))}),n.on("disconnected",function(e){[0,1,2,3].forEach(function(e){var t=n.gamepads[e];a.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=t?t.id:"n/a"})}),n.on("connected",function(e){Object.keys(n.gamepads).forEach(function(e){var t=n.gamepads[e];a.elements.dialogs.gamepad.querySelector("#controls-".concat(e," .gamepad-name")).innerHTML=t?t.id:"n/a"})})},setShader:function(e){"disabled"===e?(g.FS.unlink("/shader/shader.glslp",""),ee.toggleShader&&ee.toggleShader(0)):(ee.toggleShader&&ee.toggleShader(0),e="/shader/".concat(e),g.FS.writeFile("/shader/shader.glslp",g.FS.readFile(e)),ee.toggleShader&&ee.toggleShader(1))},toggleVirtualGamepad:function(e,t){let l=this;if(ee.virtualGamepadContainer&&!t)V(ee.virtualGamepadContainer,!e);else{ee.virtualGamepadContainer||(ee.virtualGamepadContainer=U("div",{class:q({"ejs-virtual-gamepad":!0}),hidden:""}),this.elements.container.appendChild(ee.virtualGamepadContainer));var c,d="";let o,a=(l.config.VirtualGamepadSettings&&function(t){if(Array.isArray(t)){if(t.length){for(let e=0;e<t.length;e++)if(t[e].type)try{if("zone"===t[e].type||"dpad"===t[e].type){if(!t[e].location)return void console.warn("Missing location value for "+t[e].type+"! Using default gamepad settings");if(t[e].inputValues)continue;return void console.warn("Missing inputValues for "+t[e].type+"! Using default gamepad settings")}if(!t[e].location)return void console.warn("Missing location value for button "+t[e].text+"! Using default gamepad settings");if(!t[e].type)return void console.warn("Missing type value for button "+t[e].text+"! Using default gamepad settings");if(!t[e].id.toString())return void console.warn("Missing id value for button "+t[e].text+"! Using default gamepad settings");if(!t[e].input_value.toString())return void console.warn("Missing input_value for button "+t[e].text+"! Using default gamepad settings")}catch(e){return void console.warn("Error checking values! Using default gamepad settings")}return 1}console.warn("Vritual gamepad settings is empty! Using default gamepad settings")}else console.warn("Vritual gamepad settings is not array! Using default gamepad settings")}(l.config.VirtualGamepadSettings)?o=l.config.VirtualGamepadSettings:["gba","gb","vb","nes"].includes(getSystem(l.system,!0))?(o=[{type:"button",text:"B",id:"b",location:"right",right:-10,top:70,bold:!0,input_value:0},{type:"button",text:"A",id:"a",location:"right",right:60,top:70,bold:!0,input_value:8},{type:"dpad",location:"left",left:"50%",right:"50%",joystickInput:!1,inputValues:[4,5,6,7]},{type:"button",text:"Start",id:"start",location:"center",left:60,fontSize:15,block:!0,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,fontSize:15,block:!0,input_value:2}],"gba"===getSystem(l.system,!0)&&(o.push({type:"button",text:"L",id:"l",block:!0,location:"top",left:10,top:-40,bold:!0,input_value:10}),o.push({type:"button",text:"R",id:"r",block:!0,location:"top",right:10,top:-40,bold:!0,input_value:11}))):o="n64"===getSystem(l.system,!0)?[{type:"button",text:"B",id:"b",location:"right",left:-10,top:95,input_value:0,bold:!0,input_new_cores:1},{type:"button",text:"A",id:"a",location:"right",left:40,top:150,input_value:8,bold:!0,input_new_cores:0},{type:"zone",location:"left",left:"50%",top:"100%",joystickInput:!0,inputValues:[16,17,18,19]},{type:"zone",location:"left",left:"50%",top:"0%",joystickInput:!1,inputValues:[4,5,6,7]},{type:"button",text:"Start",id:"start",location:"center",left:30,top:-10,fontSize:15,block:!0,input_value:3},{type:"button",text:"L",id:"l",block:!0,location:"top",left:10,top:-40,bold:!0,input_value:10},{type:"button",text:"R",id:"r",block:!0,location:"top",right:10,top:-40,bold:!0,input_value:11},{type:"button",text:"Z",id:"z",block:!0,location:"top",left:10,bold:!0,input_value:12},{fontSize:20,type:"button",text:"CU",id:"cu",location:"right",left:25,top:-65,input_value:23},{fontSize:20,type:"button",text:"CD",id:"cd",location:"right",left:25,top:15,input_value:22},{fontSize:20,type:"button",text:"CL",id:"cl",location:"right",left:-15,top:-25,input_value:21},{fontSize:20,type:"button",text:"CR",id:"cr",location:"right",left:65,top:-25,input_value:20}]:["snes","nds"].includes(getSystem(l.system,!0))?[{type:"button",text:"X",id:"x",location:"right",left:40,bold:!0,input_value:9},{type:"button",text:"Y",id:"y",location:"right",top:40,bold:!0,input_value:1},{type:"button",text:"A",id:"a",location:"right",left:81,top:40,bold:!0,input_value:8},{type:"button",text:"B",id:"b",location:"right",left:40,top:80,bold:!0,input_value:0},{type:"zone",location:"left",left:"50%",top:"50%",joystickInput:!1,inputValues:[4,5,6,7]},{type:"button",text:"Start",id:"start",location:"center",left:60,fontSize:15,block:!0,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,fontSize:15,block:!0,input_value:2}]:[{type:"button",text:"Y",id:"y",location:"right",left:40,bold:!0,input_value:9},{type:"button",text:"X",id:"X",location:"right",top:40,bold:!0,input_value:1},{type:"button",text:"B",id:"b",location:"right",left:81,top:40,bold:!0,input_value:8},{type:"button",text:"A",id:"a",location:"right",left:40,top:80,bold:!0,input_value:0},{type:"zone",location:"left",left:"50%",top:"50%",joystickInput:!1,inputValues:[4,5,6,7]},{type:"button",text:"Start",id:"start",location:"center",left:60,fontSize:15,block:!0,input_value:3},{type:"button",text:"Select",id:"select",location:"center",left:-5,fontSize:15,block:!0,input_value:2}],o=JSON.parse(JSON.stringify(o)),{top:"",left:"",center:"",right:""}),r=!1;oe&&"function"==typeof oe.getCoreOptionsValue&&(r="on"===oe.getCoreOptionsValue("left-handed-mode"));for(let n=0;n<o.length;n++)if("button"===o[n].type){let e={buttons:!0};r&&["left","right"].includes(o[n].location)&&(o[n].location="left"===o[n].location?"right":"left",(c=JSON.parse(JSON.stringify(o[n]))).left&&(o[n].right=c.left),c.right&&(o[n].left=c.right)),e["b_"+o[n].id.toLowerCase()]=!0;let t="";o[n].left&&(t+="left:"+o[n].left+("number"==typeof o[n].left?"px":"")+";"),o[n].right&&(t+="right:"+o[n].right+("number"==typeof o[n].right?"px":"")+";"),o[n].top&&(t+="top:"+o[n].top+("number"==typeof o[n].top?"px":"")+";"),o[n].bold?o[n].bold&&(t+="font-weight:bold;"):t+="font-weight:normal;",o[n].fontSize=o[n].fontSize||30,t+="font-size:"+o[n].fontSize+"px;",o[n].block&&(t+="height:31px;text-align:center;border:1px solid #ccc;border-radius:5px;line-height:31px;"),["top","center","left","right"].includes(o[n].location)&&(a[o[n].location]+='<div class="'+q(e)+'" style="'+t+'">'+o[n].text+"</div>")}d=(d=(d=(d=(d=(d=(d=(d=(d+='<div class="'+q({"virtual-gamepad":!0})+'" style="display: block;">')+('<div class="'+q({top:!0})+'">'))+a.top+"</div>")+('<div class="'+q({left:!0})+'">'))+a.left+"</div>")+('<div class="'+q({center:!0})+'">'))+a.center+"</div>")+('<div class="'+q({right:!0})+'">'))+a.right+"</div></div>",ee.virtualGamepadContainer.innerHTML=d,V(ee.virtualGamepadContainer,!e);let n=q({"virtual-gamepad":!0}),i=q({touch:!0}),s=(X.isIos||F.call(this,H.call(this,".".concat(n)),"touchmove",function(e){e.stopPropagation()}),o.forEach((a,n)=>{if("dpad"===a.type){let e={};var o;r&&["left","right"].includes(a.location)&&(a.location="left"===a.location?"right":"left",(o=JSON.parse(JSON.stringify(a))).left&&(a.right=o.left),o.right&&(a.left=o.right)),e[a.location.toLowerCase()]=!0;const i=H.call(this,".".concat(q({"ejs-virtual-gamepad":!0})," .").concat(q(e))),s=(e["dpad_"+n]=!0,U("div",{class:".".concat(q({"ejs-virtual-gamepad":!0,"dpad-container":!0})," .").concat(q(e))}));let t="";a.left&&(t+="left:"+a.left+";"),a.right&&(t+="right:"+a.right+";"),a.top&&(t+="top:"+a.top+";"),s.style=t,i.appendChild(s),u({container:s,event:function(e,t,n,o){a.joystickInput&&(1===e&&(e=32767),1===t&&(e=32767),1===n&&(e=32767),1===o&&(e=32767)),ee.syncInput(0,a.inputValues[0],e),ee.syncInput(0,a.inputValues[1],t),ee.syncInput(0,a.inputValues[2],n),ee.syncInput(0,a.inputValues[3],o)}})}}),this.zoneObj&&this.zoneObj.forEach(e=>{e.destroy()}),this.zoneObj=[],o.forEach((a,t)=>{if("zone"===a.type){let e={};r&&["left","right"].includes(a.location)&&(a.location="left"===a.location?"right":"left",(n=JSON.parse(JSON.stringify(a))).left&&(a.right=n.left),n.right&&(a.left=n.right)),e[a.location.toLowerCase()]=!0;const o=H.call(this,".".concat(q({"ejs-virtual-gamepad":!0})," .").concat(q(e)));e["zone_"+t]=!0;var n=U("div",{class:".".concat(q({"ejs-virtual-gamepad":!0})," .").concat(q(e))});o.appendChild(n);const i=we.a.create({zone:n,mode:"static",position:{left:a.left,top:a.top},color:"red"});i.on("end",function(e,t){ee.syncInput(0,a.inputValues[0],0),ee.syncInput(0,a.inputValues[1],0),ee.syncInput(0,a.inputValues[2],0),ee.syncInput(0,a.inputValues[3],0)}),i.on("move",function(e,n){var o=n.angle.degree,n=n.distance;if(!0===a.joystickInput){let e=0,t=0;0<o&&o<=45&&(e=n/50,t=-.022222222222222223*o*n/50),45<o&&o<=90&&(e=.022222222222222223*(90-o)*n/50,t=-n/50),90<o&&o<=135&&(e=.022222222222222223*(90-o)*n/50,t=-n/50),135<o&&o<=180&&(e=-n/50,t=-.022222222222222223*(180-o)*n/50),135<o&&o<=225&&(e=-n/50,t=-.022222222222222223*(180-o)*n/50),225<o&&o<=270&&(e=-.022222222222222223*(270-o)*n/50,t=n/50),270<o&&o<=315&&(e=-.022222222222222223*(270-o)*n/50,t=n/50),315<o&&o<=359.9&&(e=n/50,t=.022222222222222223*(360-o)*n/50),0<e?(ee.syncInput(0,a.inputValues[0],32767*e),ee.syncInput(0,a.inputValues[1],0)):(ee.syncInput(0,a.inputValues[1],32767*-e),ee.syncInput(0,a.inputValues[0],0)),0<t?(ee.syncInput(0,a.inputValues[2],32767*t),ee.syncInput(0,a.inputValues[3],0)):(ee.syncInput(0,a.inputValues[3],32767*-t),ee.syncInput(0,a.inputValues[2],0))}else 30<=o&&o<150?ee.syncInput(0,a.inputValues[0],1):window.setTimeout(function(){ee.syncInput(0,a.inputValues[0],0)},30),210<=o&&o<330?ee.syncInput(0,a.inputValues[1],1):window.setTimeout(function(){ee.syncInput(0,a.inputValues[1],0)},30),120<=o&&o<240?ee.syncInput(0,a.inputValues[2],1):window.setTimeout(function(){ee.syncInput(0,a.inputValues[2],0)},30),300<=o||0<=o&&o<60?ee.syncInput(0,a.inputValues[3],1):window.setTimeout(function(){ee.syncInput(0,a.inputValues[3],0)},30)}),this.zoneObj.push(i)}}),[]);for(let n=0;n<o.length;n++)if("button"===o[n].type){let e={};e["b_"+o[n].id.toLowerCase()]=!0;let t;t=2===l.newCores&&o[n].input_new_cores?o[n].input_new_cores:o[n].input_value,s.push({id:e,number:t})}if(s.forEach(t=>{var e=H.call(l,".".concat(n," .").concat(q(t.id)));e&&F.call(l,e,"touchstart touchend touchcancel",function(e){"touchend"===e.type||"touchcancel"===e.type?(G(e.target,i,!1),window.setTimeout(function(){ee.syncInput(0,t.number,0)},30)):(G(e.target,i,!0),ee.syncInput(0,t.number,1)),e.preventDefault()})}),!t){const f=U("div",{class:q({ejs__widget:!0,ejs__widget_controls_toggle:!0})},"");f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>',H.call(this,".".concat(q({ejs__widgets:!0}))).appendChild(f);let t;F.call(this,f,"mousedown touchstart",function(e){G(e.target,i,!0),clearTimeout(t),K.toggleControls.call(l,!0),t=setTimeout(function(){K.toggleControls.call(l,!1)},5e3)})}function u(e){let t=e.container,c=e.event,d=("function"!=typeof c&&(c=function(){}),U("div",{class:q({"dpad-bg":!0})})),u=U("div",{class:q({"dpad-front":!0})});d.innerHTML='<div class="'.concat(q({"dpad-1":!0}),'"><div class="').concat(q({"dpad-1-bg":!0}),'"></div></div>\n    <div class="').concat(q({"dpad-2":!0}),'"><div class="').concat(q({"dpad-2-bg":!0}),'"></div></div>'),t.append(d),t.append(u),F.call(l,u,"touchstart touchmove",function(e){var l=e.targetTouches[0];if(l){let e=u.getBoundingClientRect(),t=l.clientX-e.left-u.clientWidth/2,n=l.clientY-e.top-u.clientHeight/2,o=0,a=0,i=0,s=0,r=Math.atan(t/n)/(Math.PI/180);n<=-10&&(o=1),10<=n&&(a=1),10<=t&&(s=1,(r<(i=0)&&-35<=r||0<r&&r<=35)&&(s=0),o=r<0&&-55<=r?1:0,a=0<r&&r<=55?1:0),t<=-10&&(s=0,i=r<0&&-35<=r||0<r&&r<=35?0:1,o=0<r&&r<=55?1:0,a=r<0&&-55<=r?1:0),d.classList.toggle(q({"dpad-right":!0}),s),d.classList.toggle(q({"dpad-left":!0}),i),d.classList.toggle(q({"dpad-up":!0}),o),d.classList.toggle(q({"dpad-down":!0}),a),c(o,a,i,s)}e.stopPropagation()}),F.call(l,u,"touchend touchcancel",function(e){c(0,0,0,0),d.classList.toggle(q({"dpad-up":!0}),!1),d.classList.toggle(q({"dpad-down":!0}),!1),d.classList.toggle(q({"dpad-right":!0}),!1),d.classList.toggle(q({"dpad-left":!0}),!1),e.stopPropagation()})}}},setup:function(){let o=this;if(this.game){var e;if(ee.playerName=o.config.playerName,G(this.elements.container,this.config.classNames.type,!0),this.elements.container.setAttribute("tabindex","0"),!this.color||(e=function(e){let n=e.toLowerCase();if(n&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(n)){if(4===n.length){for(let e="#",t=1;t<4;t+=1)e+=n.slice(t,t+1).concat(n.slice(t,t+1));n=s}let t=[];for(let e=1;e<7;e+=2)t.push(parseInt("0x".concat(n.slice(e,e+2)),16));return t}return null}(this.color))&&this.elements.container.setAttribute("style","--ejs-primary-color: ".concat(e[0],", ").concat(e[1],", ").concat(e[2])),this.elements.wrapper=U("div",{class:this.config.classNames.video}),A(this.game,this.elements.wrapper),"video"!==o.game.tagName.toLocaleLowerCase()){let t=this.config.volume,n=(Object.defineProperty(o.game,"volume",{get:function(){return t},set:function(e){t=e,B.call(o,o.game,"volumechange")}}),o.storage.get("muted"));Object.defineProperty(o.game,"muted",{get:function(){return n},set:function(e){e=!!D.boolean(e)&&e;n=e,B.call(o,o.game,"volumechange")}})}window.addEventListener("beforeunload",function(e){o.started&&o.getStartName()&&(g.FS.syncfs(function(){}),ee.saveSavFiles(),g.FS.syncfs(function(){}))},!0),window.saveSaveFiles=function(){o.getStartName()&&(console.log("saving save files"),ee.saveSavFiles(),g.FS.syncfs(!1,function(){}))},setInterval(function(){o.started&&saveSaveFiles()},6e4)}else console.warn("No game element found!")},listeners:function(){let i=this;var e=H.call(i,".".concat(q({ejs__dialogs:!0})));let a=0;F.call(i,e,"dragenter",function(e){e.preventDefault(),a++,V(i.elements.dialogs.message,!1)}),F.call(i,e,"dragover",function(e){e.preventDefault()}),F.call(i,e,"dragleave",function(e){e.preventDefault(),0===--a&&V(i.elements.dialogs.message,!0)}),F.call(i,e,"dragend",function(e){e.preventDefault(),a=0,V(i.elements.dialogs.message,!0)}),F.call(i,e,"drop",function(e){e.preventDefault(),V(i.elements.dialogs.message,!0),a=0;var t=e.dataTransfer.items;let n;for(let e=0;e<t.length;e++)if("file"===t[e].kind){n=t[e];break}if(n){const o=n.getAsFile();o.arrayBuffer().then(e=>{ee.loadState(new Uint8Array(e),0)})}}),i.elements.buttons.restart&&F.call(i,i.elements.buttons.restart,"click",function(e){ee.restartGame(),ee.inputsData={},ee.connected&&ee.connection.isInitiator&&(async()=>{var e=await ee.saveState(),e=new File([e],"0-game.state",{type:"",lastModified:new Date});ee.connection.shareFile(e),ee.inputsData={},ee.wait=!0,ee.systemPause(1),g.Module.pauseMainLoop(),ee.disableControl(!0)})(),saveSaveFiles()}),i.elements.buttons.screenRecord&&F.call(i,i.elements.buttons.screenRecord,"click",function(e){if(i.recordData||(i.recordData={started:!1,data:[],stopped:!1}),i.recordData.started)i.recordData.started&&(i.recordData.recorder.stop(),i.recordData.stopped=!0);else{let t;function a(e){i.elements.buttons.screenRecord.querySelector(".".concat(q({ejs__tooltip:!0}))).innerHTML=i.localization("Stop Screen Recording"),i.recordData.stream=e,i.recordData.recorder=new MediaRecorder(i.recordData.stream,t),i.recordData.recorder.ondataavailable=function(e){if(0<e.data.size&&i.recordData.data.push(e.data),i.recordData.stopped){let e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob(i.recordData.data,{type:"video/webm"}));let t;"string"==typeof i.gameName&&(t=i.gameName),e.download=t?"".concat(t,"-recording.webm"):"record.webm",e.click(),window.URL.revokeObjectURL(e.href),delete i.recordData,i.elements.buttons.screenRecord.querySelector(".".concat(q({ejs__tooltip:!0}))).innerHTML=i.localization("Start Screen Recording")}},i.recordData.recorder.start(),i.recordData.started=!0}if(t=MediaRecorder.isTypeSupported("video/webm; codecs=h264")?{mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/webm; codecs=H264")?{mimeType:"video/webm; codecs=H264"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9")?{mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8")?{mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm; codecs=avc1")?{mimeType:"video/webm; codecs=avc1"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp9.0")?{mimeType:"video/webm; codecs=vp9.0"}:MediaRecorder.isTypeSupported("video/webm; codecs=vp8.0")?{mimeType:"video/webm; codecs=vp8.0"}:{},window.navigator&&navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getDisplayMedia){g.Module.pauseMainLoop(),i.playing=!1,alert('Please check "share system audio" to have audio in the recording. We only need the audio stream so your entire screen will not be recorded');let o=setTimeout(function(){i.playing=!0,g.Module.resumeMainLoop()},2e4);navigator.mediaDevices.getDisplayMedia({audio:!0,video:{mediaSource:"screen"}}).then(function(e){let t=g.Module.canvas.captureStream(30);try{clearTimeout(o)}catch(e){}var n=e.getAudioTracks();for(let e=0;e<n.length;e++)t.addTrack(n[e]);a(t),i.playing=!0,g.Module.resumeMainLoop()})}else a(g.Module.canvas.captureStream(30))}}),i.elements.buttons.cacheManager&&F.call(i,i.elements.buttons.cacheManager,"click",function(e){if(g.romdb){V(i.elements.dialogs.cache,!1);let n=i.elements.dialogs.cache.querySelector(".".concat(ee.classNames["dialog-content"]));n.innerHTML="<div>"+i.localization("Loading")+"</div>",g.romdb.getAll(function(t){if(t){let e=U("table",{style:"width:100%;padding-left:10px;text-align:left"}),s=U("tbody");0<t.length?(n.innerHTML="",t.forEach(function(i,e){if(i.key&&!/-part-\d+$/.test(i.key)){let n=[i.key];for(let e=Math.ceil(i.filesize/104857600),t=1;t<e;t+=1)n.push("".concat(i.key,"-part-").concat(t));let t=U("tr"),e=U("td"),o=U("td"),a=U("td");e.innerHTML=i.filename,o.innerHTML=function(e){let t=-1;for(;e/=1024,t++,1024<e;);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}(i.filesize),a.innerHTML='<a href="#" onclick="return false">Remove</a>',t.appendChild(e),t.appendChild(o),t.appendChild(a),s.appendChild(t),a.querySelector("a").onclick=function(e){g.romdb.removeBatch(n);try{s.removeChild(t)}catch(e){}return e.stopPropagation(),!1}}}),e.appendChild(s),n.appendChild(e)):n.innerHTML='<div style="text-align:center">'+i.localization("Empty")+"</div>"}else n.innerHTML='<div style="text-align:center">'+i.localization("Empty")+"</div>"},function(){})}return!1}),i.elements.buttons.play&&Array.from(i.elements.buttons.play).forEach(function(e){F.call(i,e,"click",function(e){i.playing?(i.playing=!1,g.Module.pauseMainLoop(),ee.connected&&ee.connection.isInitiator&&ee.connection.send(JSON.stringify({act:"pause"})),B.call(i,i.elements.container,"pause",!1,{pause:!0})):(i.playing=!0,g.Module.resumeMainLoop(),ee.connected&&ee.connection.isInitiator&&ee.connection.send(JSON.stringify({act:"resume"})),B.call(i,i.elements.container,"pause",!1,{pause:!1}))})}),i.elements.buttons.netplay&&F.call(i,i.elements.buttons.netplay,"click",function(e){ee.disableControl(!0),V(i.elements.dialogs.netplay,!1),0<ee.players.length?ee.openRoom(p):(ee.stopLoadRooms(),ee.loadRoomsList()),ee.playerName||y.show("modal-9de6c4e9ce2b9361",{closeByEsckey:!1})}),i.elements.buttons.cheat&&F.call(i,i.elements.buttons.cheat,"click",function(e){V(i.elements.dialogs.cheat,!1)}),i.game.stateloadField=U("input"),i.game.stateloadField.type="file",i.game.stateloadField.onchange=function e(t){let n,o=t.target.files;0<o.length&&((n=new FileReader).file_name=o[0].name,n.onload=function(){EJS_loadState(new Uint8Array(n.result))},n.readAsArrayBuffer(o[0])),i.game.stateloadField=U("input"),i.game.stateloadField.type="file",i.game.stateloadField.onchange=e},F.call(i,i.elements.container,"loadstate",function(e){ee.saveLoadDB.call(i,"load")||(D.function(i.config.onloadstate)?i.config.onloadstate.call(null,i.loadState):i.game.stateloadField.click(),i.elements.container.focus())}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?console.log("hidden"):console.log("active")})},bindFunction:function(){let s=this,o=getSystem(s.system,!0);if(g.Module&&g.Module._set_volume){let t=g.Module.cwrap("set_volume","null",["number"]);ee.setVolume=function(){let e=0;s.volume<1&&(e=0===s.volume?-80:30*s.volume-30,t(e)),s.muted&&(e=-80),t(e)}}ee.setVariable=g.Module.cwrap("set_variable","null",["string","string"]),ee.simulateInputFn=g.Module.cwrap("simulate_input","null",["number","number","number"]);let r={0:null,1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,13:null,14:null,15:null,16:null,17:null,18:null,19:null,20:null,21:null,22:null,23:null,24:null,25:null,26:null,27:null,28:null,29:null,30:null,31:null},a=(ee.simulateInput=function(e,t,n){var o,a,i;ee.connected?s.playing&&!ee.disableInput&&(a=ee.connection.userid,o=ee.roomMaster===a,a=ee.players.indexOf(a),i=ee.currentFrameNum(),e>>0==0&&(r[t]!==n&&(o?(ee.inputsData[i]||(ee.inputsData[i]=[]),ee.inputsData[i].push({index:a,key:t,status:n,frame:i}),ee.simulateInputFn(a,t,n)):ee.connection.send(JSON.stringify({act:"sync-control",value:["".concat(a,"|").concat(t,"|").concat(n,"|").concat(i)]}),ee.roomMaster)),r[t]=n)):ee.disableInput||ee.simulateInputFn(e,t,n)},ee.syncInput=ee.simulateInput,window.simulateInput=ee.simulateInput,ee.toggleShader=g.Module.cwrap("shader_enable","null",["number"]),2!==s.coreVer?ee.getStateInfo=g.Module.cwrap("get_state_info","string",[]):(ee.getInfoOfState=g.Module.cwrap("get_state_info","string",[]),ee.getStateInfo1=g.Module.cwrap("save_state_info","null",[]),ee.getStateInfo=function(){return ee.getStateInfo1(),new Promise(function(t,e){let n=ee.getInfoOfState();if(n)t(n);else{let e=setInterval(function(){(n=ee.getInfoOfState())&&(clearInterval(e),t(n))},50)}})}),ee.saveState=async function(){let n,o;var a=(o=(2!==s.coreVer?ee.getStateInfo():await ee.getStateInfo()).split("|"))[0]>>0;if(0<a){n=new Uint8Array(a);for(let e=o[1]>>0,t=0;t<a;t++)n[t]=g.Module.getValue(e+t)}return n},g.Module.cwrap("load_state","number",["string","number"])),e=(ee.loadState=function(e,t){try{g.FS.unlink("game.state")}catch(e){}g.FS.createDataFile("/","game.state",e,!0,!0),null===t&&(t=0),"arcade"===o?setTimeout(function(){ee.getStateInfo(),a("game.state",t),g.FS.unlink("game.state")},10):(a("game.state",t),setTimeout(function(){g.FS.unlink("game.state")},100)),ee.connected&&ee.connection.isInitiator&&(async()=>{var e=await ee.saveState(),e=new File([e],"0-game.state",{type:"",lastModified:new Date});ee.connection.shareFile(e),ee.inputsData={},ee.wait=!0,ee.systemPause(1),g.Module.pauseMainLoop(),ee.disableControl(!0)})(),s.elements.container.focus()},g.Module._set_cheat&&(ee.setCheat=g.Module.cwrap("set_cheat","number",["number","number","string"])),g.Module._reset_cheat&&(ee.resetCheat=g.Module._reset_cheat),ee.quickSaveState=async function(){if(s.started&&!ee.connected)if(!1===s.statesSupported)ee.doMessageTransition("CANNOT CURRENTLY LOAD STATE");else{let t;var e=(t=oe&&"function"==typeof oe.getCoreOptionsValue&&(t=oe.getCoreOptionsValue("save-state-slot"))||1)+"-quick.state";try{g.FS.unlink(e)}catch(e){}try{var n=await ee.saveState();g.FS.createDataFile("/",e,n,!0,!0),ee.doMessageTransition("STATE SAVED TO SLOT "+t)}catch(e){console.warn(e),ee.doMessageTransition("FAILED TO SAVE STATE TO SLOT "+t)}saveSaveFiles()}},ee.saveMsgTransitions=null,ee.doMessageTransition=function(e){s.elements.widgets.stateInfoDiv.innerText=e,clearTimeout(ee.saveMsgTransitions),ee.saveMsgTransitions=setTimeout(function(){s.elements.widgets.stateInfoDiv.innerText=""},1500)},ee.quickLoadState=function(){if(s.started&&!ee.connected)if(!1===s.statesSupported)ee.doMessageTransition("CANNOT CURRENTLY LOAD STATE");else{let e,t=(e=oe&&"function"==typeof oe.getCoreOptionsValue&&(e=oe.getCoreOptionsValue("save-state-slot"))||1)+"-quick.state",n=!0;try{a(t,0),"arcade"===o&&setTimeout(function(){ee.getStateInfo(),a(t,0)},10)}catch(e){n=!1}n?ee.doMessageTransition("LOADED STATE FROM SLOT "+e):ee.doMessageTransition("FAILED TO LOAD STATE FROM SLOT "+e),saveSaveFiles()}},ee.changeStateSlot=function(e){let t;t=(t=oe&&"function"==typeof oe.getCoreOptionsValue?oe.getCoreOptionsValue("save-state-slot"):t)||1;let n;9<(n="number"!=typeof e?t+1:e)&&(n=1),ne.updateCoreOptions.call(s,"save-state-slot",n),ee.doMessageTransition("SET SAVE STATE SLOT TO "+n)},window.EJS_loadState=function(t){ee.loadState(t,0),setTimeout(()=>{var e;ee.connected&&(e=new File([t],"0-game.state",{type:"",lastModified:new Date}),ee.connection.shareFile(e),ee.inputsData={},ee.wait=!0,ee.systemPause(1),g.Module.pauseMainLoop(),ee.disableControl(!0))},30)},window.EJS_saveState=function(){return ee.saveState()},g.Module.cwrap("cmd_take_screenshot","",[]));ee.getScreenData=function(){return e(),g.FS.readFile("screenshot.png")},ee.restartGame=g.Module.cwrap("system_restart","",[]),ee.currentFrameNum=g.Module.cwrap("get_current_frame_count","",[]),ee.saveSavFiles=g.Module.cwrap("cmd_savefiles","",[]),g.Module._get_core_options&&(ee.getGameCoreOptions=g.Module.cwrap("get_core_options","string",[])),ee.systemPause=function(e){return!1},ee.controllers=oe.storage.get("controllers"),ee.controllers||(ee.controllers=JSON.parse(JSON.stringify(ee.defaultControllers)))}};let te=ee;const ne={storage:null,coreOptionsValues:{},contextMenu:null,normalOptions:{shader:{label:"Shader",options:{disabled:"Disabled","2xScaleHQ.glslp":"2xScaleHQ","4xScaleHQ.glslp":"4xScaleHQ","crt-easymode.glslp":"CRT easymode","crt-aperture.glslp":"CRT aperture","crt-geom.glslp":"CRT geom","crt-mattias.glslp":"CRT mattias"},default:"disabled"},"virtual-gamepad":{label:"Virtual Gamepad",options:{disabled:"Disabled",enabled:"Enabled"},default:"enabled"}},defaultCoreOptionsValues:function(){let e={};if(2===this.coreVer)return{};switch(this.system){case"pce":e={pce_nospritelimit:"enabled"};break;case"jaguar":e={virtualjaguar_doom_res_hack:"enabled"};break;case"psx":e={pcsx_rearmed_memcard2:"enabled"};break;case"nds":e={}}return e},getCoreOptionsValues:function(){if(ne.coreOptionsValues)return JSON.parse(JSON.stringify(ne.coreOptionsValues));let e=ne.storage.get("core-options");return e=D.empty(e)?{}:e},getCoreOptionsValue:function(e){if(ne.coreOptionsValues){var t=JSON.parse(JSON.stringify(ne.coreOptionsValues))[e];if(t)return t}let n=ne.storage.get("core-options");return(n=D.empty(n)?{}:n)[e]},getCoreOptions:function(){let i={};switch(this.system){case"nes":i.fceumm_palette={label:this.localization("Color Palette"),options:{default:this.localization("Default"),asqrealc:"asqrealc","nintendo-vc":"nintendo-vc",rgb:"rgb","yuv-v3":"yuv-v3","unsaturated-final":"unsaturated-final","sony-cxa2025as-us":"sony-cxa2025as-us",pal:"pal","bmf-final2":"bmf-final2","bmf-final3":"bmf-final3","smooth-fbx":"smooth-fbx","composite-direct-fbx":"composite-direct-fbx","pvm-style-d93-fbx":"pvm-style-d93-fbx",nescap:"nescap","ntsc-hardware-fbx":"ntsc-hardware-fbx","nes-classic-fbx-fs":"nes-classic-fbx-fs",wavebeam:"wavebeam"},default:"default"},i.fceumm_nospritelimit={label:this.localization("No Sprite Limit"),options:{enabled:this.localization("Enabled"),disabled:this.localization("Disabled")},default:"disabled"},i.fceumm_sndquality={label:this.localization("Sound Quality"),options:{Low:this.localization("Low"),High:this.localization("High"),"Very High":this.localization("Very High")},default:"Low"},this.lightgun||(i.system_type={label:this.localization("4 Players Support"),options:{nes:"NES",famicom:"Famicom"},default:"nes"}),i.fceumm_turbo_enable={label:this.localization("Turbo Enable"),options:{None:this.localization("None"),"Player 1":this.localization("Player 1"),"Player 2":this.localization("Player 2"),Both:this.localization("Both")},default:"None"},i.fceumm_region={label:this.localization("Region"),options:{Auto:this.localization("Auto"),NTSC:"NTSC",PAL:"PAL",Dendy:"Dendy"},default:"Auto"};break;case"snes":i={snes9x_next_overclock:{label:this.localization("SuperFX Overclock"),options:{disabled:this.localization("Disabled")+"(10MHz)","40MHz":"40MHz","60MHz":"60MHz","80MHz":"80MHz","100MHz":"100MHz"},default:"disabled"}};break;case"snes2002":case"snes2005":case"snes2010":i={};break;case"gb":i={gambatte_gb_colorization:{label:this.localization("GB Colorization"),options:{disabled:this.localization("Disabled"),auto:this.localization("auto"),internal:this.localization("internal")},default:"disabled"},gambatte_gb_internal_palette:{label:this.localization("Internal Palette"),options:{"GBC - Blue":this.localization("GBC - Blue"),"GBC - Brown":this.localization("GBC - Brown"),"GBC - Dark Blue":this.localization("GBC - Dark Blue"),"GBC - Dark Brown":this.localization("GBC - Dark Brown"),"GBC - Dark Green":this.localization("GBC - Dark Green"),"GBC - Grayscale":this.localization("GBC - Grayscale"),"GBC - Green":this.localization("GBC - Green"),"GBC - Inverted":this.localization("GBC - Inverted"),"GBC - Orange":this.localization("GBC - Orange"),"GBC - Pastel Mix":this.localization("GBC - Pastel Mix"),"GBC - Red":this.localization("GBC - Red"),"GBC - Yellow":this.localization("GBC - Yellow")},default:"GBC - Blue"}};break;case"gba":i={mgba_solar_sensor_level:{label:this.localization("Solar sensor level"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"},mgba_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9","10"],default:"0"}};break;case"vbanext":i={vbanext_turboenable:{label:this.localization("Enable Turbo Buttons"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},vbanext_turbodelay:{label:this.localization("Turbo Delay in frames"),options:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],default:"2"}};break;case"n64":i={"glupen64-aspect":{label:this.localization("Aspect Ratio (Need to refresh page)"),options:["4:3","16:9"],default:"4:3"},"glupen64-43screensize":{label:this.localization("4:3 Resolution"),options:["320x240","640x480","960x720","1280x960"],default:"320x240"},"glupen64-169screensize":{label:this.localization("16:9 Resolution"),options:["640x360","960x540","1280x720"],default:"640x360"},"glupen64-pak1":{label:this.localization("Player 1 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none"},"glupen64-pak2":{label:this.localization("Player 2 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none"},"glupen64-pak3":{label:this.localization("Player 3 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none"},"glupen64-pak4":{label:this.localization("Player 4 Pak"),options:{none:this.localization("none"),memory:this.localization("memory"),rumble:this.localization("rumble")},default:"none"}};break;case"nds":i={desmume_screens_layout:{label:this.localization("Screen layout"),options:{"top/bottom":this.localization("top/bottom"),"bottom/top":this.localization("bottom/top"),"left/right":this.localization("left/right"),"right/left":this.localization("right/left"),"top only":this.localization("top only"),"bottom only":this.localization("bottom only"),"quick switch":this.localization("quick switch"),"hybrid/top":this.localization("hybrid/top"),"hybrid/bottom":this.localization("hybrid/bottom")},default:"top/bottom"},screen_rotation:{label:this.localization("Screen Rotation"),options:{0:"0",90:"90",180:"180",270:"270"},default:0},desmume_frameskip:{label:this.localization("Frameskip"),options:["0","1","2","3","4","5","6","7","8","9"],default:"0"}},Y.wasm||delete i.screen_rotation;break;case"vb":case"pce":i={};break;case"segaMS":case"segaGG":case"segaMD":case"segaCD":i={genesis_plus_gx_no_sprite_limit:{label:this.localization("No Sprite Limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},genesis_plus_gx_overclock:{label:this.localization("CPU speed"),options:["100%","125%","150%","175%","200%"],default:"100%"},genesis_plus_gx_sound_output:{label:this.localization("Sound output"),options:{stereo:this.localization("stereo"),mono:this.localization("mono")},default:"stereo"}};break;case"sega32x":i={picodrive_sprlim:{label:this.localization("No sprite limit"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"segaSaturn":i={yabause_frameskip:{label:this.localization("Frameskip"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"msx":i={bluemsx_nospritelimits:{label:this.localization("No Sprite Limit"),options:{OFF:this.localization("OFF"),ON:this.localization("ON")},default:"OFF"}};break;case"ws":case"ngp":i={};break;case"jaguar":i={virtualjaguar_usefastblitter:{label:this.localization("Fast Blitter"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},virtualjaguar_bios:{label:this.localization("Bios"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"psx":i={pcsx_rearmed_frameskip:{label:this.localization("Frameskip"),options:[0,1,2,3],default:0},pcsx_rearmed_memcard2:{label:this.localization("Enable second memory card"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled"},pcsx_rearmed_pad1type:{label:this.localization("Pad 1 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default"},pcsx_rearmed_pad2type:{label:this.localization("Pad 2 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default"},pcsx_rearmed_pad3type:{label:this.localization("Pad 3 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default"},pcsx_rearmed_pad4type:{label:this.localization("Pad 4 Type"),options:{default:this.localization("default"),none:this.localization("none"),standard:this.localization("standard"),analog:this.localization("analog"),negcon:this.localization("negcon")},default:"default"},pcsx_rearmed_vibration:{label:this.localization("Enable Vibration"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"enabled"},pcsx_rearmed_neon_interlace_enable:{label:this.localization("Enable interlacing mode(s)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},pcsx_rearmed_neon_enhancement_enable:{label:this.localization("Enhanced resolution (slow)"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"},pcsx_rearmed_neon_enhancement_no_main:{label:this.localization("Enhanced resolution speed hack"),options:{disabled:this.localization("disabled"),enabled:this.localization("enabled")},default:"disabled"}};break;case"arcade":case"fba0.2.97.29":i={"fba-aspect":{label:this.localization("Aspect ratio"),options:["DAR","PAR"],default:"DAR"},"fba-frameskip":{label:this.localization("Frameskip"),options:["0","1","2","3","4","5"],default:"0"},"fba-cpu-speed-adjust":{label:this.localization("CPU overclock"),options:["100","110","120","130","140","150","160","170","180","190","200"],default:"100"},"fba-diagnostic-input":{label:this.localization("Diagnostic Input"),options:["None","Hold Start","Start + A + B","Hold Start + A + B","Start + L + R","Hold Start + L + R","Hold Select","Select + A + B","Hold Select + A + B","Select + L + R","Hold Select + L + R"],default:"None"},"fba-neogeo-mode":{label:this.localization("Force Neo Geo mode"),options:["MVS","AES","UNIBIOS","DIPSWITCH"],default:"MVS"}};break;default:i={}}const s=this;2===this.coreVer&&((i={}).fps={label:this.localization("FPS"),options:{show:this.localization("show"),hide:this.localization("hide")},default:"hide"}),!te||"undefined"==te.virtualGamepadContainer&&null===te.virtualGamepadContainer||(i["left-handed-mode"]={label:this.localization("Left Handed Mode"),options:{on:this.localization("On"),off:this.localization("Off")},default:"off"}),!0===this.statesSupported&&(i["save-state-slot"]={label:this.localization("Save State Slot"),options:[1,2,3,4,5,6,7,8,9],default:1}),!0===this.statesSupported&&window.indexedDB&&this.getStartName()&&(i["save-state-location"]={label:this.localization("Save State Location"),options:{download:this.localization("download"),"keep in browser":this.localization("keep in browser")},default:"download"});try{te.getGameCoreOptions&&te.getGameCoreOptions().split("\n").forEach(function(e,t){let o=e.split("; "),a=o[0];if(0===a.indexOf("fba-dipswitch-")||2===s.coreVer){let n=o[1].split("|"),e=a.split("|")[0].replace(/_/g," ").replace(/.+\-(.+)/,"$1");if(n.slice(1,-1),1!==n.length){let t={};for(let e=0;e<n.length;e++)t[n[e]]=s.localization(n[e]);i[a.split("|")[0]]={label:s.localization(e),options:t,default:1<a.split("|").length?a.split("|")[1]:n[0].replace("(Default) ","")}}}})}catch(e){}return i},supportNetPlay:function(){return!(!this.serverURL||!this.statesSupported)&&(!this.lightgun&&!this.mouse)},isNetPlay:function(){},findElements:function(){try{return this.elements.controls=H.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:c.call(this,this.config.selectors.buttons.play),pause:H.call(this,this.config.selectors.buttons.pause),restart:H.call(this,this.config.selectors.buttons.restart),mute:H.call(this,this.config.selectors.buttons.mute),settings:H.call(this,this.config.selectors.buttons.settings),fullscreen:H.call(this,this.config.selectors.buttons.fullscreen),saveState:H.call(this,this.config.selectors.buttons.saveState),cacheManager:H.call(this,this.config.selectors.buttons.cacheManager),screenRecord:H.call(this,this.config.selectors.buttons.screenRecord),loadState:H.call(this,this.config.selectors.buttons.loadState),gamepad:H.call(this,this.config.selectors.buttons.gamepad),netplay:H.call(this,this.config.selectors.buttons.netplay),cheat:H.call(this,this.config.selectors.buttons.cheat)},this.elements.inputs={volume:H.call(this,this.config.selectors.inputs.volume)},!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),!1}},createIcon:function(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=(R(n,W(t,{role:"presentation",focusable:"false"})),document.createElement("div"));o.innerHTML="<svg>".concat(this.icons[e],"</svg>");for(let e=o.childNodes[0].childNodes,t=0;t<e.length;t+=1)n.appendChild(e[t]);return n},createLabel:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=me.get(e,this.config),o={};return o[t.class]=!0,o[this.config.classNames.hidden]=!0,U("span",Object.assign({},t,{class:[t.class,this.config.classNames.tooltip].filter(Boolean).join(" ")}),n)},createBadge:function(e){if(D.empty(e))return null;let t=U("span",{class:this.config.classNames.menu.value});return t.appendChild(U("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(e,t){let n,o,a,i,s=U("button"),r=Object.assign({},t),l=function(e){let t=(0<arguments.length&&void 0!==e?e:"").toString();return(t=function(e){e=pe((0<arguments.length&&void 0!==e?e:"").toString(),"-"," ");return e=pe(e,"_"," "),pe(function(e){return(0<arguments.length&&void 0!==e?e:"").toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}(e)," ","")}(t)).charAt(0).toLowerCase()+t.slice(1)}(e),c=!1;"type"in r||(r.type="button");t=q({ejs__control:!0});switch("class"in r?r.class.includes(t)||(r.class+=" ".concat(t)):r.class=t,e){case"play":c=!0,n="play",a="pause",o="play",i="pause";break;case"mute":c=!0,n="mute",a="unmute",o="volume",i="muted";break;case"fullscreen":c=!0,n="enterFullscreen",a="exitFullscreen",o="enter-fullscreen",i="exit-fullscreen";break;default:n=l,o=e}return c?(s.appendChild(ne.createIcon.call(this,i,{class:q({"icon--pressed":!0})})),s.appendChild(ne.createIcon.call(this,o,{class:q({"icon--not-pressed":!0})})),s.appendChild(ne.createLabel.call(this,a,{class:q({"icon--pressed":!0})})),s.appendChild(ne.createLabel.call(this,n,{class:q({"icon--not-pressed":!0})}))):(s.appendChild(ne.createIcon.call(this,o)),s.appendChild(ne.createLabel.call(this,n))),W(r,z(this.config.selectors.buttons[l],r)),R(s,r),"play"===l?(D.array(this.elements.buttons[l])||(this.elements.buttons[l]=[]),this.elements.buttons[l].push(s)):this.elements.buttons[l]=s,s},createRange:function(e,t){t=U("input",W(z(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.1,value:0,autocomplete:"off",role:"slider","aria-label":me.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=t,ne.updateRangeFill.call(this,t),t},bindMenuItemShortcuts:function(o,a){let i=this;F(o,"keydown keyup",function(n){if([32,38,39,40].includes(n.which)&&(n.preventDefault(),n.stopPropagation(),"keydown"!==n.type)){let e,t=L(o,'[role="menuitemradio"]');!t&&[32,39].includes(n.which)?ne.showMenuPanel.call(i,a,!0):32!==n.which&&(40===n.which||t&&39===n.which?(e=o.nextElementSibling,D.element(e)||(e=o.parentNode.firstElementChild)):(e=o.previousElementSibling,D.element(e)||(e=o.parentNode.lastElementChild)),ie.call(i,e,!0))}},!1),F(o,"keyup",function(e){13===e.which&&ne.focusFirstMenuItem.call(i,null,!0)})},createMenuItem:function(e){let t=this,n=e.value,o=e.list,a=e.type,i=e.title,s=e.badge,r=void 0===s?null:s,l=e.checked,c=void 0!==l&&l,d=z(this.config.selectors.inputs[a]),u=U("button",W(d,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(d.class||"").trim(),"aria-checked":c,value:n})),f=U("span"),p=(f.innerHTML=i,D.element(r)&&f.appendChild(r),u.appendChild(f),Object.defineProperty(u,"checked",{enumerable:!0,get:function(){return"true"===u.getAttribute("aria-checked")},set:function(e){e&&Array.from(u.parentNode.children).filter(function(e){return L(e,'[role="menuitemradio"]')}).forEach(function(e){return e.setAttribute("aria-checked","false")}),u.setAttribute("aria-checked",e?"true":"false")}}),ne.getCoreOptions.call(this));this.listeners.bind(u,"click keyup",function(e){D.keyboardEvent(e)&&32!==e.which||(e.preventDefault(),e.stopPropagation(),u.checked=!0,Object.keys(ne.normalOptions).includes(a)&&ne.updateNormalOptions.call(t,a,n),Object.keys(p).includes(a)&&(p[a].netplay&&te.connected?te.connection.isInitiator&&(ne.updateCoreOptions.call(t,a,n),te.connection.send(JSON.stringify({act:"update-core-option",key:a,value:n,frame:te.currentFrame}))):ne.updateCoreOptions.call(t,a,n)),ne.showMenuPanel.call(t,"home",D.keyboardEvent(e)))},a,!1),ne.bindMenuItemShortcuts.call(this,u,a),o.appendChild(u)},updateVolume:function(){D.element(this.elements.inputs.volume)&&ne.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),D.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume)},setRange:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;D.element(e)&&(e.value=t,ne.updateRangeFill.call(this,e))},updateRangeFill:function(e){let t=D.event(e)?e.target:e;if(D.element(t)&&"range"===t.getAttribute("type")){if(L(t,this.config.selectors.inputs.volume)){let e=100*t.value;t.setAttribute("aria-valuenow",e),t.setAttribute("aria-valuetext","".concat(e.toFixed(1),"%"))}else t.setAttribute("aria-valuenow",t.value);X.isWebkit&&t.style.setProperty("--value","".concat(t.value/t.max*100,"%"))}},toggleMenuButton:function(e,t){V(this.elements.settings.buttons[e],!t)},updateNormalOptions:function(e,t){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=ne.normalOptions[e].options[t];let n={};n[e]=t,ne.storage.set(n),"shader"===e&&te.setShader(t),"virtual-gamepad"===e&&te.toggleVirtualGamepad.call(this,"enabled"===t)},updateCoreOptions:function(t,n){if("nds"===getSystem(this.system,!0)&&!Y.wasm)return!0;if(ne.coreOptionsValues[t]=n,"psx"===getSystem(this.system,!0)&&g.Module.pauseMainLoop(),te.setVariable(t,n),"psx"===getSystem(this.system,!0)&&(setTimeout(function(){g.Module.resumeMainLoop()},100),setTimeout(function(){g.Module.resumeMainLoop()},200)),"nds"===getSystem(this.system,!0)&&Y.wasm){let e=this.elements.wrapper.querySelector("canvas");if("screen_rotation"===t)switch(e.style.transform="rotate("+n+"deg)",n){case"0":te.setVariable("desmume_input_rotation","0");break;case"90":te.setVariable("desmume_input_rotation","270");break;case"180":te.setVariable("desmume_input_rotation","180");break;case"270":te.setVariable("desmume_input_rotation","90")}}if("arcade"===getSystem(this.system,!0)||"fba0.2.97.29"===getSystem(this.system,!0)){let e=this.elements.wrapper.querySelector("canvas");e.height="fba-aspect"===t&&"PAR"===n?e.width/16*9:e.width/4*3}let o=ne.getCoreOptions.call(this),e=ne.storage.get("core-options");if((e=D.empty(e)?{}:e)[t]=n,ne.storage.set({"core-options":e}),this.elements.settings.buttons[t]){let e=this.elements.settings.buttons[t].querySelector(".".concat(this.config.classNames.menu.value));D.object(o[t].options)?e.innerHTML=o[t].options[n]:e.innerHTML=n}"left-handed-mode"===t&&te.toggleVirtualGamepad.call(this,!0,!0)},setOptionMenuItem:function(d,u){let f=this,p=this.elements.settings.panels.home.querySelector('[role="menu"]'),m=this.elements.settings.popup.children[0];Object.keys(d).forEach(function(t){let n=t,e=U("button",W(z(f.config.selectors.buttons.settings),{type:"button",class:q({ejs__control:!0,"ejs__control--forward":!0}),role:"menuitem",item:t,"aria-haspopup":!0}));F(e,"click",function(){ne.showMenuPanel.call(f,n,!1)});let o,a=U("span",null,d[t].label),i=U("span",{class:f.config.classNames.menu.value}),s=(D.object(u)&&(o=u[n]),D.empty(o)&&(o=d[n].default),D.object(d[n].options)?i.innerHTML=d[n].options[o]:i.innerHTML=o,a.appendChild(i),e.appendChild(a),p.appendChild(e),U("div",{"data-pane":escape(n),hidden:""})),r=U("button",{type:"button",class:q({ejs__control:!0,"ejs__control--back":!0})}),l=(r.appendChild(U("span",{"aria-hidden":!0},d[t].label)),r.appendChild(U("span",{class:q({"ejs__sr-only":!0})},me.get("menuBack",f.config))),F(s,"keydown",function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),ne.showMenuPanel.call(f,"home",!0))},!1),F(r,"click",function(){ne.showMenuPanel.call(f,"home",!1)}),s.appendChild(r),s.appendChild(U("div",{role:"menu"})),m.appendChild(s),f.elements.settings.buttons[n]=e,(f.elements.settings.panels[n]=s).querySelector('[role="menu"]'));var c=l;if(D.element(c))for(let e=c.childNodes.length;0<e;)c.removeChild(c.lastChild),--e;D.object(d[t].options)?Object.keys(d[t].options).forEach(function(e){ne.createMenuItem.call(f,{value:e,list:l,type:n,title:d[t].options[e],badge:null,checked:Boolean(o===e)})}):D.array(d[t].options)&&d[t].options.forEach(function(e){ne.createMenuItem.call(f,{value:e,list:l,type:n,title:e,badge:null,checked:Boolean(o===e)})})})},setNormalOptionsMenu:function(){let s=this,n={};(n=this.config.defaultMenuOptions&&void 0===this.config.defaultMenuOptions.length?this.config.defaultMenuOptions:n).orientation=ne.storage.get("orientation"),n.shader=ne.storage.get("shader")||n.shader,s.touch?(n["virtual-gamepad"]=ne.storage.get("virtual-gamepad")||n["virtual-gamepad"],F.call(s,s.elements.container,"start-game",function(){"enabled"!==n["virtual-gamepad"]&&!D.empty(n["virtual-gamepad"])||te.toggleVirtualGamepad.call(s,!0)})):delete ne.normalOptions["virtual-gamepad"],ne.setOptionMenuItem.call(this,ne.normalOptions,n),F.call(s,s.elements.container,"start-game",function(){var e=ne.storage.get("shader");"disabled"!==e&&te.setShader(e);let i={};te.getGameCoreOptions&&te.getGameCoreOptions().split("\n").forEach(function(e,t){let o=e.split("; "),a=o[0];if(0===a.indexOf("fba-dipswitch-")||2===s.coreVer){let n=o[1].split("|"),e=a.split("|")[0].replace(/_/g," ").replace(/.+\-(.+)/,"$1");if(n.slice(1,-1),1!==n.length){let t={};for(let e=0;e<n.length;e++)t[n[e]]=s.localization(n[e]);i[a.split("|")[0]]={label:s.localization(e),options:t,default:1<a.split("|").length?a.split("|")[1]:n[0].replace("(Default) ","")}}}});e=ne.storage.get("core-options")||{};ne.coreOptionsValues=e,ne.setOptionMenuItem.call(s,i,ne.coreOptionsValues),Object.keys(ne.coreOptionsValues).forEach(function(e,t){ne.updateCoreOptions.call(n,e,ne.coreOptionsValues[e])}),"nds"==getSystem(s.system,!0)&&(g.Module._fast_forward_2?g.Module._fast_forward_2(1):g.Module._fast_forward&&g.Module._fast_forward(1))})},updateCoreOptionMenuItems:function(){let t=this.elements.settings.panels.home.querySelector('[role="menu"]'),n=ne.getCoreOptions.call(this);te.connected&&!te.connection.isInitiator?Object.keys(n).forEach(function(e){n[e].netplay&&t.querySelector('[item="'.concat(e,'"]')).setAttribute("disabled","")}):Object.keys(n).forEach(function(e){t.querySelector('[item="'.concat(e,'"]')).removeAttribute("disabled")})},setCoreOptionsMenu:function(){this.elements.settings.panels.home.querySelector('[role="menu"]'),this.elements.settings.popup.children[0];let e=ne.getCoreOptions.call(this),t=ne.storage.get("core-options");if(t=t||{},this.config.defaultMenuOptions&&void 0===this.config.defaultMenuOptions.length){for(var n in this.config.defaultMenuOptions)t[n]||(t[n]=this.config.defaultMenuOptions[n]);s=this.config.defaultMenuOptions}"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&console.log("Available core options: ",e),ne.coreOptionsValues=t,ne.setOptionMenuItem.call(this,e,t)},checkMenu:function(){var e=this.elements.settings.buttons;D.empty(e)||Object.values(e).some(function(e){return!e.hidden}),V(this.elements.settings.menu,!1)},focusFirstMenuItem:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!this.elements.settings.popup.hidden){let e=t;t=(e=D.element(e)?e:Object.values(this.elements.settings.panels).find(function(e){return!e.hidden})).querySelector('[role^="menuitem"]');ie.call(this,t,n)}},toggleMenu:function(n){let o=this.elements.settings.popup,a=this.elements.buttons.settings;if(D.element(o)&&D.element(a)){let e=o.hidden,t=e;if(D.boolean(n))t=n;else if(D.keyboardEvent(n)&&27===n.which)t=!1;else if(D.event(n)){var i=o.contains(n.target);if(i||!i&&n.target!==a&&t)return}a.setAttribute("aria-expanded",t),V(o,!t),G(this.elements.container,this.config.classNames.menu.open,t),t&&D.keyboardEvent(n)?ne.focusFirstMenuItem.call(this,null,!0):t||e||ie.call(this,a,D.keyboardEvent(n))}},getMenuSize:function(e){let t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);var e=t.scrollWidth,n=t.scrollHeight;return N(t),{width:e,height:n}},showLoadStatePanel:function(){},showMenuPanel:function(){let o=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=H.call(this,'[data-pane="'.concat(escape(e),'"]'));if(D.element(a)){let n=a.parentNode,e=Array.from(n.children).find(function(e){return!e.hidden});var i,s;Y.transitions&&!Y.reducedMotion&&(n.style.width="".concat(e.scrollWidth,"px"),n.style.height="".concat(e.scrollHeight,"px"),i=ne.getMenuSize.call(this,a),s=function e(t){t.target===n&&["width","height"].includes(t.propertyName)&&(n.style.width="",n.style.height="",M.call(o,n,ce,e))},F.call(this,n,ce,s),n.style.width="".concat(i.width,"px"),n.style.height="".concat(i.height,"px")),V(e,!0),V(a,!1),ne.focusFirstMenuItem.call(this,a,t)}},setLoadState:function(e,t){e.appendChild(ne.createButton.call(this,"load-state",{"aria-haspopup":!0,"aria-expanded":!1}));let n=U("div",{class:q({ejs__dialog:!0,"ejs__load-state__container":!0}),hidden:""}),o=U("div");n.appendChild(o),H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(n),this.elements.dialogs.loadState=n},setScreenRecord:function(n,e){if(window.MediaRecorder){var o=ne.createButton.call(this,"screen-record",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});n.appendChild(o);let e=U("div",{class:q({ejs__dialog:!0,ejs__screenRecord__container:!0}),hidden:""}),t=U("div");e.appendChild(t),H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(e),this.elements.dialogs.screenRecord=e}},setCacheManager:function(e,t){var n=ne.createButton.call(this,"cache-manager",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let o=U("div",{class:q({ejs__dialog:!0,ejs__cacheManager__container:!0}),hidden:""}),a=U("div");o.appendChild(a),H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(o),this.elements.dialogs.cacheManager=o},setGamepad:function(e,t){var n=ne.createButton.call(this,"gamepad",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let o=U("div",{class:q({ejs__dialog:!0,ejs__gamepad__container:!0}),hidden:""}),a=U("div");o.appendChild(a),H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(o),this.elements.dialogs.gamepad=o},setMessage:function(e,t){let n=U("div",{class:q({ejs__dialog:!0}),hidden:""}),o=U("div");n.appendChild(o),H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(n),this.elements.dialogs.message=n},setCheat:function(e,t){var n=ne.createButton.call(this,"cheat",{"aria-haspopup":!0,"aria-expanded":!1,style:"margin-right:auto;"});e.appendChild(n);let o=U("div",{class:q({ejs__dialog:!0,ejs__cheat__container:!0}),hidden:""}),a=U("div");o.appendChild(a),H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(o),this.elements.dialogs.cheat=o},setStateInfoBarWidget:function(){let e=U("div",{class:q({ejs__widget:!0})}),t=U("div");t.style="color: red;font-size: 17px;padding:10px;text-align:left;text-shadow:1px 1px 1px #000",e.appendChild(t),H.call(this,".".concat(q({ejs__widgets:!0}))).appendChild(e),this.elements.widgets.stateInfo=e,this.elements.widgets.stateInfoDiv=t},setNetplayWidgets:function(){return},setNetplay:function(e,t){return},toggleContextMenu:function(n,o){if(k(n.target,q({ejs__dialogs:!0}))){let e=ne.contextMenu.timer;if(this.started){let t=H.call(this,".".concat(q({ejs__contextmenu:!0})," ul"));if(o){ne.contextMenu.style.display="block",ne.contextMenu.style.left="".concat(n.layerX,"px"),ne.contextMenu.style.top="".concat(n.layerY,"px");c.call(this,".".concat(q({ejs__contextmenu:!0})," ul li"));if(null===t.getAttribute("menu")){let e=U("li",{});e.appendChild(U("a",{target:"_blank",href:"https://github.com/EmulatorJS/EmulatorJS"},"EmulatorJS v".concat(this.version))),t.appendChild(e),t.setAttribute("menu","")}e&&clearTimeout(e),e=setTimeout(function(){},4e3),ne.contextMenu.timer=e}else ne.contextMenu.style.display="none"}}},create:function(e){let i=this,t=(ne.storage=new ge(this,"ejs_".concat(this.system,"_settings")),U("div",z(this.config.selectors.controls.wrapper))),o=(ne.contextMenu=U("div",{class:q({ejs__contextmenu:!0}),style:"position: absolute; display:none;z-index:9"}),["<ul>","</ul>"]),a=[];function n(e,t,n){"function"==typeof n?a.push(n):a.push(function(){});n=o.length-1;t?o.splice(n,0,'<li hidden><a href="#" onclick="return false">'+e+"</a></li>"):o.splice(n,0,'<li><a href="#" onclick="return false">'+e+"</a></li>")}n(i.localization("Take Screenshot"),!1,function(e){var t=ee.getScreenData();let n;var o=(n="string"==typeof i.gameName?i.gameName:n)?"".concat(n,"-screenshot.png"):"game.png";let a=document.createElement("a");return a.href=URL.createObjectURL(new Blob([t])),a.download=o,a.click(),setTimeout(function(){URL.revokeObjectURL(a.src)}),!1}),n(i.localization("Quick Save")+" (F2)",!1,function(e){ee.quickSaveState(),oe.contextMenu.style.display="none"}),n(i.localization("Quick Load")+" (F4)",!1,function(e){ee.quickLoadState(),oe.contextMenu.style.display="none"}),ne.contextMenu.innerHTML=o.join("");var s=ne.contextMenu.getElementsByTagName("li");for(let e=0;e<s.length;e++)F.call(i,s[e],"click",a[e]);this.elements.container.appendChild(ne.contextMenu);var r=U("div",{class:q({ejs__dialog:!0,ejs__cache__container:!0}),hidden:""}),r=(H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(r),this.elements.dialogs.cache=r,U("div",{class:q({ejs__dialog:!0,ejs__loading__container:!0}),hidden:""}));H.call(this,".".concat(q({ejs__dialogs:!0}))).appendChild(r),this.elements.dialogs.loading=r,t.appendChild(ne.createButton.call(this,"restart")),t.appendChild(ne.createButton.call(this,"play")),t.appendChild(ne.createButton.call(this,"save-state",{"aria-expanded":!1})),ne.setLoadState.call(this,t,e),ne.setScreenRecord.call(this,t,e),ne.setCacheManager.call(this,t,e),0<parseInt(this.config.gameId)&&ne.setNetplay.call(this,t,e),ne.setGamepad.call(this,t,e),ne.setMessage.call(this,t,e),ne.setStateInfoBarWidget.call(this,t,e),ne.setCheat.call(this,t,e),t.appendChild(U("span",{style:"flex:1"}));let l=U("div",{class:q({ejs__volume:!0})});l.appendChild(ne.createButton.call(this,"mute"));r={max:1,step:.01,value:this.config.volume};l.appendChild(ne.createRange.call(this,"volume",W(r,{}))),this.elements.volume=l,t.appendChild(l);let c=U("div",{class:q({ejs__menu:!0})}),d=(c.appendChild(ne.createButton.call(this,"settings",{"aria-haspopup":!0,"aria-expanded":!1})),U("div",{class:q({ejs__menu__container:!0}),hidden:""})),u=U("div"),f=U("div",{"data-pane":"home"}),p=U("div",{role:"menu"}),m=(f.appendChild(p),u.appendChild(f),this.elements.settings.panels.home=f,d.appendChild(u),c.appendChild(d),t.appendChild(c),this.elements.settings.popup=d,this.elements.settings.menu=c,t.appendChild(ne.createButton.call(this,"fullscreen")),this);return t.addEventListener("mousedown",function(){m.onButtonDiv=!0}),this.elements.controls=t,ne.setNormalOptionsMenu.call(this),ne.setCoreOptionsMenu.call(this),t},inject:function(){let e=this,t=(this.icons={"enter-fullscreen":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M208 281.4c-12.5-12.5-32.76-12.5-45.26-.002l-78.06 78.07l-30.06-30.06c-6.125-6.125-14.31-9.367-22.63-9.367c-4.125 0-8.279 .7891-12.25 2.43c-11.97 4.953-19.75 16.62-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-30.06-30.06l78.06-78.07c12.5-12.49 12.5-32.75 .002-45.25L208 281.4zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l30.06 30.06l-78.06 78.07c-12.5 12.5-12.5 32.76 0 45.26l22.62 22.62c12.5 12.5 32.76 12.5 45.26 0l78.06-78.07l30.06 30.06c9.156 9.141 22.87 11.84 34.87 6.937C504.2 184.6 512 172.9 512 159.1V23.1C512 10.74 501.3 0 487.1 0z"/></svg>',"exit-fullscreen":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l30.06 30.06l-78.06 78.07c-12.5 12.5-12.5 32.75-.0012 45.25l22.62 22.62c12.5 12.5 32.76 12.5 45.26 .0013l78.06-78.07l30.06 30.06c6.125 6.125 14.31 9.367 22.63 9.367c4.125 0 8.279-.7891 12.25-2.43c11.97-4.953 19.75-16.62 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272zM296 240h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-30.06-30.06l78.06-78.07c12.5-12.5 12.5-32.76 .0002-45.26l-22.62-22.62c-12.5-12.5-32.76-12.5-45.26-.0003l-78.06 78.07l-30.06-30.06c-9.156-9.141-22.87-11.84-34.87-6.937c-11.97 4.953-19.75 16.62-19.75 29.56v135.1C272 229.3 282.7 240 296 240z"/></svg>',gamepad:'<svg viewBox="0 0 640 512"><path fill="currentColor" d="M480 96H160C71.6 96 0 167.6 0 256s71.6 160 160 160c44.8 0 85.2-18.4 114.2-48h91.5c29 29.6 69.5 48 114.2 48 88.4 0 160-71.6 160-160S568.4 96 480 96zM256 276c0 6.6-5.4 12-12 12h-52v52c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-52H76c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h52v-52c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h52c6.6 0 12 5.4 12 12v40zm184 68c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-80c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>',"load-state":'<svg viewBox="0 0 576 512"><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"/></svg>',muted:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M301.2 34.85c-11.5-5.188-25.02-3.122-34.44 5.253L131.8 160H48c-26.51 0-48 21.49-48 47.1v95.1c0 26.51 21.49 47.1 48 47.1h83.84l134.9 119.9c5.984 5.312 13.58 8.094 21.26 8.094c4.438 0 8.972-.9375 13.17-2.844c11.5-5.156 18.82-16.56 18.82-29.16V64C319.1 51.41 312.7 40 301.2 34.85zM513.9 255.1l47.03-47.03c9.375-9.375 9.375-24.56 0-33.94s-24.56-9.375-33.94 0L480 222.1L432.1 175c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94l47.03 47.03l-47.03 47.03c-9.375 9.375-9.375 24.56 0 33.94c9.373 9.373 24.56 9.381 33.94 0L480 289.9l47.03 47.03c9.373 9.373 24.56 9.381 33.94 0c9.375-9.375 9.375-24.56 0-33.94L513.9 255.1z"/></svg>',netplay:'<svg viewBox="0 0 512 512"><path fill="currentColor" d="M364.215 192h131.43c5.439 20.419 8.354 41.868 8.354 64s-2.915 43.581-8.354 64h-131.43c5.154-43.049 4.939-86.746 0-128zM185.214 352c10.678 53.68 33.173 112.514 70.125 151.992.221.001.44.008.661.008s.44-.008.661-.008c37.012-39.543 59.467-98.414 70.125-151.992H185.214zm174.13-192h125.385C452.802 84.024 384.128 27.305 300.95 12.075c30.238 43.12 48.821 96.332 58.394 147.925zm-27.35 32H180.006c-5.339 41.914-5.345 86.037 0 128h151.989c5.339-41.915 5.345-86.037-.001-128zM152.656 352H27.271c31.926 75.976 100.6 132.695 183.778 147.925-30.246-43.136-48.823-96.35-58.393-147.925zm206.688 0c-9.575 51.605-28.163 104.814-58.394 147.925 83.178-15.23 151.852-71.949 183.778-147.925H359.344zm-32.558-192c-10.678-53.68-33.174-112.514-70.125-151.992-.221 0-.44-.008-.661-.008s-.44.008-.661.008C218.327 47.551 195.872 106.422 185.214 160h141.572zM16.355 192C10.915 212.419 8 233.868 8 256s2.915 43.581 8.355 64h131.43c-4.939-41.254-5.154-84.951 0-128H16.355zm136.301-32c9.575-51.602 28.161-104.81 58.394-147.925C127.872 27.305 59.198 84.024 27.271 160h125.385z"/></svg>',pause:'<svg viewBox="0 0 320 512"><path d="M272 63.1l-32 0c-26.51 0-48 21.49-48 47.1v288c0 26.51 21.49 48 48 48L272 448c26.51 0 48-21.49 48-48v-288C320 85.49 298.5 63.1 272 63.1zM80 63.1l-32 0c-26.51 0-48 21.49-48 48v288C0 426.5 21.49 448 48 448l32 0c26.51 0 48-21.49 48-48v-288C128 85.49 106.5 63.1 80 63.1z"/></svg>',play:'<svg viewBox="0 0 320 512"><path d="M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z"/></svg>',restart:'<svg viewBox="0 0 512 512"><path d="M496 48V192c0 17.69-14.31 32-32 32H320c-17.69 0-32-14.31-32-32s14.31-32 32-32h63.39c-29.97-39.7-77.25-63.78-127.6-63.78C167.7 96.22 96 167.9 96 256s71.69 159.8 159.8 159.8c34.88 0 68.03-11.03 95.88-31.94c14.22-10.53 34.22-7.75 44.81 6.375c10.59 14.16 7.75 34.22-6.375 44.81c-39.03 29.28-85.36 44.86-134.2 44.86C132.5 479.9 32 379.4 32 256s100.5-223.9 223.9-223.9c69.15 0 134 32.47 176.1 86.12V48c0-17.69 14.31-32 32-32S496 30.31 496 48z"/></svg>',"save-state":'<svg viewBox="0 0 448 512"><path fill="currentColor" d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"/></svg>',"screen-record":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><path fill="currentColor" d="M19.994,0C8.952,0,0,8.952,0,19.995c0,11.043,8.952,19.994,19.994,19.994s19.995-8.952,19.995-19.994,C39.989,8.952,31.037,0,19.994,0z M19.994,27.745c-4.28,0-7.75-3.47-7.75-7.75s3.47-7.75,7.75-7.75s7.75,3.47,7.75,7.75,S24.275,27.745,19.994,27.745z"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M495.9 166.6C499.2 175.2 496.4 184.9 489.6 191.2L446.3 230.6C447.4 238.9 448 247.4 448 256C448 264.6 447.4 273.1 446.3 281.4L489.6 320.8C496.4 327.1 499.2 336.8 495.9 345.4C491.5 357.3 486.2 368.8 480.2 379.7L475.5 387.8C468.9 398.8 461.5 409.2 453.4 419.1C447.4 426.2 437.7 428.7 428.9 425.9L373.2 408.1C359.8 418.4 344.1 427 329.2 433.6L316.7 490.7C314.7 499.7 307.7 506.1 298.5 508.5C284.7 510.8 270.5 512 255.1 512C241.5 512 227.3 510.8 213.5 508.5C204.3 506.1 197.3 499.7 195.3 490.7L182.8 433.6C167 427 152.2 418.4 138.8 408.1L83.14 425.9C74.3 428.7 64.55 426.2 58.63 419.1C50.52 409.2 43.12 398.8 36.52 387.8L31.84 379.7C25.77 368.8 20.49 357.3 16.06 345.4C12.82 336.8 15.55 327.1 22.41 320.8L65.67 281.4C64.57 273.1 64 264.6 64 256C64 247.4 64.57 238.9 65.67 230.6L22.41 191.2C15.55 184.9 12.82 175.3 16.06 166.6C20.49 154.7 25.78 143.2 31.84 132.3L36.51 124.2C43.12 113.2 50.52 102.8 58.63 92.95C64.55 85.8 74.3 83.32 83.14 86.14L138.8 103.9C152.2 93.56 167 84.96 182.8 78.43L195.3 21.33C197.3 12.25 204.3 5.04 213.5 3.51C227.3 1.201 241.5 0 256 0C270.5 0 284.7 1.201 298.5 3.51C307.7 5.04 314.7 12.25 316.7 21.33L329.2 78.43C344.1 84.96 359.8 93.56 373.2 103.9L428.9 86.14C437.7 83.32 447.4 85.8 453.4 92.95C461.5 102.8 468.9 113.2 475.5 124.2L480.2 132.3C486.2 143.2 491.5 154.7 495.9 166.6V166.6zM256 336C300.2 336 336 300.2 336 255.1C336 211.8 300.2 175.1 256 175.1C211.8 175.1 176 211.8 176 255.1C176 300.2 211.8 336 256 336z"/></svg>',volume:'<svg viewBox="0 0 640 512"><path d="M412.6 182c-10.28-8.334-25.41-6.867-33.75 3.402c-8.406 10.24-6.906 25.35 3.375 33.74C393.5 228.4 400 241.8 400 255.1c0 14.17-6.5 27.59-17.81 36.83c-10.28 8.396-11.78 23.5-3.375 33.74c4.719 5.806 11.62 8.802 18.56 8.802c5.344 0 10.75-1.779 15.19-5.399C435.1 311.5 448 284.6 448 255.1S435.1 200.4 412.6 182zM473.1 108.2c-10.22-8.334-25.34-6.898-33.78 3.34c-8.406 10.24-6.906 25.35 3.344 33.74C476.6 172.1 496 213.3 496 255.1s-19.44 82.1-53.31 110.7c-10.25 8.396-11.75 23.5-3.344 33.74c4.75 5.775 11.62 8.771 18.56 8.771c5.375 0 10.75-1.779 15.22-5.431C518.2 366.9 544 313 544 255.1S518.2 145 473.1 108.2zM534.4 33.4c-10.22-8.334-25.34-6.867-33.78 3.34c-8.406 10.24-6.906 25.35 3.344 33.74C559.9 116.3 592 183.9 592 255.1s-32.09 139.7-88.06 185.5c-10.25 8.396-11.75 23.5-3.344 33.74C505.3 481 512.2 484 519.2 484c5.375 0 10.75-1.779 15.22-5.431C601.5 423.6 640 342.5 640 255.1S601.5 88.34 534.4 33.4zM301.2 34.98c-11.5-5.181-25.01-3.076-34.43 5.29L131.8 160.1H48c-26.51 0-48 21.48-48 47.96v95.92c0 26.48 21.49 47.96 48 47.96h83.84l134.9 119.8C272.7 477 280.3 479.8 288 479.8c4.438 0 8.959-.9314 13.16-2.835C312.7 471.8 320 460.4 320 447.9V64.12C320 51.55 312.7 40.13 301.2 34.98z"/></svg>',cheat:'<svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z" class=""></path></svg>',"cache-manager":'<svg viewBox="0 0 1800 1800"><path d="M896 768q237 0 443-43t325-127v170q0 69-103 128t-280 93.5-385 34.5-385-34.5T231 896 128 768V598q119 84 325 127t443 43zm0 768q237 0 443-43t325-127v170q0 69-103 128t-280 93.5-385 34.5-385-34.5-280-93.5-103-128v-170q119 84 325 127t443 43zm0-384q237 0 443-43t325-127v170q0 69-103 128t-280 93.5-385 34.5-385-34.5-280-93.5-103-128V982q119 84 325 127t443 43zM896 0q208 0 385 34.5t280 93.5 103 128v128q0 69-103 128t-280 93.5T896 640t-385-34.5T231 512 128 384V256q0-69 103-128t280-93.5T896 0z"/></svg>'},this.id=Math.floor(1e4*Math.random()),null),o=(this.elements.controls=null,{id:this.id}),n=!0;D.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this.props)),this.config.controls||(this.config.controls=[]),D.element(this.config.controls)||D.string(this.config.controls)?t=this.config.controls:(t=ne.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality}),n=!1);function a(e){let n=e;return Object.entries(o).forEach(function(e){t=2;var e=function(e){if(Array.isArray(e))return e}(e=e)||function(n,o){let a=[],i=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(i=(e=t.next()).done)&&(a.push(e.value),!o||a.length!==o);i=!0);}catch(e){t=!0,s=e}finally{try{i||null==_0x4d9086.return||_0x4d9086.return()}finally{if(t)throw s}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),t=e[0],e=e[1];n=pe(n,"{".concat(t,"}"),e)}),n}let i;if(n&&(D.string(this.config.controls)?t=a(t):D.element(t)&&(t.innerHTML=a(t.innerHTML))),D.string(this.config.selectors.controls.container)&&(i=document.querySelector(this.config.selectors.controls.container)),(i=D.element(i)?i:this.elements.container)[D.element(t)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",t),D.element(this.elements.controls)||ne.findElements.call(this),!D.empty(this.elements.buttons)){let t=function(t){let n=e.config.classNames.controlPressed;Object.defineProperty(t,"pressed",{enumerable:!0,get:function(){return k(t,n)},set:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];G(t,n,e)}})};Object.values(this.elements.buttons).filter(Boolean).forEach(function(e){D.array(e)||D.nodeList(e)?Array.from(e).filter(Boolean).forEach(t):t(e)})}window.navigator.userAgent.includes("Edge")&&de(i)}},oe=ne;function We(n,o){for(let t=0;t<o.length;t++){let e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function Je(){if(this.enabled){let e=this.player.elements.buttons.fullscreen;D.element(e)&&(e.pressed=this.active),B.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",!0),X.isIos||function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(D.element(e)){let e=c.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]"),n=e[0],o=e[e.length-1];l.call(this,this.elements.container,"keydown",function(e){var t;"Tab"===e.key&&9===e.keyCode&&((t=document.activeElement)!==o||e.shiftKey?t===n&&e.shiftKey&&(o.focus(),e.preventDefault()):(n.focus(),e.preventDefault()))},t,!1)}}.call(this.player,this.target,this.active)}}function Ke(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];e?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",G(this.target,this.player.config.classNames.fullscreen.fallback,e),Je.call(this)}e=[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(D.function(document.exitFullscreen))return"";let t="";return["webkit","moz","ms"].some(function(e){return!(!D.function(document["".concat(e,"ExitFullscreen")])&&!D.function(document["".concat(e,"CancelFullScreen")])||(t=e,0))}),t}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}],We((u=f).prototype,[{key:"update",value:function(){this.enabled,G(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function(){this.enabled&&(f.native?this.prefix?D.empty(this.prefix)||this.target["".concat(this.prefix,"Request").concat(this.property)]():this.target.requestFullscreen():Ke.call(this,!0))}},{key:"exit",value:function(){var e;this.enabled&&(f.native?this.prefix?D.empty(this.prefix)||(e="moz"===this.prefix?"Cancel":"Exit",document["".concat(this.prefix).concat(e).concat(this.property)]()):(document.cancelFullScreen||document.exitFullscreen).call(document):Ke.call(this,!1))}},{key:"toggle",value:function(){this.active?this.exit():this.enter()}},{key:"enabled",get:function(){return f.native}},{key:"active",get:function(){return!!this.enabled&&(f.native?(this.prefix?document["".concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement)===this.target:k(this.target,this.player.config.classNames.fullscreen.fallback))}},{key:"target",get:function(){return X.isEdge?this.player.game:this.player.elements.container}}]),We(u,e);let Qe=f;function f(e){let t=this;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.player=e,this.prefix=f.prefix,this.property=f.property,this.scrollPosition={x:0,y:0},F.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),function(){Je.call(t)}),this.update()}$e.prototype={toggleMenu:function(e){oe.toggleMenu.call(this.emulator,e)},firstTouch:function(){let e=this.emulator,t=e.elements;e.touch=!0,G(t.container,e.config.classNames.isTouch,!0)},setTabFocus:function(e){let t=this.emulator,n=t.elements,o=t;var a;clearTimeout(this.focusTimer),"keydown"===e.type&&9!==e.which||("keydown"===e.type&&(this.lastKeyDown=e.timeStamp),a=e.timeStamp-this.lastKeyDown<=20,"focus"===e.type&&!a||(e=o.config.classNames.tabFocus,G(c.call(o,".".concat(e)),e,!1),this.focusTimer=setTimeout(function(){var e=document.activeElement;n.container.contains(e)&&G(document.activeElement,o.config.classNames.tabFocus,!0)},10)))},global:function(){let e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.emulator,n=t;l.call(n,document.body,"click",this.toggleMenu,e),ae.call(n,document.body,"touchstart",this.firstTouch),l.call(n,document.body,"keydown focus blur",this.setTabFocus,e,!1,!0),F.call(n,document.body,"keyup",function(e){n.started&&(113===e.which&&(e.shiftKey?null===n.elements.buttons.saveState.getAttribute("hidden")&&B.call(n,n.elements.buttons.saveState,"click"):te.quickSaveState()),115===e.which&&(e.shiftKey?null===n.elements.buttons.loadState.getAttribute("hidden")&&B.call(n,n.elements.buttons.loadState,"click"):te.quickLoadState()),120===e.which&&B.call(n,n.elements.buttons.mute,"click"))})},container:function(){let n,o=this.emulator,a=o.elements,i=o,t=null;F.call(i,a.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen start-game",function(e){let t=a.controls;t&&"enterfullscreen"===e.type&&(t.pressed=!1,t.hover=!1);if(["touchstart","touchmove","mousemove","start-game"].includes(e.type)){if("nds"===getSystem(o.system,!0)&&"melonds"!==getSystem(o.system,o.coreVer)&&"mousemove"==e.type&&g&&g.Module&&g.Module.canvas&&(document.pointerLockElement===g.Module.canvas||document.mozPointerLockElement===g.Module.canvas))return void K.toggleControls.call(i,!1);!te||"undefined"!=te.virtualGamepadContainer&&null!==te.virtualGamepadContainer||(K.toggleControls.call(i,!0),e=i.touch?3e3:2e3,clearTimeout(n),n=setTimeout(function(){return K.toggleControls.call(i,!1)},e),a.controls.setAttribute("data-timer",n))}}),F.call(i,window,"resize",function(e){let t=i.elements.container.clientHeight,n=c.call(i,".".concat(q({ejs__menu__container:!0}),' [role="menu"]'));Array.from(n).forEach(function(e){e.style.maxHeight="".concat(t-95,"px"),e.style.overflow="auto"}),g.Module&&g.Module.canvas,i.elements.container.clientWidth/i.elements.container.clientHeight<1.3?G(i.elements.container,q({portrait:!0}),!0):G(i.elements.container,q({portrait:!0}),!1)}),B.call(i,window,"resize"),F.call(i,i.elements.container,"enterfullscreen",function(e){if(g.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.lock)try{screen.orientation.lock("landscape")}catch(e){}else if(g.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.lock)try{ScreenOrientation.lock("landscape")}catch(e){}if(2===i.coreVer&&g.Module){let e=50;clearInterval(t),t=setInterval(function(){g.Module.setCanvasSize(window.innerWidth,window.innerHeight),e<0&&clearInterval(t),e--},100)}setTimeout(function(){B.call(i,window,"resize")},300)}),F.call(i,i.elements.container,"exitfullscreen",function(e){if(g.isMobileDevice&&window.screen&&screen.orientation&&"function"==typeof screen.orientation.unlock)try{screen.orientation.unlock()}catch(e){}else if(g.isMobileDevice&&window.ScreenOrientation&&"function"==typeof ScreenOrientation.unlock)try{ScreenOrientation.unlock()}catch(e){}2===i.coreVer&&g.Module&&(clearInterval(t),g.Module.setCanvasSize(800,600)),setTimeout(function(){B.call(i,window,"resize")},300)}),F.call(i,i.elements.container,"start-game",function(e){let t=window.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(t),G(i.elements.container,q({"game-started":!0}),!0)}),F.call(i,i.elements.container,"blur",function(e){let t=e.currentTarget;setTimeout(function(){t.contains(document.activeElement)||B.call(i,i.elements,"blurgame")},0)}),F.call(i,i.elements.container,"focus",function(e){let t=e.currentTarget;setTimeout(function(){t.contains(document.activeElement)&&B.call(i,i.elements,"focusgame")},0)})},media:function(){let t=this.emulator,o=t.elements,a=t;F.call(a,a.game,"volumechange",function(e){return oe.updateVolume.call(a,e)}),F.call(a,o.container,"contextmenu",function(e){a.touch||a.lightgun||oe.toggleContextMenu.call(a,e,!0),e.preventDefault()},!1),F.call(a,o.container,"mousewheel",function(e){e.stopPropagation()},!1),F.call(a,o.container,"mousedown",function(e){"nds"===getSystem(t.system,!0)&&"melonds"!==getSystem(t.system,t.coreVer)&&g&&g.Module&&g.Module.canvas&&!g.isMobileDevice&&document.pointerLockElement!==g.Module.canvas&&document.mozPointerLockElement!==g.Module.canvas&&t.started&&!t.connected&&setTimeout(function(){!0!==t.onButtonDiv&&(g.Module.canvas.requestPointerLock=g.Module.canvas.requestPointerLock||g.Module.canvas.mozRequestPointerLock,g.Module.canvas.requestPointerLock()),t.onButtonDiv=!1},100),a.touch||oe.toggleContextMenu.call(a,e,!1)},!1),F.call(a,a.game,"volumechange",function(){a.storage.set({volume:a.volume,muted:a.muted}),te.setVolume&&te.setVolume()});var e=a.config.events.concat(["keyup","keydown"]).join(" ");F.call(a,a.game,e,function(e){let t=e.detail,n=void 0===t?{}:t;"error"===e.type&&(n=a.game.error),B.call(a,o.container,e.type,!0,n)})},proxy:function(e,t,n){let o=this.emulator,a=o.config.listeners[n],i=!0;(i=D.function(a)?a.call(o,e):i)&&D.function(t)&&t.call(o,e)},bind:function(e,t,n,o){let a=this,i=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],s=this.emulator,r=s,l=r.config.listeners[o],c=D.function(l);F.call(r,e,t,function(e){return a.proxy(e,n,o)},i&&!c)},controls:function(){let i=this,r=this.emulator,t=r.elements,n=X.isIE?"change":"input";var e;this.bind(t.buttons.mute,"click",function(){r.muted=!r.muted},"mute"),this.bind(t.buttons.fullscreen,"click",function(){r.fullscreen.toggle()},"fullscreen"),this.bind(t.buttons.gamepad,"click",function(){K.toggleControls.call(r,!1),V(t.dialogs.gamepad,!1)},"mute"),this.bind(t.buttons.saveState,"click",function(){!async function(){B.call(r,r.elements.container,"savestate-start",!1,{});var n=await te.saveState(),o=te.getScreenData();if(!ee.saveLoadDB.call(r,"save")){if(D.function(r.config.onsavestate))r.config.onsavestate.call(null,{screenshot:o,state:n});else{let e=r.getStartName(!0).split("/").pop();o=new Blob([n]),n=(e.includes(".")&&(e=e.substring(0,e.length-e.split(".").pop().length-1)),(e="string"==typeof r.gameName?r.gameName:e)?"".concat(e,".state"):"game.state");let t=document.createElement("a");t.download=n,t.href=URL.createObjectURL(o),t.click(),setTimeout(function(){URL.revokeObjectURL(t.href)},2e3)}r.elements.container.focus()}}(),saveSaveFiles()},"mute"),this.bind(t.buttons.loadState,"click",function(){B.call(r,r.elements.container,"loadstate",!1,{})},"mute"),this.bind(t.buttons.settings,"click",function(e){e.stopPropagation(),oe.toggleMenu.call(r,e)}),this.bind(t.buttons.settings,"keyup",function(e){var t=e.which;[13,32].includes(t)&&(13!==t?(e.preventDefault(),e.stopPropagation(),oe.toggleMenu.call(r,e)):oe.focusFirstMenuItem.call(r,null,!0))},null,!1),this.bind(t.settings.menu,"keydown",function(e){27===e.which&&oe.toggleMenu.call(r,e)}),X.isIos&&(e=c.call(r,'input[type="range"]'),Array.from(e).forEach(function(e){return i.bind(e,n,function(e){return de(e.target)})})),X.isWebkit&&Array.from(c.call(r,'input[type="range"]')).forEach(function(e){i.bind(e,"input",function(e){return oe.updateRangeFill.call(r,e.target)})}),this.bind(t.inputs.volume,n,function(e){r.volume=e.target.value},"volume"),this.bind(t.controls,"mouseenter mouseleave",function(e){"mouseleave"===e.type&&null===e.toElement?t.controls.hover=!0:t.controls.hover=!r.touch&&"mouseenter"===e.type}),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){["mousedown","touchstart"].includes(e.type)?(t.controls.pressed=!0,e=t.controls.getAttribute("data-timer2"),clearTimeout(e)):(e=setTimeout(function(){t.controls.pressed=!1},4e3),t.controls.setAttribute("data-timer2",e))}),this.bind(t.controls,"focusin focusout",function(e){let t=r.config,n=r.elements,o="focusin"===e.type,a=n.controls.getAttribute("data-timer");G(n.controls,t.classNames.noTransition,o),K.toggleControls.call(r,o),o&&(setTimeout(function(){G(n.controls,t.classNames.noTransition,!1)},0),e=i.touch?3e3:4e3,clearTimeout(a),a=setTimeout(function(){return K.toggleControls.call(r,!1)},e),n.controls.setAttribute("data-timer",a))}),this.bind(t.inputs.volume,"wheel",function(e){let t=e.webkitDirectionInvertedFromDevice,n=function(n,o){if(Array.isArray(n))return n;let a=[],i=!0,t=!1,s=void 0;try{for(let e,t=n[Symbol.iterator]();!(i=(e=t.next()).done)&&(a.push(e.value),!o||a.length!==o);i=!0);}catch(e){t=!0,s=e}finally{try{i||null==_0x1bb8de.return||_0x1bb8de.return()}finally{if(t)throw s}}return a}([e.deltaX,-e.deltaY].map(function(e){return t?-e:e}),2),o=n[0],a=n[1],i=Math.sign(Math.abs(o)>Math.abs(a)?o:a);r.increaseVolume(i/50);var s=r.game.volume;(1===i&&s<1||-1===i&&0<s)&&e.preventDefault()},"volume",!1),this.bind(t.controls,"contextmenu",function(e){e.stopPropagation()}),this.bind(t.contextMenu,"contextmenu",function(e){e.stopPropagation()})}};let Ze=$e;function $e(e){if(!(this instanceof $e))throw new TypeError("Cannot call a class as a function");this.emulator=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}function et(n,o){for(let t=0;t<o.length;t++){let e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}u=[{key:"setup",value:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=null;return D.string(e)?n=Array.from(document.querySelectorAll(e)):D.nodeList(e)?n=Array.from(e):D.array(e)&&(n=e.filter(D.element)),D.empty(n)?null:n.map(function(e){return new nt(e,t)})}}],et((e=nt).prototype,[{key:"restart",value:function(){this.currentTime=0}},{key:"increaseVolume",value:function(e){var t=this.game.muted?0:this.volume;this.volume=t+(D.number(e)?e:0)}},{key:"decreaseVolume",value:function(e){this.increaseVolume(-e)}},{key:"toggleControls",value:function(e){return!!this.started&&((e=G(this.elements.container,this.config.classNames.hideControls,void 0===e?void 0:!e))&&oe.toggleMenu.call(this,!1),!e)}},{key:"getStartName",value:function(e){let t;var n=/[#<$+%>!`&*'|{}/\\?"=@:^\r\n]/gi;return!this.startName||!0!==e&&"rom"===this.startName?D.string(this.config.gameUrl)&&!this.config.gameUrl.startsWith("blob:")?t=this.config.gameUrl.split("/").pop().split("?")[0].replace(n,""):this.gameName?t=this.gameName.replace(n,"")+"."+this.system:this.config.gameId?t=this.config.gameId+"."+this.system:D.string(this.config.gameUrl)&&!0===e?t=this.config.gameUrl.split("/").pop().split("?")[0].replace(n,""):!0===e&&(t="rom"):t=this.startName,t}},{key:"loadState",value:function(e){te.loadState(e,0)}},{key:"on",value:function(e,t){F.call(this,this.elements.container,e,t)}},{key:"once",value:function(e,t){ae.call(this,this.elements.container,e,t)}},{key:"off",value:function(e,t){M(this.elements.container,e,t)}},{key:"playing",set:function(){let t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Array.from(this.elements.buttons.play||[]).forEach(function(e){e.pressed=t}),this.paused=!t},get:function(){return Boolean(this.ready&&!this.paused)}},{key:"volume",set:function(e){let t=e;D.string(t)&&(t=Number(t)),D.number(t)||(t=this.storage.get("volume")),(t=1<(t=D.number(t)?t:this.config.volume)?1:t)<0&&(t=0),this.config.volume=t,this.game.volume=t,!D.empty(e)&&this.muted&&0<t&&(this.muted=!1)},get:function(){return Number(this.game.volume)}},{key:"muted",set:function(e){let t=e;D.boolean(t)||(t=this.storage.get("muted")),D.boolean(t)||(t=this.config.muted),this.config.muted=t,this.game.muted=t},get:function(){return Boolean(this.game.muted)}}]),et(e,u);let tt=nt;function nt(s,r){return new Promise(async function(e,t){function a(e,t){var n=window.location.pathname.split("/").pop();let o=window.location.pathname.substring(0,window.location.pathname.length-n.length);var a,i=o.split("/"),s=e.split("/");let r=[];for(let e=0;e<i.length;e++)""!=i[e]&&r.push(i[e]);if(!(e.startsWith("/")||e.includes("://")||e.includes("http:")||e.includes("https:")||e.includes("file:")||e.includes("blob:"))){for(let e=0;e<s.length;e++)""!=s[e]&&"."!=s[e]&&(".."==s[e]?0<r.length&&(r=("/"===(a=r.join("/"))?"/":a.substring(0,a.length-a.split("/").pop().length)).split("/")):r.push(s[e]));(e=r.join("/")).startsWith("/")||(e="/"+e),e=window.location.protocol+"//"+window.location.host+e}return!(e=e.startsWith("/")?window.location.protocol+"//"+window.location.host+e:e).endsWith("/")&&t&&(e+="/"),e}let o=this;this.localization=e=>e,this.version="3.1.0",this.system="",this.adUrl=null,this.gameName=null,this.loadStateOnStart=!1,this.statesSupported=!0,this.mameCore=null,this.startOnLoad=!1,this.dataPath="",this.customPaths=null,this.hash="",this.lightgun=!1,this.mouse=!1,this.multitap=!1,this.ready=!1,this.paused=!0,this.started=!1,this.touch=Y.touch,this.game=s,D.string(this.game)&&(this.game=document.querySelectorAll(this.game)),(window.jQuery&&this.game instanceof jQuery||D.nodeList(this.game)||D.array(this.game))&&(this.game=this.game[0]),this.game=this.game,this.game.innerHTML="",this.config=W({},S,nt.defaults,r||{}),this.config.settings&&this.config.settings.volume&&(S.volume=this.config.settings.volume),this.config.settings&&this.config.settings.defaultControllers&&(ee.defaultControllers=this.config.settings.defaultControllers),this.coreVer=1,this.lightgun=this.config.lightgun,this.loadStateOnStart=this.config.loadStateOnStart||!1,this.adUrl=this.config.adUrl||null,D.string(this.config.gameName)&&(this.gameName=this.config.gameName||null),this.mouse=this.config.mouse,this.multitap=this.config.multitap,this.cheats=this.config.cheats,this.cheats||(this.cheats=[]);var n="string"==typeof(n=this.config.netplayUrl)?n:null,n=(this.listUrl=n,this.socketUrl=n,this.mameCore=this.config.mameCore||null,this.color=this.config.color,this.startOnLoad=this.config.startOnLoad||!1,this.statesSupported=this.config.statesSupported||!0,this.customPaths=function(e){if(!e)return{};let t={};for(var n in e)"string"==typeof e[n]&&(t[n]=a(e[n]));return t}(this.config.paths),this.dataPath=function(n){if("string"==typeof n)return a(n,!0);{n=window.location.href;let e=n;var o=e.split("/").pop();let t=e.substring(0,e.length-o.length);return"/"==n?window.location.protocol+"//"+window.location.host+"/":((t=t.startsWith("/")?window.location.protocol+"//"+window.location.host+t:t).endsWith("/")||(t+="/"),t)}}(this.config.dataPath),this.localization=await async function(e,t,n){let o={};if(n&&"string"==typeof n&&"en-US"!==n){t=t&&"string"==typeof t[n+".json"]?t[n+".json"]:e+"localization/"+n+".json";try{let e=await fetch(t);var a=await e.text(),i=JSON.parse(a);S.i18n=i.i18n,ne.normalOptions=i.normalOptions}catch(e){console.warn("error setting localization",e)}}return function(e){return"string"==typeof o[e]?o[e]:(n&&"en-US"!==n&&"undefined"!=typeof EJS_DEBUG_XX&&!0===EJS_DEBUG_XX&&console.warn('Missing translation for "'+e+'". Language is set to "'+n+'"'),e)}}(this.dataPath,this.customPaths,this.config.lang),this.config=W({},S,nt.defaults,r||{}),Object.keys(this.config.classNames).forEach(function(n){var e=o;if(D.object(e.config.classNames[n]))Object.keys(e.config.classNames[n]).forEach(function(e){let t={};t[o.config.classNames[n][e]]=!0,o.config.classNames[n][e]=q(t)});else{let e={};e[o.config.classNames[n]]=!0,o.config.classNames[n]=q(e)}}),this.config.selectors.controls.wrapper=".".concat(q({ejs__controls:!0})),this.config.selectors.container=".".concat(q({ejs:!0})),this.system=this.config.system,this.elements={container:null,buttons:{},display:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}},dialogs:{gamepad:null,loading:null,netplay:null},widgets:{}},this.fullscreen={active:!1},this.config.mute=!0,this.eventListeners=[],this.listeners=new Ze(this),this.storage=new ge(this,"ejs_settings"),this.game.emulator=this,D.element(this.elements.container)||(this.elements.container=U("div"),A(this.game,this.elements.container)),U("div",{class:q({ejs__widgets:!0})})),n=(this.elements.container.appendChild(n),U("div",{class:q({ejs__dialogs:!0})}));this.elements.container.appendChild(n),K.addStyleHook.call(this),te.setup.call(this),K.build.call(this),this.listeners.container(),this.listeners.global(),this.fullscreen=new Qe(this),g.create.call(this);let i=document.createElement("script");i.src=this.customPaths&&"string"==typeof this.customPaths["webrtc-adapter.js"]?this.customPaths["webrtc-adapter.js"]:this.dataPath+"webrtc-adapter.js",document.body.appendChild(i),e(this)}.bind(this))}tt.defaults={},a.default=tt}]).default;